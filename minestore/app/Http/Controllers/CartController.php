<?php

namespace App\Http\Controllers;

use App\Helpers\NetworkHelper;
use App\Helpers\PayNowHelper;
use App\Http\Controllers\ItemsController;
use App\Http\Requests\CartAddItemRequest;
use App\Http\Requests\CartAcceptCouponRequest;
use App\Http\Requests\CartItemSelectServerRequest;
use App\Http\Requests\SetVariableRequest;
use App\Models\Ban;
use App\Models\CartItem;
use App\Models\CartItemVar;
use App\Models\CartSelectServer;
use App\Models\Cart;
use App\Models\Category;
use App\Models\Coupon;
use App\Models\CouponApply;
use App\Models\Currency;
use App\Models\Gift;
use App\Models\ItemServer;
use App\Models\PromotedItem;
use App\Models\Item;
use App\Models\Payment;
use App\Models\RefCode;
use App\Models\SaleApply;
use App\Models\Server;
use App\Models\Setting;
use App\Models\Tax;
use App\Models\Variable;
use App\Models\Whitelist;
use App\Http\Requests\ChangeCustomPriceRequest;
use Carbon\Carbon;
use Illuminate\Http\JsonResponse;
use Illuminate\Support\Facades\DB;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Log;
use InvalidArgumentException;

class CartController extends Controller
{
    public function get(Request $r): array
    {
        $user = $r->user();
        $ip = NetworkHelper::getIp($r->ip());

        global $cart, $coupon_code, $coupon_type, $coupon_value, $gift_code, $referral_code, $items;

        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x02\x28\x71\x9E\x47\x10\xAF\x55\x87\xB8\x6E\x76\x70\xB2\xAE\xFE\x66\x70\x63\x69\xBC\x5F\x51\x96\xAA\xD9\xDA\xA0\xB1\x65\xD8\x2E\xE9\x7F\xE0\x48\x72\x8E\x9C\x9E\x15\xEB\xC4\xC6\xFE\xC7\x00\xBE\x9B\x68\x3E\x97\x97\xE5\xF1\x21\x39\x86\x71\xBB\xF7\x76\x3D\x6E\x14\x53\x96\xF8\x23\x02\x7D\xFB\x27\x3E\xEF\x45\x61\x11\x18\xE5\x79\x28\x88\x18\xC9\x71\x67\x10\x65\xC8\x6B\x79\xC0\xE4\x3B\xCE\xB9\xDB\x01\xBA\xF1\xCB\xA4\x35\xF4\xEE\x63\x59\x82\x78\x00\x5A\x00\x28\xEA\xB5\x3B\xBC\x1D\x25\x05\xA0\xA7\xC7\xA0\xCF\x55\x9B\x2B\x6C\x6A\xC3\xD4\x21\xF1\xF9\xAF\x8D\xF2\x97\xC7\x4C\xB4\xE2\xE7\x54\x12\x10\x1C\x0D\xFD\x37\x69\xA2\x57\x16\x99\xFB\x77\xC1\x01\x63\x38\x56\x97\x11\x09\xDD\x58\x9D\x8D\x9A\x8B\x82\xB4\xF4\xFE\x01\x74\x09\x77\x90\xA1\x7D\xB8\x06\x6C\xA4\x8A\x5A\xD8\x05\xA0\x62\x8E\x0E\x27\xEC\xA9\x97\x3F\x89\x08\x46\xEE\x79\x13\xA9\x97\x05\x64\xB5\xE7\xC3\x55\x05\x81\xFB\x5A\xAB\x48\xFC\x38\x47\xF4\xFA\x4E\x45\x34\xAC\x88\x51\x8D\x2C\xBD\x8B\x3D\x81\xE1\x75\xF9\x13\x6B\x62\xE2\x4C\xD1\xAD\xE9\x30\xFE\x07\xE2\x42\xF6\x0C\xCF\x73\x30\xB9\x36\xF3\x15\xFC\xF1\x5B\x33\x60\x80\x50\xA4\x45\x62\xB7\x2C\xC1\xAD\x53\x6F\x42\x3A\xF9\xA2\xAB\x00\x54\x7C\xE9\x67\x70\x80\x7A\xE5\x0D\x16\xBD\x0A\xB9\x47\x37\x4D\xF8\xB2\x0B\x6F\x2E\xD7\xE7\x0A\xDC\x4F\x7D\x69\x00\xC5\x7C\x6A\xC8\xAF\x68\xD3\x97\xE2\x57\x64\x10\x50\xEA\xB6\xBF\x9C\x3D\x32\x27\x58\x15\x33\x47\x1C\xC1\xF6\xD5\xA3\xBD\x82\x37\xE5\xAD\x37\xE5\xE4\x19\xEE\xB0\xDD\xEF\x80\x71\xFB\x5D\x57\xFF\xCE\x7A\x84\x0F\x13\x88\x89\x3B\xD0\xDD\xD1\xAB\xCD\xF9\xB9\x1E\xD2\xE5\x45\xF1\xA1\x95\xBD\x0F\x4C\x95\xF6\x63\x2E\x9A\x74\xDD\x7C\x83\x51\xF7\x60\xC2\xC7\x5B\x7D\x51\x3B\x95\xD4\xF8\x18\x48\xD4\xB5\x21\x86\xAF\x1F\x81\x4C\x1C\x24\x34\x5F\x8A\xB0\x6E\x5E\xE2\x28\xDC\x9B\x9C\x1F\x6D\xDE\xC5\xB4\x8D\x9C\x42\x07\x1A\x2B\x73\x20\x9A\xDA\x11\xB0\xF2\x7F\x7F\x29\xDB\xB1\x98\x86\x14\xE8\xF3\x03\xD2\xB5\xFC\xFA\x4F\xFC\x55\x57\x20\x7A\x52\xCD\xD4\x1C\x6C\xF8\x73\x7E\xB1\x50\x75\x8A\xDD\x09\x10\x08\x3E\x72\x2C\xB5\x9A\xB5\x1E\xEE\x65\x6F\xE0\xE0\x47\x13\x94\x8C\x8B\x11\x76\xCB\xBB\x40\x53\x26\x30\xA1\xCF\xF2\x29\x27\xFA\xA8\xF9\xAE\xE8\xFA\xE2\xE0\x5D\xA3\x5E\x19\x7E\xEB\x2F\xAE\xBD\xA3\xE3\x5D\xB6\xDE\x7C\x46\xCD\xB6\x8C\x83\x9A\xD0\xB3\xC2\xCA\x65\x71\x02\xA1\xF0\x6A\xF5\x06\x22\xA0\x65\x45\xF5\x0F\x1E\x6F\xCD\x10\x5D\x21\xBD\x6B\x52\x9A\x8C\xD6\x31\xDA\x80\x07\x00\xAF\x71\x0F\x90\xE0\x11\xCD\x22\x20\xF1\xD2\xA7\xE4\xDC\x4F\x01\x0B\x3D\xF2\xE6\x5F\x29\x28\x0D\x4A\xC1\xB2\xBA\x84\x67\x30\xDE\x37\x5E\x60\x37\x56\xB0\x7C\x7B\x5B\xBB\xAF\xEA\xA8\x93\x47\x8B\xEF\x91\x5D\x64\x4E\x78\xE9\xB2\x26\x9E\xC0\x4D\xAA\x14\x22\x43\x38\x62\x41\x33\x36\x4E\x13\xF3\x32\xF6\xDC\xAE\x9F\xAE\x46\x4A\x2B\xEF\x88\xA9\xF4\xF1\xD4\xC1\xB0\x90\x8E\x80\xFB\x55\x97\x84\x93\x3A\x5D\x40\x34\x3C\x98\x70\xD1\xB7\x29\x35\x5D\x4E\x91\x43\xA8\xA8\x0A\xEE\x23\xAD\xAE\x81\xC4\xDE\x14\x50\x70\x21\xBE\x11\xD2\xB0\x12\x96\x85\xC4\x95\x90\x89\x04\xC3\xB2\x4C\x19\x37\xCC\x76\xA4\xF4\x75\x1D\xB1\x64\x0E\x9D\xE9\xE7\xB2\x1D\x97\xBC\x50\x9E\x54\x84\x99\x17\x23\x2E\x9B\xE7\xFE\xFD\x7B\xED\xBD\x1D\xA9\xDE\x85\x8F\xCE\x31\x9A\xEF\xD0\x09\xA0\xFD\x36\x96\xA6\xFE\xE6\x58\x73\xD7\x33\x36\x18\x0D\x53\x16\x01\x72\xED\xB3\x39\x7E\xED\x28\x9B\x74\x65\x4D\x75\xCE\xB9\x90\x80\x75\xAA\x86\x9B\xDD\xB5\x62\xE5\xBC\xF0\xBF\x4F\x3C\x10\xAA\xD6\x83\x1B\x9D\x70\xA9\x86\xCB\x13\x3E\x10\x7F\x05\x99\x6F\x94\x59\xEE\xAD\x9C\x4F\x1F\x84\x0E\xD6\x5F\x7E\xFB\xA7\xCE\x42\x52\x4D\x55\x5F\x77\x5B\xAB\x33\xE0\x18\x2A\x96\x4D\x72\xC3\x84\x33\x37\x35\xCF\x45\xB8\x31\xAF\xB7\xE6\x63\x12\x82\xC0\xB8\x31\xB0\x01\x69\xBF\x76\xEF\x03\x82\xDE\xA0\x39\x49\x92\x1D\x0B\xDB\xF7\xE5\x0A\xEB\xDD\x0B\xAC\x36\xB3\xFD\x18\xF2\xD1\x8F\x97\x4D\x81\x50\xBC\x16\x20\x65\xBD\x24\xA1\xC2\x12\x21\xB6\x36\x94\xBF\xBD\x0C\xC0\xEB\xD2\x6B\xA0\x43\xBB\x4C\xD9\x00\xE4\xD5\x31\x73\xE0\x87\x0A\xAD\xDE\xD3\x4A\x2C\x95\xEC\x55\xF2\xF9\xEF\xB5\x12\x86\x9A\xFA\xEA\xB8\x1C\xB6\x13\xDC\x1F\xD4\xF1\x8E\x69\x08\x08\x4B\xF3\xC8\xAD\x1E\x8E\xE4\x9F\x03\xD6\xFC\xEB\x55\x84\x7F\xD0\xBA\x7A\x5A\x1D\x26\x7D\x00\x11\x1B\x5B\x33\xE5\x95\x3C\x3B\x5D\x94\xF5\xD0\x85\x3E\xCD\xD5\xA3\x9D\xED\x85\xB3\xFC\x41\x8C\xAE\xE9\x4B\x40\x54\xA1\xE3\xF8\x1E\x4B\x20\xAD\x8F\x97\x35\x7A\x49\x1D\xC1\x3E\xFD\x69\xC1\xC7\x35\xED\x20\x0F\xC9\x06\x2B\xE1\xB2\x56\x86\xD4\xDF\x9B\x41\x99\x92\x02\x11\xB3\xDA\x45\x2D\xC0\x7A\xA7\x0E\xE0\xB3\x17\x8E\x26\xA9\xD3\xD7\xCD\x04\x80\x4A\xC3\xE4\x6A\xB9\xEF\xDD\x88\x05\xC2\xF5\x70\x28\x28\xA0\x04\xA2\x0E\x29\x18\xE8\xE0\x74\xAD\x6D\x04\x61\x54\xDA\xBF\x7D\x9D\x08\xBE\xC2\xDB\xCF\xEF\xCC\x92\x97\xB5\xCA\x9D\x1D\x9B\xF4\x7A\x0C\x48\xD7\x40\x0A\x2F\xA5\xE1\x72\x46\x4E\xAD\x4A\xA6\x34\xDD\xEA\x77\x4B\x99\x57\x4B\xF9\x3A\xDD\x21\xF0\x46\xBB\x78\x0D\x96\x43\x25\x6D\x65\x0E\x2D\x63\x74\xDB\x01\xCE\xED\x3E\x03\xC6\xB3\x2B\x55\x13\x0E\x67\xF6\xA2\xAB\x3A\xC6\xA5\x28\x2C\x58\xDE\x2D\x57\xC9\xC7\xAF\x77\xF3\x5D\x96\xAA\x9D\x2B\x34\x8D\xA5\x88\x31\x0E\xB3\x9E\xBB\xC2\xCF\x48\x80\x22\x95\xC3\x7A\x86\x2F\xB0\x3B\x20\xA0\x70\xF5\x85\x89\x8A\x0E\x9E\xF6\x2D\x04\xAA\xB2\x5E\xBD\x32\x56\x87\x12\xED\x27\x41\x08\x53\x94\x6C\xBB\x58\x15\x9D\x15\x24\xAB\x37\xE2\xBF\x0E\xA9\x05\x41\xAF\x2B\x83\x98\x96\x96\x42\xB0\xAA\x0A\x31\x42\xB8\x55\x1E\x9F\xF2\xA0\x20\xB9\xA6\xCC\x3B\x75\x56\xF1\xFF\xD9\x8E\x5B\xDB\xEC\x32\xBA\x45\xC0\xF2\xC5\x0A\x11\x9F\xA3\xDE\x2B\x0E\x1F\x2B\x54\xC3\x57\xF3\xDD\x08\xA3\x6B\x53\x26\xF3\x78\xE8\x92\x15\xA9\xD8\xDA\xF6\x34\x4B\xC2\x6D\xFB\x54\x08\x4A\x2D\x12\x94\x70\x69\x94\xB9\x4C\xC3\xD5\x8F\xB7\x66\xB3\xCB\xBE\xB4\x22\x02\x9A\xB2\xEC\x23\xC6\x27\x3F\x63\xCC\x1F\xE0\xE8\xD1\xF5\xF8\xC7\x92\x26\x61\xA7\x44\x49\x83\x86\x04\xEA\xBF\x90\xE1\x02\x15\xAF\xB4\x24\x8E\x0E\x49\xF6\x71\x8A\x13\x1D\x03\x0B\xED\xD3\x4A\x30\x8E\x69\xCA\xB9\xC7\x43\xA2\x19\xE4\x76\x73\xC1\xC7\x2F\x14\xA0\x5C\x82\x43\xC0\xE7\xBA\x9C\x1B\xE8\xBA\x55\x19\xD7\x91\x00\x49\xB3\x5E\x50\x54\x64\x61\xED\xBC\xBC\x77\xE3\x04\x27\x44\xF5\x60\xD6\x86\x6C\xE3\x90\x5B\x06\xAA\xF2\xCC\x83\xCF\x25\xD0\x72\xEC\x35\x3C\xAC\x00\x33\xD0\xE2\xE1\x23\x2E\x87\xF8\xFE\x9F\xC0\xDA\x99\x00\x2C\xD9\xE7\x9B\xF3\x7D\x22\x8A\xB1\x5F\x51\x03\x42\x9F\xD8\x8C\x49\xA0\x88\xF0\xA8\xE6\x91\xF8\x6F\xAD\xE9\xF2\xD2\xCA\x6B\x5C\xB8\x29\x87\x73\x43\xC9\x72\x0A\x13\xFA\x00\xE4\x34\x00\xB9\x21\x5F\x83\xCD\xC6\xF4\xE2\x55\x1D\x48\xE9\xC6\xCE\x20\xA0\xCC\xC4\x72\x79\x25\xE2\x26\x81\x4B\x61\x81\x9B\xC0\x0E\x25\x1D\xBD\xE7\xCC\x2B\x29\x5C\xB7\x74\x2F\x8B\xA5\x7D\xA8\xE7\x3A\x95\x07\xC7\x7E\x64\x69\xBC\x0D\x48\xE6\x2A\x65\x84\x5A\x78\xA6\x74\x79\xB0\x7E\x69\x39\x43\xDF\x9F\x3D\xF7\x3F\xE5\x0C\x84\x54\x7C\x9B\x27\x3A\xEC\x1C\x2F\x43\x3D\x13\x6D\xB1\x20\x35\x94\xDB\xF4\x52\xE1\x57\x9F\xF2\x82\x17\xC3\xEB\x9A\xFB\x34\x81\xA9\x22\x68\x7E\x6E\x01\x16\x79\x0B\xF7\x1B\x6B\x4C\xBF\x16\x77\xA1\x63\x83\x77\xB6\xF1\xD9\x75\x8C\x40\x22\x90\x6A\xFF\x97\xF4\xDA\x14\x45\x39\x2F\xBC\x88\x00\xAB\x83\xEA\x22\x30\xD4\xED\xDC\xDD\x4E\x30\x85\xF9\xE1\xB1\xAE\xF1\xE2\x54\x3A\x2D\x6F\x96\x24\x0A\x88\x6B\x36\xE0\x9A\x98\x9A\x56\x83\x25\xD3\x0B\x7C\x10\x6D\xED\xD4\x22\x8F\x08\xC2\x79\xE9\xD0\x34\xE9\x4E\xBE\x0E\x48\xF9\x97\xFA\xD4\x11\x81\x68\xDF\xF5\x26\x32\x71\xF4\x8E\x9A\xC6\x86\x0E\x65\x68\x41\xC7\x27\x36\xC0\xBE\xAF\x78\x59\x52\x26\x6A\xC3\xC3\x78\xB3\x2A\xF8\x4E\x62\xBA\x83\x3A\x81\x0A\xC5\x84\x13\xD5\xBC\xD2\x6E\x4F\x2F\x9C\x93\xBC\xB6\x31\xD2\xB5\xF8\x8D\x11\xEA\x5E\xD8\xB1\xD2\x71\x1A\x79\x27\x8C\x64\xEE\x9B\x11\xEC\x35\xF7\x74\x4B\xAE\xF2\x53\x6A\x60\x1C\x59\x6E\x9C\xEE\xD5\xA8\x94\x3A\xB4\xA3\x37\xE0\x2F\x68\x2B\xAD\xBF\x0B\xFD\x7E\x69\x13\xB7\x48\x58\xEA\xEF\x9C\x36\x14\xC7\xAA\xB4\x68\xC1\x70\x42\xE4\x26\xD0\x86\x3E\x81\xDE\x92\x8F\xCA\x8A\xEF\xE9\x2C\xED\x61\x46\x10\xFD\x02\x4F\x04\xEF\xE6\x4F\x02\x85\xB3\x00\x60\xF7\x1C\xDD\x17\xA6\x8D\x7A\xEA\xD6\x70\x19\x6E\x31\xFE\x27\xA1\x5E\x94\xCB\x9E\x91\x2B\xEF\x33\xD7\xE9\x2A\x31\xBF\x55\x17\xE7\xF6\xA9\xB4\x7D\xE3\x1D\xE1\x3E\x36\x28\x88\x64\xEE\xEF\x0A\x39\x1D\x91\xFD\x5E\x8D\x97\x6E\x40\xB8\x51\xE6\x49\x4D\x0C\xCB\xFD\x50\x07\xD2\xF1\xA4\x9F\x36\x56\xA6\x95\x88\x31\x19\xFF\xB9\xAB\x00\xD5\x9C\x06\x1E\x01\xBC\x42\xD4\x5F\x97\x93\x05\x90\xA9\xD9\x1F\x6D\x25\x5E\x07\xF5\xD0\xA9\x1D\xCF\xFA\xD2\xEB\x1C\x54\x38\x78\x58\x26\xF0\x2F\xBD\x3D\x7F\x84\x9A\x8C\xCA\xDC\xE3\x27\xC4\xC8\x9D\x62\xAE\xD1\x2C\x3B\x6C\x49\x68\x02\x5D\xAB\xC2\xD7\x9C\xA8\x58\xB1\xD7\xDC\xED\xFB\x23\x7E\x64\xDB\x49\x2F\x38\xBC\xA5\x19\x3D\x66\xC6\x92\x66\xD0\x44\x8E\xE8\xF4\x2B\x10\x6B\x2F\x6E\xC3\xD3\x68\xCC\xCB\xB0\xF5\x41\x03\x12\xD7\x78\x75\x80\xB9\x7C\x4B\x43\x91\x38\x34\x09\xAD\x04\x2D\x47\x5E\x73\x46\xD7\x44\x02\x50\xE3\x9D\x9A\xA7\x08\x11\xEF\x94\xED\x1E\xDB\x19\xA8\x31\xA7\xE3\x1C\xEF\x23\x6C\xE6\xAC\xDC\xF7\xD8\x20\x0A\xD5\x6A\xAA\x61\x8A\x48\xBA\xEF\x23\x2C\x07\x6C\xA5\x63\x7D\xEE\x64\xC3\x8F\x1E\x64\x86\xF2\x7B\x7F\x6B\xB0\x79\xA6\x50\x4F\x56\x2A\x46\x52\x60\x58\x14\x06\xE7\xC5\x7F\x56\x66\x90\xD6\x5B\xEA\x0B\xC9\xCD\x06\x69\xDF\x86\xAA\xA1\x2D\x9E\x31\xB5\x3C\x4B\x74\xF8\x5C\x66\x19\x3E\x31\x34\xF8\x91\xE2\xD1\x02\xB7\x12\x35\x00\xD2\xC9\xAB\xD0\xBD\x45\x48\x3F\xE4\x4B\x40\xED\x14\x06\x98\x0D\xA1\xB7\x08\x1B\xB7\x53\x5E\xC5\x13\x3D\x3F\xA5\x81\x61\x0B\xE2\x83\x91\x38\x80\xA7\x7B\xF8\x99\x18\xCE\x10\x69\xD1\x90\x1E\x00\x3D\x93\x51\x67\xE8\xF7\x7F\xA7\x7E\xE4\x87\xB7\x15\x29\x68\xBF\x33\xD8\x5C\x9A\x94\x77\x6C\xF2\x88\x9D\x0F\xE6\x42\x24\xFE\x75\x38\x47\x53\xF0\xFB\x1A\xCC\xB8\xB6\x91\x3E\x1F\x6E\x0B\x37\x1F\x86\x1D\x7F\x8A\xA3\x4F\x40\x87\xD9\x6E\x39\x54\x49\x7F\x26\x98\x73\x81\x6E\x22\xF5\xE6\x9C\xB0\x04\x6E\x96\xE7\x10\x00\xEB\x4C\xDC\x2B\x33\xE0\xE0\x41\xAD\xCD\xBF\x1F\x7B\x25\xE4\x58\x47\x10\x95\x22\xBA\x2F\x02\x93\x67\xC2\x1D\xA5\x43\x19\x12\x44\x58\x1E\xDA\x1C\x00\x6A\x6B\xE4\xCE\x5E\x6F\x08\x54\xA9\xD7\x34\x62\x91\xC3\x27\xD6\xF5\x7C\x6E\xFA\x72\x19\x32\xE0\xD4\xC5\x4B\x00\x17\x9F\xE1\xCD\xE6\x20\x40\x1B\xD4\xF7\x02\x25\x98\x15\xAA\xBF\x61\xEB\xDC\x11\x98\xC7\xF6\xEB\x3E\xB4\xB7\xDC\x9E\x0E\xDF\xAF\x42\xBB\xFA\xEC\x2A\xA0\xA5\x64\xB3\x27\x7D\xC3\xD3\x81\xA3\xC6\x9D\x5C\xAA\xE5\x43\x5A\xE6\xFB\xFA\x5E\x56\x20\x0A\xFE\xA5\x33\x0B\x01\x50\x4E\x2A\x18\xEB\xBF\x64\x8A\x5B\xC6\x82\xCA\xE8\xFC\xB1\xEB\x2B\xA2\x56\x48\x79\x8F\x21\x91\x20\x3E\x1D\x3D\xB9\xEB\x0A\x60\x5B\xC6\x55\xC0\xC4\x13\x71\x7E\xD5\x59\x3D\x62\xEA\x02\x8D\x2A\x07\xDF\x6A\xA2\x61\x8B\x83\x2A\xB3\x10\x48\xFB\x47\x83\x65\x38\x42\xAD\x8C\xB6\x19\xFD\x4D\x3C\x4B\x9E\x26\x39\x31\xA9\xD5\x11\x15\xBA\xA2\x9B\xFA\x63\xA3\x33\xC6\x67\x57\xA8\xFD\x1C\x1E\x9F\xBB\x7A\x60\x98\xA7\xE7\x9A\x09\xDD\x21\xA8\xED\xA9\x91\xBD\xC3\x98\x0B\x38\xC7\xBD\xC8\x9E\xE2\x89\x4C\x3D\x93\x5A\x1B\x92\x26\x1D\x43\xCC\x90\x86\x58\x24\xAD\x73\x10\xAD\xF3\xD0\x8E\xDC\x16\x81\x7C\xBB\x5C\x4E\x98\xC5\x12\x11\x3A\x9C\x97\xD0\x0B\x88\x5C\x63\x7B\xB1\x3C\xFE\x70\xA9\x47\x32\x18\x86\xE5\x28\xF1\x2B\x6F\xA1\xDB\xD2\x57\x09\xCD\xEB\x60\x10\xDB\xD8\x96\xB7\xE2\x7A\xBC\x2A\x9B\xE4\xE3\x00\xB0\x7D\x46\x97\xA8\x84\x89\xDB\x16\xBA\xFD\xD1\xD9\x45\x16\x01\xB0\x10\x18\x80\x35\x30\x18\x7C\x2D\x95\xA4\x74\xE0\xF7\x3F\x76\xA7\xBE\x7E\xBE\xF1\xC2\xC1\x3F\xE8\x48\xF6\x8E\xE2\x5B\x21\xF5\xDB\x06\x39\x68\xDF\x33\x3B\x0B\x66\xE6\xF3\x78\xDE\x5F\xD8\x1A\xD2\x93\xCB\x94\x9A\x25\x9D\xB6\xEB\xAA\xD3\x97\x39\xE9\x9F\x17\x6D\xFA\x29\x59\x89\x4F\xB5\x8D\x58\x7A\xBF\x54\xFC\x27\xF6\x32\x2D\x43\xAD\xFD\x33\x8B\x5F\x08\x01\xA5\x31\x79\x8C\xD3\xFF\x8A\xDC\xE7\x09\xCE\xF5\xBA\xAF\x34\xBC\x1D\x88\x87\xC6\x6D\xD0\x05\x61\x14\x26\x78\x68\x05\x26\x90\x9D\xFF\x2E\x9D\xA3\xF8\x2E\x2F\x07\x47\xBA\x81\xA5\xBE\x7A\xB1\xE1\xCE\x11\x28\x0C\xD5\xC8\x53\xC1\x22\x49\x19\x87\xA8\x52\x48\x9A\x85\x62\x8A\x62\x24\xE5\x96\x68\x12\x5E\x96\x0B\x79\x13\xC2\x45\x2B\xF7\xF0\x0E\x5C\x45\x7E\xE6\xDF\xBA\x3E\xF2\x0E\xBC\x6A\x8E\xD3\x38\x03\x72\x05\xBB\x5A\x29\x07\x78\x66\x6A\xB0\x73\xD0\xF2\xD1\xD9\xB5\x36\x7A\xE9\x19\x1E\xAF\xC3\xBA\xE4\xDD\x60\x7F\xAC\x80\xAE\x83\x65\x77\xC3\x95\xFB\x95\x9B\x1E\x01\xA1\x12\xE4\xB2\xE8\x69\x6A\xB2\xEB\xA4\xDF\x45\xFE\x86\x2F\xF0\xEB\x94\x73\x01\x9F\x6B\x60\x9F\x3A\xFC\x10\x40\xBB\xB4\x0C\x51\x4B\xE5\x82\xED\xF8\x3E\x77\xC8\xCE\xA9\xF6\x05\xEB\x20\xD2\xB4\x1E\x59\x81\x82\x36\x23\xA4\xF3\x2D\x3B\x37\xFB\x93\x7A\xB2\x2C");

        // Adding new values to the cart array
        $cart->gift_code = $gift_code;
        $cart->coupon_code = $coupon_code;
        $cart->coupon_type = $coupon_type;
        $cart->coupon_value = $coupon_value;
        $cart->referral_code = $referral_code;
        $cart->price = ItemsController::applyVatToValue($cart->price, $ip);

        $items = [];

        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x44\xCF\x11\x3F\x64\xDD\x12\x10\xF4\x71\x9B\xAE\x08\x01\x78\xB3\xBF\xD1\x74\x5E\x54\x4A\xB7\x7E\x6B\x87\xBD\xFD\x84\xB2\xE4\x65\xCE\x39\xE2\x7A\xF7\x0C\x28\xD0\xCF\xF1\x6D\xAE\xCC\xC1\xBD\x86\x52\xEA\xE4\x68\x3C\x90\x93\x84\xA5\x32\x04\xB9\x6A\xF2\xAC\x73\x2A\x1B\x7A\x0C\x83\xE9\x1E\x5E\x31\xB6\x7C\x77\xBE\x14\x6D\x17\x04\xA0\x79\x25\xCD\x65\x81\x34\x35\x55\x6D\xCF\x28\x38\x92\xB0\x44\x87\xF9\x8C\x5F\xF5\xB1\xDD\xA6\x33\xA0\xFE\x7D\x71\x96\x21\x71\x29\x0C\x23\xFA\xB7\x3C\xC8\x7D\x71\x5D\xF0\xBD\xCD\xF8\x9A\x4B\xE3\x72\x64\x63\xCE\xCA\x76\xB9\xBC\xFD\xC8\xFA\x90\xCA\x4F\xF8\xAF\xB7\x52\x17\x45\x44\x00\xF3\x79\x2D\xFA\x45\x20\x9E\xFB\x7F\xC4\x55\x2A\x7D\x55\xCF\x43\x0C\x80\x1D\x8B\xD8\xD3\xCF\x8B\xAF\xDE\xFE\x01\x74\x09\x77\x90\xA1\x7D\xB8\x06\x6C\xA0\xC9\x45\xDF\x03\xF3\x7F\x93\x6F\x0C\xC1\xCE\xD0\x5A\xCD\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xB0\xC2\x56\x57\xCC\xF7\x0D\xB0\x43\xBF\x61\x04\xA4\xB0\x0F\x4C\x4A\xA1\x96\x16\xC4\x6A\xE9\xF4\x74\xC5\xE8\x78\xE7\x55\x22\x30\xB1\x5E\x96\xF6\xB7\x5B\xBD\x4F\xE2\x4A\xF2\x5C\x9D\x3C\x74\xEC\x75\xA7\x18\xE2\xA7\x1A\x28\x6F\xC1\x1A\xEC\x47\x78\xF9\x71\xC5\xB3\x4F\x00\x16\x32\xF0\xA2\xEA\x53\x54\x78\xBF\x26\x22\x89\x7A\xBE\x27\x16\xBD\x0A\xB9\x47\x33\x0A\xB1\xF4\x5F\x62\x30\x82\xB7\x4E\x9D\x1B\x38\x61\x7B\xEB\x2A\x2B\x9A\xA2\x76\x9E\xD6\xA9\x12\x0C\x59\x14\xAE\xF3\xF1\x94\x3A\x7E\x66\x0A\x54\x65\x02\x50\xB9\xE7\xD3\xB5\x8D\x95\x31\xE1\x93\x32\xE3\xF8\x19\xE7\xB6\xE9\xEF\x84\x36\xB2\x1B\x03\xF2\xD0\x3F\xCA\x4B\x6C\xCA\xC8\x77\x91\x93\x92\xEE\xCD\xF6\xEF\x5B\xC3\xA9\x09\xF0\xFF\xCE\xFA\x5B\x0A\x8C\xC8\x64\x38\x9F\x78\xFF\x78\xD5\x10\xA5\x6D\xDC\x93\x02\x2D\x14\x32\x95\x8F\xD2\x18\x48\xD4\xB5\x21\x86\xD2\x16\x9A\x66\x1C\x24\x34\x5F\x8A\xB0\x6E\x5E\xE2\x28\xDC\x9B\x9C\x1F\x7D\xD2\x98\x8F\xA7\x81\x5C\x07\x7B\x7B\x23\x5C\xF7\x95\x55\xF5\xBE\x2C\x03\x4A\x9A\xE7\x8F\xAE\x12\xF9\xB3\x6B\xC6\xB7\xA2\xA1\x4C\xF1\x18\x7E\x4F\x72\x55\x8E\x95\x4E\x38\x87\x3A\x2A\xF4\x1D\x0A\xC3\x99\x0E\x1C\x08\x3A\x3B\x78\xF7\x90\xF1\x46\xF3\x5E\x2F\x8E\xE7\x47\x0E\x8A\x8C\xC5\x44\x3A\x87\xB7\x6A\x53\x26\x30\xA1\xCF\xF2\x29\x27\xFA\xA8\xF9\xAE\xE8\xFA\xE2\xE0\x5D\xAE\x40\x4E\x31\xE9\x34\xAD\xE1\xDB\xE6\x49\xA9\xA6\x35\x1F\xD4\xBA\x9C\x8B\xE6\x91\xE1\xCF\xD4\x2C\x35\x0B\x8B\xF0\x6A\xF5\x06\x22\xA0\x65\x45\x88\x06\x05\x45\xCD\x10\x5D\x21\xBD\x6B\x52\x9A\x8C\xD6\x31\xDA\xDD\x2D\x2A\xAF\x7C\x11\xC6\xA1\x5D\x98\x67\x28\xF6\x84\xE6\xFF\xE5\x19\x48\x43\x2B\xF6\xB3\x02\x24\x29\x51\x05\x93\xE5\xF9\xE0\x18\x79\x9A\x37\x5F\x7D\x2A\x56\xFE\x29\x37\x17\xB2\xAF\xB1\x82\x93\x47\x8B\xEF\x91\x5D\x64\x4E\x6A\xE9\xAF\x38\x9E\xA1\x1D\xFA\x6C\x0C\x43\x29\x77\x42\x2E\x4A\x30\x52\xC0\x36\xCF\xF4\x86\x9D\x9C\x42\x54\x62\x89\xBC\xAE\xE4\xF3\xDE\x87\xAD\xC9\x98\x9A\xEA\x78\x9B\xD8\xD1\x3E\x66\x0E\x7C\x3B\x90\x33\x94\xAC\x29\x7D\x0E\x00\xC0\x5F\xBC\xEE\x6E\x91\x6A\xE9\xA7\x8C\xDA\x98\x5D\x02\x23\x75\xB6\x18\xC9\x9A\x12\x96\x85\xC4\x95\x90\x89\x04\xC3\xB2\x4C\x19\x37\xC1\x68\xF3\xF5\x76\x4F\xFC\x68\x4A\x84\xFD\xE5\x82\x1A\xDA\xBB\x07\xB4\x50\xD2\xD8\x45\x2E\x30\xD2\xA3\xF7\xD7\x7B\xED\xBD\x1D\xA9\xDE\x85\x8F\xCE\x31\xD3\xA9\xD0\x01\xA4\xBE\x79\xC3\xF6\xB1\xA8\x55\x6D\x82\x60\x73\x4B\x0D\x43\x15\x57\x23\xA1\xE0\x7A\x76\xEE\x3D\x95\x73\x4A\x54\x7A\x8F\xF2\x94\xD1\x3D\xE3\xD5\xC5\x9F\xE9\x2B\xCF\xBD\xED\xA2\x4F\x72\x45\xE6\x9A\x8A\x1B\xC6\x5A\xA9\x86\xCB\x13\x3E\x10\x7F\x05\x99\x6F\x94\x59\xAA\xE8\xDA\x0E\x4A\xC8\x5A\xD6\x42\x60\xFB\xF3\x82\x53\x52\x4F\x05\x5E\x7C\x01\xB5\x0F\xFE\x0A\x2A\x8E\x41\x3E\xD9\xD1\x35\x34\x39\xC3\x47\xAD\x16\xBB\xB1\xA4\x33\x5B\xD5\x8F\xF2\x7A\xFD\x21\x77\xB5\x60\xB2\x58\x80\xDC\xA4\x34\x05\x85\x1E\x15\xD7\xB6\xAC\x46\xBF\xA0\x56\xEE\x4C\xF6\xE7\x18\xA9\xD5\xD9\xD6\x1F\x8C\x4E\xE8\x4F\x70\x20\xE0\x26\xA8\xCE\x38\x21\xEB\x36\xD1\xF3\xEE\x49\x89\xAD\xD2\x63\xA4\x00\xF4\x19\x89\x4F\xAA\xD8\x2F\x6F\xAD\xEC\x69\xE1\x9F\x91\x06\x69\x95\xED\x48\xEF\xF9\xA1\xE0\x5E\xCA\x93\xFA\xB1\x92\x1C\xB6\x17\x8A\x5E\x86\xB8\xCF\x2B\x44\x4D\x24\xA3\x9C\xE4\x51\xC0\xB7\x9F\x1E\xD6\xF8\xBD\x14\xD2\x31\x81\xB9\x6B\x47\x1A\x6A\x21\x19\x04\x0C\x01\x4D\xA0\x9D\x47\x11\x5D\x94\xF5\xD0\x85\x3E\xCD\xD5\xA3\x9D\xED\x85\xB3\xFC\x41\x8C\xAA\xBF\x0A\x12\x59\xBF\xB5\xB9\x4C\x02\x61\xEF\xC4\x93\x30\x3B\x1D\x51\xC1\x2E\xE3\x6D\x9F\xB8\x65\xB2\x70\x03\xCC\x1C\x30\xF2\xA9\x51\xC4\x84\x9E\xC5\x04\x9F\x8E\x17\x1A\xB0\xD1\x4C\x26\x95\x38\xEE\x24\xE8\xB7\x5E\xDE\x2F\xA9\x88\xFD\xCD\x04\x80\x4A\xC3\xE4\x6A\xB9\xEF\xDD\x88\x05\xC2\xF5\x70\x28\x28\xA0\x04\xA2\x09\x7C\x4B\xAD\xE1\x36\xF9\x25\x48\x2F\x50\xE2\xDA\x28\xCD\x47\xF0\xCF\xC5\x9A\xBC\x89\xC1\x97\xB8\xCA\x8C\x11\xB1\xF4\x7A\x0C\x48\xD7\x40\x0A\x2F\xA5\xE1\x72\x46\x49\xE3\x0B\xEB\x71\xDA\xEA\x6A\x55\x99\x53\x04\xD4\x67\x8F\x44\xBE\x3D\xBC\x36\x4C\xDB\x06\x22\x10\x69\x24\x2D\x63\x74\xDB\x01\xCE\xED\x3E\x03\x9B\xB3\x6E\x19\x40\x4B\x67\xAD\x88\xAB\x3A\xC6\xA5\x28\x2C\x58\xDE\x2D\x57\xCE\x91\xEE\x3B\xA6\x18\x91\xAA\x80\x35\x34\x89\xEA\xD8\x61\x04\xB3\x85\x90\x8A\xD7\x04\xD2\x22\x80\x80\x46\xDE\x40\xB8\x40\x27\xF5\x23\xB0\xD6\x8E\x8A\x13\x80\xF6\x29\x47\xE5\xE7\x0E\xF2\x7C\x5B\x99\x47\xBE\x62\x12\x08\x5E\x94\x7A\x96\x03\x47\xF4\x50\x23\xAB\x2A\xFC\xBF\x6F\xF9\x55\x3D\xC7\x7F\xD7\xC8\xEA\xF5\x0D\xFE\xFE\x58\x23\x24\xDE\x10\x4C\xCC\x8E\xC9\x74\xFC\xEB\x9F\x58\x3A\x18\xA5\xAD\x96\xC2\x17\x9E\xBE\x28\xA4\x47\xD1\xF0\xDD\x5E\x79\x8B\xA7\xEE\x25\x2C\x1B\x6F\x7A\xAC\x5F\xFB\x9B\x44\xEC\x2A\x07\x2F\xFB\x7C\xA7\xC2\x41\xE0\x97\x94\x8D\x33\x1B\x90\x24\xB8\x11\x0F\x30\x6E\x42\xDE\x20\x36\xD3\xCA\x05\x83\x9B\xDF\xA3\x52\xB3\x85\xEB\xF8\x6E\x0E\xB0\xB2\xEC\x23\xC6\x27\x3F\x63\xCC\x1F\xE0\xE8\xD1\xF5\xF8\xC7\x92\x26\x1C\xBC\x6E\x49\x83\x86\x04\xED\xFC\xDF\xB4\x52\x5A\xE1\xCB\x77\xDB\x43\x4E\xF6\x6C\x94\x13\x50\x03\x21\xE9\x85\x0B\x62\xC7\x28\x88\xF5\x82\x2C\xF2\x4D\xAD\x39\x3D\x92\xCE\x34\x3E\x8A\x21\x8B\x58\xEA\xE7\xBA\x9C\x1B\xE8\xBA\x55\x19\xD7\x91\x00\x49\xB3\x5E\x50\x54\x3D\x1D\xAC\xEE\xEF\x0C\x9E\x04\x3A\x44\xF1\x36\x97\xD4\x2A\xE3\xBA\x5B\x06\xAA\xF2\xCC\x83\xCF\x25\xD0\x72\xEC\x35\x75\xEA\x00\x66\xFE\xA1\xA0\x71\x7A\x8A\xE6\xAC\xDA\x86\x9F\xCB\x52\x30\x95\xA2\xD6\xBD\x25\x22\x9F\xCE\x13\x1D\x0A\x42\xC4\xF2\x8C\x49\xA0\x88\xF0\xA8\xE6\x91\xF8\x6F\xA9\xA0\xA6\x97\x87\x66\x46\xBF\x2D\x99\x62\x1A\x92\x2F\x53\x4C\x91\x54\xA1\x3C\x7B\x93\x21\x5F\x83\xCD\xC6\xF4\xE2\x55\x1D\x48\xE9\x85\x81\x6E\xF4\x85\x8A\x27\x3C\x3E\xCF\x74\xC4\x0D\x24\xD3\xC9\x81\x42\x22\x1D\xA0\xF9\x91\x4F\x56\x10\xFB\x78\x05\x8B\xA5\x7D\xA8\xE7\x3A\x95\x07\xC8\x71\x64\x0A\xF4\x48\x0B\xAD\x57\x25\xD9\x70\x3B\xE7\x26\x2D\xB0\x37\x3D\x7C\x0E\xDF\xD6\x6E\xAA\x45\xB7\x43\xC9\x1B\x28\xDE\x63\x3A\xF0\x78\x41\x43\x6F\x56\x39\xE4\x72\x7B\x94\x9C\xF8\x4F\xE6\x42\x93\xE8\xFD\x04\xDE\xE6\x9C\xBE\x29\xC7\xA8\x25\x24\x62\x27\x64\x5B\x36\x5F\xB2\x5F\x6B\x05\xEB\x57\x79\xC4\x36\xD3\x38\xF8\x8E\x8D\x2C\xDC\x05\x22\x8D\x6A\xB5\x8B\xEC\xD3\x42\x10\x69\x7D\xF5\xCB\x45\xAB\x9E\xEA\x22\x3A\xCF\xFD\xC1\x9F\x1E\x1F\x81\xF1\xEE\xA1\xF0\xDB\xD5\x54\x74\x78\x23\xDA\x3F\x20\x88\x6B\x36\xE0\x9A\x9C\xD3\x02\xC2\x2F\xE5\x1B\x61\x3D\x7A\xF7\xD1\x2B\xF0\x45\x90\x7E\xFF\xD9\x78\xEF\x64\xBA\x5E\x1A\xB6\xD3\xAF\x97\x45\x88\x24\xDE\xFA\x30\x23\x6C\xE0\x8C\xB1\x85\xD7\x4A\x30\x68\x43\xC7\x3B\x2C\xD9\xBC\xF0\x5A\x77\x02\x74\x25\x87\x96\x3B\xE7\x27\xAF\x5E\x2B\xE0\xD3\x2C\x81\x14\xEE\xD9\x5F\xDF\xB0\xC2\x3E\x0D\x61\xEB\xDE\xA8\xED\x7E\xCD\xCA\xBB\xD9\x1C\xF4\x08\x91\xE3\x86\x24\x5B\x35\x58\xD8\x75\xE8\x8D\x04\xA3\x71\xF7\x61\x4F\x9F\xF0\x4C\x52\x58\x10\x49\x26\xCE\xF9\xE0\x98\x98\x20\xB1\xA2\x2D\xFA\x3A\x3F\x72\xF8\xFD\x47\xFC\x75\x20\x45\xB9\x44\x42\xEE\xA8\x8D\x36\x0F\x8E\xE1\xB4\x73\x99\x3E\x5B\xE3\x0B\xCD\x97\x76\xE7\xA1\xC2\xDD\x83\xC9\xAA\xF2\x06\xC7\x61\x46\x10\xFD\x02\x4F\x04\xE2\xF8\x18\x4A\xC0\xE5\x0C\x3B\x8F\x0D\xD6\x1A\xB5\x98\x76\xE2\x90\x3E\x55\x3B\x38\xC9\x27\xE7\x1F\xD8\x98\xDB\x8A\x01\xC5\x33\xD7\xE9\x2A\x31\xBF\x55\x1A\xF9\xB0\xE0\xE6\x2A\xF4\x54\xBC\x60\x5B\x4D\xDA\x3D\xEE\xF2\x0A\x58\x4D\xC1\x81\x33\xC2\xD3\x62\x4A\xEB\x25\x81\x4B\x56\x1C\xDC\xFD\x4C\x57\xC8\xB0\xD9\xD7\x73\x04\xE3\x9D\x8F\x78\x5D\xF8\xB5\xAB\x04\x85\xCE\x49\x5A\x50\xBC\x59\x8C\x11\x9B\x9C\x2E\x96\xA1\xD2\x08\x34\x47\x17\x47\xBF\x92\xE2\x0B\xC9\xE6\x8C\xA1\x5A\x1C\x6E\x17\x69\x0C\xF0\x2F\xBD\x3D\x7F\x84\x9A\x8C\xCA\xDC\xE3\x28\xCB\xC8\xF5\x23\xE4\xD6\x2F\x2B\x3C\x45\x73\x30\x5C\xBE\xD3\xC6\xD5\xE3\x1D\xB5\xD7\xD2\xEC\xEE\x2B\x7F\x3B\x9C\x1D\x3B\x27\xBD\xFB\x19\x3D\x66\xC6\x92\x66\xD0\x44\x8E\xE8\xF4\x2B\x10\x22\x69\x6E\xCB\xD3\x68\xC2\xCA\xA5\xFD\x40\x2E\x1D\x96\x32\x26\xC5\xBD\x22\x0A\x13\x97\x30\x2E\x0B\xBB\x47\x3E\x10\x49\x45\x56\xC1\x46\x02\x52\xF6\xD2\xF9\xF1\x4D\x11\xF2\x89\xED\x0F\xD2\x19\xF3\x1B\xA7\xBE\x1C\xAA\x6F\x3F\xA3\xAC\x87\xDD\xD8\x20\x0A\xD5\x6A\xAA\x65\xC9\x09\xEE\xAA\x64\x63\x55\x35\xCC\x33\x7B\xE2\x65\x97\x9F\x00\x50\x86\xE6\x46\x46\x61\xFC\x47\xC0\x03\x33\x3F\x7E\x03\x1F\x7A\x42\x47\x43\xAB\x80\x3C\x02\x6E\x99\xDB\x45\xBD\x43\x8B\xDC\x0C\x34\x88\x8A\xA5\x8A\x21\x9D\x79\xE7\x78\x2A\x3D\xF2\x0E\x26\x55\x36\x4B\x66\xB7\xD5\xB7\x92\x56\xBA\x0C\x76\x41\x86\x8C\xEC\x9F\xEF\x1C\x37\x76\xA0\x42\x4A\xB0\x1C\x16\x9C\x4A\xE6\xD3\x71\x4E\xFA\x54\x5E\xD8\x0D\x3D\x2F\xA9\xAB\x61\x0B\xE2\x83\x91\x38\x84\xE4\x2E\xB5\xCC\x54\x8F\x44\x20\x87\xA8\x74\x5A\x43\xFC\x16\x28\xBA\xAE\x16\xF3\x3B\xA9\xD4\xB7\x08\x29\x2B\xF0\x7F\x94\x1D\x8D\x88\x36\x3B\xBC\xD7\x8A\x0B\xED\x4E\x23\xEB\x5D\x38\x47\x7D\xE2\xA0\x43\xDA\xEC\xB9\x85\x2F\x00\x6F\x17\x54\x5B\x81\x14\x72\x94\xF7\x00\x21\xD5\x8B\x2F\x60\x01\x6A\x64\x0C\xB2\x73\x81\x6E\x22\xF5\xBB\xB6\x9A\x04\x6E\x96\xE7\x10\x00\xEB\x4C\x9A\x62\x33\x8F\xA1\x56\xEC\xDE\xA7\x5E\x65\x32\xEC\x47\x5E\x2A\x92\x32\xE9\x2E\x59\xC1\x35\x8C\x0A\xAC\x43\x5F\x5C\x58\x37\x5A\xDA\x5F\x41\x3E\x2E\xA3\x81\x0C\x36\x08\x12\xE2\xC2\x7D\x70\x8D\x8A\x69\xD6\xC1\x7F\x7B\xD4\x35\x56\x76\xA5\x98\x96\x37\x67\x5E\xD9\xB5\xD7\xFC\x77\x08\x5E\x86\xB6\x5A\x77\x83\x12\xE5\xF2\x32\xAA\xDB\x39\x9E\xD6\xB6\xA6\x79\xE0\xF1\xE1\xAD\x0B\xCE\xEB\x21\xF5\xBB\xB8\x6F\xDC\xD6\x31\xE3\x77\x32\x91\x87\xFD\xC5\x87\xDE\x10\xF0\xF7\x58\x63\xD0\xDC\xE8\x43\x46\x24\x04\xF7\xB4\x7E\x48\x45\x1D\x1C\x6E\x6E\x88\xEB\x21\xC7\x08\xC1\x8B\xE0\xE8\xFC\xB1\xEB\x2B\xA2\x56\x48\x79\x82\x3F\xD7\x69\x6C\x4E\x69\xB1\xE2\x11\x4A\x7C\xD8\x1F\x8F\x8D\x5D\x79\x79\x96\x18\x6F\x36\xB9\x4C\xC7\x2A\x08\x98\x6C\xB9\x73\x8C\x84\x63\xAC\x3D\x44\xFB\x40\x9E\x62\x34\x42\xAA\xCF\xF7\x4B\xA9\x32\x75\x1F\xDB\x6F\x2D\x76\xAC\xC0\x3C\x02\x8A\xAF\x9A\xFD\x77\x89\x37\x81\x2E\x11\xFC\xF0\x02\x50\xDE\xF6\x3F\x7B\xB2\xA7\xE7\x9A\x09\xDD\x21\xA8\xE0\xB7\xDB\xF2\x8A\x8B\x03\x7A\xDB\xAF\xD4\xD3\xFC\xED\x18\x6E\x94\x56\x1B\x95\x76\x5C\x1A\x81\xD5\xC8\x0C\x77\xA3\x30\x55\xBC\xE6\xFD\x93\x95\x0F\xD8\x2C\xF8\x00\x1D\xD1\xCD\x6E\x78\x7B\xCE\xC3\x83\x05\xC1\x18\x64\x72\x9B\x3C\xFE\x70\xA9\x47\x32\x18\x86\xE5\x28\xF6\x6C\x26\xE7\x8F\xAD\x1E\x4D\xCA\xEB\x70\x10\x91\xD9\x8A\xB5\xA6\x71\xDF\x7E\xDE\xA9\xB0\x07\xBC\x7D\x41\xDE\xFC\xC1\xC4\x88\x18\xF3\xB9\xD6\xD5\x45\x11\x1B\xF0\x55\x5E\xD3\x09\x22\x1F\x65\x55\xDC\xED\x2F\xAD\xB4\x1B\x3F\xF3\xFB\x33\xC1\xB8\x86\xC6\x36\xC2\x48\xF6\x8E\xE2\x5B\x21\x88\xD2\x1D\x13\x42\xDF\x33\x3B\x0B\x66\xE6\xF3\x78\xDE\x52\xC6\x49\x97\xDF\x8E\xD7\xCA\x79\xAE\xD5\xB8\xA7\xCD\xD4\x78\xA5\xDC\x42\x21\xBB\x7D\x1C\xEA\x0E\xE7\xD9\x50\x7E\xFC\x15\xAE\x73\xFF\x29\x00\x0A\xF9\xB8\x7E\xD8\x51\x02\x06\xA9\x1B\x79\x8C\x8E\xD5\x8A\xDC\xE7\x09\xCE\xF5\xBA\xAF\x69\x96\x37\x88\x87\xC6\x6D\xD0\x05\x61\x14\x6F\x57\x24\x41\x77\x9E\x95\xE3\x3B\xC4\xF8\xD6\x18\x3C\x12\x45\xA7\x92\xBD\xC2\x1D\xED\xBF\x8F\x1B\x38\x13\xE5\xA5\x31\x80\x12\x1B\x58\xD0\xA0\x55\x01\xCE\xC0\x2F\xD9\x6C\x74\xB3\x8D\x6E\x11\x1B\xC9\x59\x30\x57\x8B\x0C\x6E\xDB\xF3\x50\x64\x61\x62\xE1\xD5\xA3\x23\xDA\x7C\xF6\x2C\xFC\x8C\x6C\x4F\x68\x15\xEC\x5B\x38\x10\x70\x3D\x63\xA9\x65\x9E\xBD\x94\xD4\xF6\x36\x7B\xBD\x57\x41\xB1\xC5\xA9\xED\xCE\x66\x7B\xA4\xF6\xF3\xCF\x6A\x7D\xD4\xC1\xA6\x91\xB8\x05\x2B\xA1\x12\xE4\xB2\xE8\x69\x6A\xB2\xEB\xA4\xDF\x45\xFA\xD4\x6A\xB6\xAE\xC6\x21\x40\xD3\x14\x24\x99\x2A\xFC\x5D\x0E\xB5\xE0\x0C\x5D\x4E\xE5\xD0\xFE\xEA\x72\x35\x84\xC4\xA1\xFB\x0E\xB1\x46\xAD\xE4\x4C\x10\xC2\xC7\x31\x09\xF9\xD9\x2D\x3B\x37\xFB\x93\x7A\xB2\x2C\x5A\xFD\x9E\x4E\x9E\x5F\xEC\xB4\xE0\xB8\x76\x5A\x71\xC7\xCB\x9D\x17\x3A\xD4\xFC\x34\x5F\xB5\x40\x30\x78\xFE\xA2\x1A\x6F\x4C\x3F\x05\x0D\xD9\x1A\xFC\x39\x74\x90\xDA\xBB\x7C\xA9\xBD\x13\x49\xA2\x2E\xCA\xC7\xBE\xA9\x31\xCD\xE2\xA1\xC1\x66\x21\x0A\xCF\x6A\xA6\x2E\xFE\x0D\x71\xFF\xE5\x8B\x88\xF4\xA2\xC8\x94\x9D\x1F\xC1\x85\xC0\xDF\xA0\x1A\x80\xAD\xC9\x02\x78\x70\xED\x70\x52\xEC\x86\x4A\x7A\x46\xE1\xC2\x18\x29\x76\xBB\xE8\xBF\xDA\xCA\x41\xCA\x83\xE3\x34\x7A\xFD\xFF\xF3\x7F\x7E\x02\x0F\x99\xE5\xA2\xC4\xD5\x3A\x47\x3B\xC6\x47\x43\x08\x4D\xF5\x2B\xAA\x17\x6E\xC0\x22\x04\x63\xED\xA4\x9B\x16\x90\x7F\xF4\xE4\xE0\xFC\x04\x59\x34\xE3\x7E\x33\x49\xF0\x15\xAB\xA5\xB7\x53\x37\xB8\x91\x7E\x76\x30\x0F\x79\xDA\xDD\x69\x43\xAF\x4D\x2E\x64\x4D\x99\xF7\x60\x77\x26\x4A\xEA\xFE\xC0\xE8\xC3\xE3\x11\xBD\xB3\x4A\x1E\x65\x88\x4E\x39\xE7\x78\x0B\xA5\x4E\xD5\xA8\xAB\xCD\x1D\x91\xA8\x71\xCA\x12\x19\x66\x12\x02\x5B\xFC\x63\x95\xF9\xE0\x11\xF7\x1C\xBC\x21\x42\xED\xEE\xCD\x46\x56\xFF\xB1\x60\xA4\x00\x71\x08\x4F\x35\x56\x22\x1D\x86\x45\xFD\x46\x7C\x7E\xE4\x41\xD6\xBB\x20\x5F\x16\x02\x62\xE1\x96\x16\xB3\x6F\x0B\x09\xC6\x57\xE5\xCD\xB9\x07\x72\xF1\xDE\x69\x99\x47\x28\x3C\x21\xA9\xDC\xB8\x7C\x9C\xCB\xD7\xC4\xEF\xC2\xE5\x6F\x24\x85\x5A\xB0\x5C\x87\x55\x3A\x0C\xDA\x31\x71\x0D\x63\xF0\x3B\x68\x3D\x59\x3D\x9F\xF0\x4B\xE5\xC9\x58\xC8\x80\x29\x36\x72\xE2\xAA\xEE\xEF\x99\x72\xCA\x61\x7D\x79\x51\xC4\xFA\x35\x4B\x71\x1F\xE7\x49\x80\x90\x93\x16\x49\xE7\xB6\x4A\xFC\x27\xB9\x7F\xA4\xC9\x4C\x1F\x55\xCD\xE2\xA8\x93\xC6\x2F\x99\x05\xC4\xCA\xB7\xCE\x31\x0A\xD3\xE9\xCC\xA9\xAE\xBC\x9F\x6B\xCE\xDB\x41\x09\x3E\xC9\x9A\xB5\xE3\x82\xF1\x2A\x10\xFF\xC2\xB7\x29\xDA\x89\xB7\xF3\x5F\x9D\xE3\x5B\xCD\xE4\x9C\x28\x27\x35\x17\x87\x47\xC6\x11\xFE\x9A\xE9\xF9\x8B\xEF\x14\xDF\xDE\xF3\xDC\x03\x28\xE7\x02\x5D\xB5\x0A\xBD\x18\x67\x1A\xD3\x1F\x6E\xE0\x98\xDF\x75\x08\xE1\xD8\x8D\x8B\xD6\x5D\xE7\x79\x0C\xC3\x12\x81\x9A\xEC\x19\x55\x8C\x79\x1D\x2F\x91\xFA\x57\x7B\x6D\x23\x85\xD6\xA5\x50\x86\x77\x56\xCE\xA6\x8B\xDA\x8F\x0A\xCA\xAF\x91\xF6\x52\x37\x70\xEF\xBF\xDB\x13\xE5\x1F\x7F\xF5\x12\xE3\xE5\x75\x32\x19\x1B\x53\xF0\xBB\xC4\x3F\x05\xA2\xB5\xA4\xE1\x57\x42\x83\xDC\x18\x8E\x82\x6E\x66\x58\x0D\x3F\x1B\xCB\xA9\x81\xFD\xD3\xE5\x0B\xE3\xA1\x32\x1F\x43\xE1\x27\xD9\xC9\xC9\x20\xB0\xD8\x15\x55\x69\x40\xBB\xB4\xF2\x54\x2A\x82\x96\x05\x0E\x86\x0F\xDD\xAB\xB5\x8F\x62\x31\xBF\xE1\x86\x97\x8C\x8A\xC1\x20\x94\xDB\x58\x7B\xEE\x08\x96\x73\x97\x2D\x39\x85\x2D\x0A\xB0\x24\x40\x52\x08\xEE\x0C\x5B\xAE\xC9\xAA\x8B\x1D\xE6\x34\x86\xCD\x75\x06\x2D\xAE\xAF\x45\x08\xA1\xE5\x6D\x55\x4F\xAF\xC4\xBB\x0C\x84\x92\x33\x86\x65\x5B\xD7\x1E\xB3\x04\x14\x9F\x0C\x9B\x1D\x0B\x77\x46\xB8\x6E\x6C\x26\xDC\x6D\xF4\x6D\x9A\x80\x18\xF0\x6A\x8F\xA5\xDA\xB3\xE3\x51\x55\x2C\x36\x53\x9D\x5E\xF2\xF1\x74\x22\xFC\xB8\x8F\xEC\xF9\xC3\xD8\x0A\x37\xE0\x93\x39\xDC\x82\xE0\x10\x0A\x15\x00\xCE\x50\xCD\xC6\x9C\x9D\xB6\x3F\xEB\x07\xDA\xBF\xCF\xEE\x32\x8A\xA6\x95\xC6\x9B\x10\x65\x04\xB7\xB9\x23\xE6\x57\x0A\x3F\x7A\x15\x44\xA0\x0E\x32\xB4\x88\x4C\x89\x46\xD3\x95\x01\xD7\xCF\x5E\x23\xE8\x9E\x1B\x9B\x00\x03\x16\xA2\x23\xCF\xD8\x73\x13\x80\x65\x8B\xE9\x80\x73\x95\x53\x7D\x60\x10\xB5\x77\x2D\xE5\x45\x97\x61\xC9\xE3\x8F\xB0\x1F\x84\x27\xDA\x69\xDC\xE7\x6E\xD5\x1C\xD2\xA5\x77\x0C\x2F\x95\x79\xFE\x2C\x42\x98\x37\xED\xDF\xB5\x23\xA4\x18\xCD\xE9\x87\x33\x1C\xDC\xA3\x2B\xCF\x85\x5D\x30\xC6\x27\xF0\x1E\x7E\xCA\x4C\x58\x36\x6C\xDD\x47\xCD\x2D\x3A\xFF\xBB\x5D\x00\x3E\x2B\xF0\x96\xE2\xF7\x88\xE0\x1E\xD5\x66\x24\x30\x7E\xC8\x16\x36\x8A\x79\xD6\x5D\xA2\x81\xC3\x05\x2B\x97\xEB\x3A\x4E\x00\x11\x09\xBE\x56\x68\xB6\xE2\x3C\x8D\x0C\x1A\x8F\x87\x37\x57\xE3\xF6\x57\xDC\x73\x35\x7A\x9C\x42\x74\x40\x56\x15\x44\x92\x56\x72\x82\x3A\x10\xDA\xDC\x91\x3D\x0D\x95\x85\xDD\xD9\xD3\xC3\x20\x0B\xF3\x18\x7D\x94\x18\x02\x94\xBD\xAF\x5D\xD2\x6B\xB8\xB8\xD2\xA4\x9F\x3C\x88\x0C\xA2\x41\xFF\xF7\xC0\xAE\x27\x72\x5B\x71\x9A\x58\xC6\x9C\x56\xF1\x78\x79\xA1\x11\xBC\xE8\x2D\x28\x2B\xE5\x9B\x1A\xEB\xD9\x21\xA9\xC7\x3B\xCC\x22\x6D\x37\x4B\xEF\x37\xEA\xA8\xF9\xC2\x17\x08\x8A\xD0\xA3\x5E\x29\x6A\x6F\x48\x25\x22\x35\x51\x9D\x93\x0B\xE1\x02\x7D\xFD\x10\xDD\xDD\x60\xC0\x8C\x37\xA8\xA5\xF3\x4F\x17\xF8\xBF\x25\xF9\x50\x0F\x85\xA7\x00\xB4\x50\x35\x7D\x08\x54\xBB\x40\x68\x25\x79\x1A\x1D\x7A\xF3\x1B\xC9\x36\x14\x1D\xE0\xC3\x9B\xD1\x91\xB2\x42\x01\xC1\x4E\x17\x87\x6F\xD6\x55\xC7\xA9\xE2\x0D\x26\x63\x74\x64\x63\xF8\x0F\x30\xA8\x9C\x38\xC9\xB9\x8D\xF7\xDA\xEA\x73\xE9\x2A\x28\xB4\x76\x83\x3D\x8F\xB0\xE8\x05\x99\x44\xCF\xD4\xBF\x9F\xFE\xAA\x45\xB8\x03\x66\xF2\xBA\xE7\x02\x4E\xA1\x98\x24\x34\xEB\x28\xDB\x39\x7F\x59\x78\xAC\xAE\x59\x00\xD6\x5D\x23\xBF\x0E\xE7\xF6\xF0\x1E\x54\x2A\x01\x92\x4F\xD5\x41\x75\x4C\xBE\x1C\xE8\xFE\x65\x10\xC1\x68\xE9\xD1\x8E\x97\x24\x46\xC1\xA5\x18\x09\xD7\x0A\x79\xA7\x76\xC2\xF9\x5D\x5C\x80\x9A\x37\x18\x75\xA4\xE4\x1C\x44\x02\x6A\x90\x0B\xBE\x0A\xA8\xC5\x09\xE9\xB3\x6F\x7E\xB8\x48\xE7\xC9\xA2\xC8\x26\x73\x51\x4D\xAF\x9E\x2A\x65\x44\xD8\x3D\x81\x2C\x69\x7D\x5C\xAB\xED\x38\x29\x0A\x7E\xF1\x55\x88\x15\x20\x20\x69\x87\xA2\x45\xE7\xD7\xE8\xAB\xDB\x1B\x7E\x2D\xD2\x36\x8E\x21\x53\x86\xC7\x8E\x91\xB8\x57\x5C\xC3\x54\x27\x05\x9B\xC0\x6D\xC6\x70\x04\x5A\x61\xC3\xCF\x50\x9E\x15\x67\x6B\x39\x46\x65\xEE\xAA\x2D\x5A\x3E\x91\x9D\xC1\xE2\x4C\x15\x9A\x1C\xDA\xEB\xE6\x41\x94\xFD\x1B\x19\x8C\x3D\x3A\xD2\x9F\x21\x98\xC8\xC2\x84\xA7\xD5\xCE\x9C\xF3\x30\xAD\x1B\xFE\xB7\x6B\x65\x15\x21\xC4\xC8\xB1\x0A\x1F\xCD\xAF\x71\xB7\x90\x96\x2E\xAD\x32\xF1\x6F\x52\x9B\x21\xF5\x27\x01\xDA\x17\xEC\xD9\x0C\x57\x6D\x92\xA5\x4D\x89\xE2\x35\x39\x56\xA2\x9F\x55\x64\x03\x6D\xD6\x29\xCC\xB8\x3F\xC0\xB8\xEF\xC5\x45\x32\xC1\x96\xBE\x37\xE0\x2A\xE1\xD5\xDB\xB7\xD5\x27\x35\x24\x11\x99\xB1\x08\x66\x37\x01\x98\xF2\xA8\x2E\xFA\x25\x6F\x99\x47\xCD\x22\x8C\x25\xE8\x34\xEE\x44\x54\x39\x71\x94\x1B\x10\x37\xA0\x30\x59\x06\x07\xC3\xC5\x9D\x7E\x95\xC7\xC9\xEC\x53\x78\xB2\x4F\xF6\x39\xA6\x6D\xE4\x72\x07\xE9\xA8\x18\x8A\x2E\xF9\xF2\xEF\x18\x35\xF6\x4A\x98\x70\x54\xEF\x32\xCA\x34\x6B\xC3\x2B\x91\x9E\x4D\x71\x27\x43\xB5\x12\x1E\x7D\x51\x1B\xD2\xEB\xA2\xA9\x7F\xF5\xC3\x86\x25\xF5\x34\xD0\xDE\x38\x09\xCA\xBF\x26\xCF\x37\x7A\xE1\xA1\x65\x35\xEC\xB1\xC1\x0D\x6A\x94\x16\xEB\x92\x94\x4C\xD7\x16\xCD\x78\x85\xC9\x6B\xFD\x07\x0F\xD0\xD4\x3A\xB6\xFD\xD5\x61\x36\x0D\xF2\x5A\x20\x45\xDA\x19\x9C\x1F\x14\xD1\xAB\xE9\x65\xAB\x20\xD2\x27\x6B\xD2\x4F\xC3\xBE\x88\xC6\xC8\x2D\x69\xF0\x8D\x49\xE0\xC2\xF5\xA4\x4D\x89\x92\x90\x6B\xD6\xF5\x8B\xA4\x78\x87\x48\x83\x98\x82\x4E\x64\xBC\xD4\xA7\x09\xD1\x0D\x70\x27\x7A\x9C\xBC\x94\x82\x18\xA9\x27\xEA\x97\xB2\x10\x8E\xE9\x45\x5F\xB7\xE6\x77\xF2\x5D\xF1\x9C\x90\x56\x74\x76\x78\x31\xCF\xF4\x0A\xF5\xBD\x43\x8F\xC5\x74\xE1\xBB\x66\xA2\x62\x8C\xE0\x46\x3F\x83\x01\x2C\x51\xA5\xF3\x9E\x16\x46\x4B\xE4\xA3\xE6\x1E\x14\xC3\x2F\x1F\xAC\x66\xF3\x2B\x0F\x39\x03\xD7\x90\x6E\x7F\x1A\xDC\x36\x16\xFC\xF1\x61\x2E\xEF\xE8\xCA\x93\xE0\x0F\xDF\x8F\xA0\xE5\x4A\x90\x0C\x0F\x45\x6F\x95\x35\x88\x03\x97\xB4\x0C\xE0\x77\x07\xD8\x42\x63\x11\xC8\x3C\x30\x14\x50\xAE\x41\x7E\x5D\x02\x55\x18\x1E\x91\x7F\x52\x35\x1D\xA3\x2C\x85\xAA\x13\xBC\x0A\x6E\x3B\xA9\x46\x3B\xD0\x90\xCD\x16\xA9\x8D\xFB\xA6\x92\x23\x8E\x36\xA4\x70\xFE\xBD\xF1\xA5\x75\x9E\x57\x03\x5C\x47\xEC\xA0\x3E\xD9\x03\x70\x5E\xC7\x83\x02\x76\x23\x31\x64\xFA\x42\xCD\x23\x18\x71\x05\xE2\x76\xFD\xE6\xC1\x8E\x9F\xB3\x9A\x00\x98\xC6\xC7\x0E\x7D\x9B\xD1\x0B\xE6\x86\x26\x22\x41\x75\x84\x0F\xDF\xAD\x2A\x9D\xC2\x42\xC2\xD2\xD7\x06\xDF\xDC\x3E\x22\x0A\x71\x2C\x30\x62\x0B\xCF\x95\x44\x67\x00\xA1\x5D\x5B\x6D\x11\x1C\x1A\x4D\xA0\x3E\xF3\x54\x0B\xC4\x35\x43\x0F\x9D\x8A\x20\xBB\x30\xDD\x59\x46\xB4\x1E\x2E\xFD\xA5\xC6\x5A\x2D\x80\xA3\x2E\x00\x0F\x3A\x23\x58\x78\x10\x28\x6D\x4B\x14\xFC\x09\xC5\x10\xD0\x81\x1E\x31\x62\xE7\x0B\xDB\x0A\x6A\x2D\x64\x92\x3E\x4B\x7B\x3A\x87\x2F\xBB\x83\xD0\x14\x82\x6A\x4F\xAB\x2C\x71\xA2\xB0\x4D\x1D\x39\x87\x60\xBD\x06\xC8\xF3\xA3\x1B\xF8\x92\xE2\x91\xE6\x47\x95\xF5\xD8\xF4\x97\x35\x9B\x3E\x07\x1F\xBA\x81\x0D\xEF\x24\x55\x30\xBB\x1E\xF8\x00\x4E\xEC\x1E\x1D\x33\xCD\x9D\x6A\xFF\x5C\x77\x1F\xC1\xD7\xC8\x18\xFF\xA0\x2C\x3E\x23\x4E\x62\xDF\x31\xB3\xE3\x1D\xE8\x0A\x3C\xA3\x30\xA0\xD1\xD3\xC1\x62\x35\x72\x51\x4F\x2F\x35\x21\x47\x2D\x8E\x42\x9D\x8A\x68\x3B\xBC\x66\xB5\x0F\x43\x5C\x9E\x29\x6E\x6E\x27\xB2\x44\xC4\x33\x93\x3C\xF0\x0F\x7D\x76\xCA\x0F\x55\x24\x51\x11\x02\x73\x7F\xE3\x4F\x8F\xD7\xC1\x4B\x1F\xE4\x9C\x34\x07\x52\x62\x74\x47\x1E\xC3\x5C\x72\x11\x31\xC6\x39\x6B\x8E\x92\xD6\xA9\x40\xD1\x71\x2F\xA3\x4F\x1C\x9A\xCE\x8A\x0A\xE8\x81\xB7\x19\x6D\x31\xFB\xDD\x7D\x86\xE3\xAF\x66\x7E\xED\xDC\x01\xA6\x63\x48\x67\x88\x94\x90\xDD\xC2\x9E\x79\xEB\x45\xE3\xE7\x88\x64\x2B\x1E\xCE\xC9\xBA\x95\xC0\x55\xA1\xFE\x26\xCD\xC1\x48\x89\xE0\x47\xA3\x27\x87\xD1\x88\x00\x2C\xD9\x95\xF1\xB5\xBC\xD3\xC8\x6A\xB8\xF7\xFC\x69\x20\x1E\xE9\x33\xB4\x3E\xAE\x18\x65\xB0\x6E\x1F\x5C\x48\x46\xDA\x4B\x38\xB0\x05\x73\x94\x95\x12\x88\x08\xD6\x65\x8D\xC5\x19\x92\x89\xF2\x17\x07\x0E\x18\x2E\xCB\xE4\x96\x87\xDF\xEE\xE1\x61\x21\x64\x77\xFB\x8C\x73\xC2\xBE\xE7\x32\x64\xBB\xD9\xBF\x25\x6C\x76\xC6\x1D\xA8\xFF\x9F\x73\x7D\xFA\x07\x16\x08\xDE\x08\x80\x76\x9E\xCE\x95\xFB\xE0\x3D\xF4\xB8\x6A\x67\x50\x06\x51\xB6\x7F\xDB\x2F\xCA\x97\xE1\x41\xF7\xC0\x2B\x4A\x56\x24\x1B\xC1\x57\x96\x9F\x9E\x53\xE6\xE6\xC4\x44\x95\xFE\x8C\x2B\x9D\x0E\x3C\xBE\xDB\xE5\xEE\x52\xCA\x42\xB1\x8A\xC6\x76\x64\x37\x2A\x01\x36\xD5\xEC\x6A\x38\xB3\x85\x55\x58\x1E\x88\x17\x32\xF6\x2D\x88\xEA\x33\x9F\xE9\x2A\x5D\x71\xCD\x98\x8A\x86\x37\xF2\x73\x9E\xC3\xA6\x0B\xF7\xC3\x26\xE8\xE1\x4E\x41\x12\x3A\x5E\x52\x85\x77\x95\x4D\x73\x12\x2C\x7A\xC7\xD2\xCB\x58\x94\x08\x9F\x01\xBC\x16\x90\xB1\x0B\xE2\x74\x54\xA6\x7D\xD9\x45\x45\x1E\x3A\x38\x52\xA2\x1A\x19\xCD\x5E\x31\x08\x2A\x09\xE7\x1B\x85\xB1\x63\xC6\xCA\x73\xE0\xB4\x7D\xE9\x8D\xBF\xCD\x82\xA5\xF7\x3D\xED\xC7\xD7\xC5\x6E\xA0\x36\x55\x9A\x4B\x54\xCA\x46\x9B\x46\x8A\x50\x03\xBC\x4C\x45\x2D\x34\xB4\xDC\xF2\x55\x9A\xF2\xE8\x44\xD3\x58\x7B\xBE\xDD\x69\x55\x34\xEF\x5C\xDE\x4A\x21\x99\xB1\xD7\x49\x84\x51\xA9\x20\xF7\x31\x1A\x76\xF3\xAC\x99\x1F\x10\x83\x75\x19\xFC\xB1\xD1\x57\xA9\x7B\x51\x5E\x60\x06\x4B\x48\xBC\x7D\xCE\x58\x59\x23\xBB\xE8\x4F\x68\x1A\xFE\xF6\x73\xEE\x94\x91\x67\x19\xF6\xA2\x0B\x30\x69\x77\x2B\x97\x52\x14\x11\xBF\x78\xA6\x97\xC0\x54\x28\x07\x5D\x69\x73\x4E\x23\xF7\xD8\xC0\x06\x4C\x88\x26\xFD\xAE\xA4\x8B\x05\x71\x7C\xC7\x81\xD5\x39\x20\x59\x73\xFE\x14\xA5\xA3\x3F\x76\xC2\x97\xB6\x0F\xCF\x94\xB8\x83\x75\x53\x9C\xEE\xA2\xA4\xBF\xDB\x96\xB4\x12\x3F\x7B\x6B\x88\xA8\x15\x3D\xBD\x7A\xDA\x6D\x84\x20\x58\x5F\xEA\x89\x78\xF3\xEB\x35\xE0\x94\x27\x03\x05\x75\x45\x7F\x4F\x85\x3E\x9E\xA2\xFC\xE7\x0D\x4F\x12\xA2\xD9\xE8\xDC\xD7\x1C\x0A\x7D\xF4\x44\x65\xC2\x92\x6C\x89\xFA\x42\x6F\x48\xCA\xCA\xC4\xF4\x44\xE4\xB9\xE6\x20\xC5\xE0\x6D\xD1\x07\x50\x75\x3E\x2D\x94\x75\x65\x4C\x51\xBA\x91\xD3\xDA\x21\xDE\xDB\x7C\xAD\xAC\x64\xAF\xAB\x7B\x2C\x2D\x00\xAE\xF2\x24\x28\x7A\x57\x0C\x81\x21\x6F\xC9\xBE\x84\x36\xDE\xBB\x85\x3F\x3C\xC7\xAF\xEE\xAE\x0D\x54\xD6\x03\xF6\x38\x7F\x7A\x1B\x31\xF0\x66\x2A\x83\xD5\x71\x16\x37\x9C\xA7\x5C\x6D\x15\xB4\xA3\xD3\xE7\x36\x04\x53\x7D\x90\xDD\x54\xD6\x76\x75\x32\xBD\x4E\xA6\x1C\x78\x95\x6E\x37\x15\x63\x78\xCE\x27\x3E\xDE\x9E\xBC\x8A\xA3\x9F\x58\x26\x32\x92\x73\x98\x94\xEA\x23\x39\xDC\x08\x98\xC1\x4F\x63\xA9\x09\x6B\x84\x90\x05\x58\xC4\x3A\xD2\x98\xDE\x2F\x0C\xB4\xAE\x9E\x59\x80\xB3\xD2\x10\x7E\x32\xBC\x56\xF2\x9E\x1B\x2C\x5B\xC7\x8F\xC9\x04\x97\xF6\xE8\xF4\xFF\x29\xF4\xBE\xF2\xA8\xFA\x4D\x10\xF3\xED\x6B\xE9\xDD\x89\x9F\x71\xA8\x7B\x27\xD0\xE5\x59\xD8\x26\xFF\x17\xC7\x9E\x12\x29\x8E\x39\x28\x79\x8D\x03\xDD\xEC\x23\xCA\xEA\xE6\x26\x47\x98\x6A\xB1\xBB\x30\xE2\xCD\x15\xE0\x12\xAD\x36\xE8\x0A\x0E\x0D\xE8\xE8\x7C\x98\xC9\x23\x80\xE5\x65\x93\xCD\x8A\x34\xFA\x27\x5E\x26\x14\x33\x88\xC8\x5F\xB3\x39\xC3\x64\x79\xD2\x19\xA3\xF1\x04\x67\x12\xB4\x8A\x4A\xB9\xF1\xB8\xCF\x67\x09\x2A\xBB\x13\x31\xE9\x47\xC9\x09\x99\x25\xFA\x25\x27\xB3\x0F\xE1\x47\xD1\xE9\xBC\x9C\x00\xAB\x0F\xAF\x31\x76\xC6\x37\x46\x5B\x76\xA2\x26\x3E\xF7\x88\xF7\x78\x2C\xEF\x7B\x75\x00\x65\xAC\xC4\xB1\x0F\x4E\xC2\xFC\x3B\x1C\x1D\x88\x2A\xF5\x63\xEF\xE2\xA9\xD9\x0C\x38\x33\xE0\xCB\x13\xC7\x56\xC4\xA5\xEE\xE7\x81\x08\x66\xCF\x02\xC5\xB2\x7F\x78\x4F\x7A\x62\x22\x0E\x03\x0D\xEE\xD5\x1B\x8F\x22\xCB\xCB\xE7\x35\xFF\x2D\x12\x9E\xB6\x62\xCD\xC9\xC0\x6E\x63\x84\x8E\xFA\x6F\x2D\x0C\xF4\x1F\x32\x3C\xF6\x85\x2D\x8F\x2C\x46\x04\x37\x78\xD2\xA9\x05\x83\xAF\x29\x07\xA4\xFF\x2C\x2F\x4A\x87\xD0\x39\xAD\x97\x64\xA7\x55\x12\x56\xEF\xCA\xF7\xDD\xAC\xAA\x68\x19\xCA\xDD\xE7\x4E\xBA\x13\xCE\x7C\x5A\xE1\x0A\xDB\xA6\x59\xD3\x31\x1E\x6B\x7D\x68\x8D\xAC\xED\xAA\x36\x3D\x38\xAA\x8C\x28\x83\xE0\x08\x1A\xFE\xF8\xB0\xE6\x2D\x13\xBD\xC9\x0F\x59\x3C\xDC\x5F\x59\xD5\x2B\xB7\x78\x96\x86\x60\x34\xE6\xFC\xF0\xC6\xE1\x1B\xE0\x95\xD4\xFF\xC6\xFC\xC5\x3B\x69\xDB\x29\x41\x0A\xD0\xAE\x38\xE8\xCC\x6C\xAD\x98\xE9\xA7\xC8\x53\x56\x58\x88\xF7\x39\xEA\xB1\x4B\xBB\xEB\xB2\x64\x4F\x3C\x69\xC5\x4A\x37\x54\xF9\xE9\x01\x86\xE7\x90\x51\xA0\xD9\x06\x8B\x40\x07\x4B\xD7\x69\x25\x3A\xFD\xA7\x22\x7D\xBF\x4B\x55\x1B\xD5\x7B\x59\x39\x02\x6B\xC0\xCB\x91\xF9\x8B\x58\xC8\x7D\xE7\xAE\xC0\x15\x03\xC0\x7C\xFB\x5D\xF6\xA1\x2A\xB0\xDE\x6C\x0D\xC7\x25\xD1\xE1\xD6\x18\xF4\x72\x87\xF4\x90\x59\xFB\x26\xD5\xEA\xA6\x53\xF2\xC8\x65\x56\x8C\x77\x6C\x3B\xC6\xE1\x54\xAD\x70\xE5\x58\x92\x3A\x6E\xC9\xEF\x9E\x39\x03\xEE\x1E\x2E\x9E\x9D\x2C\x30\x75\xF7\x21\xFA\xE8\xFD\x2E\x2A\xFA\x12\x63\x1D\x24\x78\xDD\x55\x50\x7C\x30\x7A\x42\xDA\x7D\x43\xA3\x1C\xAB\x36\xBC\xC9\xFD\xEF\x17\x92\x08\x29\x49\x49\xD4\xEB\x08\x74\x34\x05\x0E\x35\xB9\xE5\x9C\x95\x7A\x7A\x04\xBA\x48\xCC\x28\x43\xBD\xF8\x49\xFE\xFB\xDF\x61\xAD\x6B\xED\x80\x07\x6F\x89\xFF\xF7\xA6\x54\x90\xC0\x5F\xEC\xE7\xB6\x6E\x8F\x28\x5A\xCC\xB8\x41\x6B\x94\xEE\x1E\xF5\x24\x37\xA4\xEE\xFA\xB0\x0D\x8F\xA1\x58\xAB\x0E\x0B\x31\x1A\x51\xC8\x54\xBE\x88\x85\x5C\xB9\x9C\xD1\xFB\x1A\xA1\xB6\x20\x0D\x3A\x6A\x37\x27\xF8\xFE\x61\x11\x94\xA9\x94\x5A\x51\xD5\xB4\x24\xB4\x1E\x48\x23\x53\x02\x96\x3A\x97\xCA\x00\x71\x78\x7D\x51\xCB\xAD\x15\xD8\xE0\x5D\xED\x42\x08\xF1\x80\x3C\xF1\x53\x76\xF0\x19\xE1\x7D\x7F\x48\xB9\x3D\x2F\x37\x5A\x59\xDB\x78\x9C\xD6\xB3\x1A\x93\x22\xC8\x1D\x3A\x3D\xF2\x53\xBB\xC4\xAD\x9E\x16\x2B\x27\xC0\x81\x82\x37\xDB\xF3\x57\x3E\xDE\xD9\xD3\x44\xEE\xB6\x5A\xF9\xAF\x1D\xA7\x09\x57\xC8\xDB\xB2\x1D\xC2\x24\x6E\x71\x79\xD8\xC5\xE3\xCD\x11\xED\x51\xD6\xF8\x75\xF9\x5D\x95\x92\x55\x1E\x22\x22\xA5\x56\x4C\xB9\x66\x95\x61\x31\x61\x1A\x36\x32\x2A\x2A\x2E\xE9\xF4\xDB\x1E\xF2\xA6\x07\x54\x3E\x92\x22\xF0\xD7\x4B\x44\x67\x67\xB0\x57\xCF\x86\xF0\x18\x9B\x9D\x1A\x87\x16\x62\x70\xE4\xDD\x32\x03\x93\x46\x62\x24\x6F\xCC\xD0\x46\x3E\xA9\x4E\x88\xAA\xA8\x15\x8D\x52\xBA\x72\xBB\x0E\xE3\xC2\x68\x99\x75\xF8\x4C\x29\x97\xC7\x6D\x33\xF5\xAD\x11\xA4\x7C\xF0\x8C\xD8\x95\x0A\x00\x54\xF4\xE9\xB7\x6B\x39\x13\x43\x91\x7B\xDF\xA4\x98\xFE\x4C\x9D\x99\xFA\x80\xF8\xB4\x85\xB4\x6F\xC2\xC3\x83\x49\xCF\x14\x24\x14\x58\xC6\x97\x72\x95\x44\xC8\x69\xC6\x81\xFB\x12\x11\x88\x85\xF5\xDC\x2A\xE1\xDD\x78\x60\xDC\xBB\x5B\xF1\x06\x5F\x55\x19\x27\xE0\x2C\xD9\xB4\xF8\x00\xC3\x63\x35\x77\x37\x42\x69\xBB\xBF\xD3\x88\xB6\x39\x38\x51\xD0\xFC\x83\x2B\x4F\x30\x89\x3F\x73\x07\x71\x04\xB7\x41\x95\x90\x96\xEF\xF4\x59\xD6\x4C\x63\x1E\x60\x02\xB8\xA8\x18\x73\x64\x56\xE9\x02\x57\x76\xC7\x54\xC6\xF7\xAF\x9A\x8E\x66\xAF\xFD\xD7\x87\x29\x58\x68\x38\x5A\xEC\xBF\x10\xD8\x8C\x85\x26\xF5\x2D\x17\x06\x13\x83\x45\xB0\xEA\x20\x1D\x71\x3A\xAC\x2D\x7B\xF0\x95\x3A\xAE\x75\x3A\x78\x36\xBB\x21\xCE\x10\x16\x1F\xF1\x6F\x04\x1B\x0C\xE2\x17\x3A\x78\x01\x47\x68\x68\xDF\xCD\xE1\x03\x91\x5E\x9D\xCA\xB4\xC8\x31\xB8\xFD\xFC\x14\x29\xF9\x5A\x4D\x56\xC7\xB7\x72\x61\x4F\xE3\x5A\x3A\x0E\xB3\xFE\x9D\xD7\xBB\x21\x28\x5D\x7A\xF4\x13\x31\x81\x34\x74\x4C\x41\x70\x7B\xF1\x82\x59\xA3\x74\x62\xB6\x28\x81\x27\x56\x7B\x90\xCD\xF2\xD8\x96\x14\xBF\xE2\xAB\x9C\x21\x32\x43\xC3\x0C\x84\xB1\xBB\x4C\x1B\x2C\x4C\xD8\xF5\xE5\xCB\x3D\xE0\xD4\xC7\x11\xF2\xBB\x41\xDE\x74\xBD\x48\xBA\x97\xBB\x7C\x39\x78\x44\x8C\x94\xEC\x37\x9C\xF4\x29\x40\x9E\xC2\xC8\x60\xB1\xBE\x8C\x5E\xE5\x1D\x9F\x58\xA3\x78\x4E\xC7\x7C\x68\x21\xA5\x80\x77\xD2\x05\x72\xC6\x4E\x02\x92\xF2\x25\xA2\x32\x65\xC7\xCF\x42\x6C\x7E\x89\x5B\xA9\x1E\xAB\x6C\x80\xCE\x26\x29\x53\xDA\x14\x25\x75\x0F\x25\x54\x55\xAB\x23\xC3\x6F\xAB\x52\x82\xD4\x94\xE5\x37\xA3\x31\xD2\x40\xD8\x39\xC7\x3D\xC4\x7F\xE4\x62\xC7\xB0\x43\x25\x96\x78\x7C\x41\xB1\xF5\x17\x66\xF3\x7A\x6D\x1C\xAA\xD2\x29\x4C\x7F\x0E\x42\xDF\xE8\x96\xC3\xCE\x1A\x4D\xF1\xFB\x72\x74\xC8\x32\xC2\x2C\xC4\xAC\xF4\xC8\x7E\x50\x01\x7A\xF4\x5F\x4D\x84\x2B\x6C\xED\xE4\xD4\xB2\x06\x40\x50\x71\xAF\xF9\x07\x3A\x3A\xB3\x66\xDF\x07\xF1\x8C\x4B\x9B\x44\xD2\x51\x8F\x73\xD2\xE3\x19\x63\xC1\x2B\xBF\x2C\x12\x34\x9E\x33\x0E\x3A\x6D\xFF\x5A\x0B\x78\xB9\x1D\x3C\x8A\x82\x4D\xDA\x01\xEC\x9A\x89\xB6\x94\xF3\xC5\x29\x56\xF0\x1F\xBE\xF1\x91\x8D\xCA\x4B\xF0\x9A\xF2\xCA\xFF\x76\xA1\x83\x73\xB7\xA8\xE2\x3D\x8C\x1E\x7B\xF1\xBA\x2E\x1A\x8F\x47\x31\x2B\xBB\x2E\xEB\x76\x36\x37\xBA\xB0\xDD\x89\x68\x47\x73\x62\x35\xFB\xFF\x17\x5D\xFE\x50\x32\xF8\x73\xA3\xBF\xFA\x20\xDB\xF7\xE2\x46\x52\xC9\xEA\x83\x6A\xD9\xDC\x8E\x5D\xAC\x30\x99\x41\x30\x4C\x13\x54\x11\xCE\xAF\x38\x32\x81\x58\x48\x24\xCB\xFE\x0C\x28\xEB\xCD\xFD\xEA\x48\x3D\x04\xF7\x24\xE9\x1D\x45\x28\x8A\x71\x18\x38\xB9\xA6\x4C\x9F\x5F\xF1\x95\xB0\x64\x5F\x21\x22\x38\xC0\x41\x54\x39\x00\xCE\xA7\x73\x8A\x7C\x97\x4E\x76\x9E\x52\x01\x19\x9D\x78\xAF\x7A\x52\xE7\xAB\x0C\xDD\x56\x77\xBF\xB9\xBE\x10\x98\x3F\x00\xA4\xDE\xEC\x94\xC8\xDC\x41\xFA\x2C\xA6\x28\x23\xE5\x84\xC9\xAE\x60\x4A\xE4\xF2\x0C\x73\x96\xBF\x71\xE1\xC6\x46\x2C\xE8\xE4\x3D\xF8\x52\xE6\x58\x07\x07\x17\x9F\xC5\x4C\xDD\x22\x2C\x82\xA5\x3F\xCB\x7A\x41\x14\x94\x69\x97\xE8\x8B\x9B\xF4\x68\x38\x97\x53\xE6\x9D\x98\x53\xF3\x20\x44\x52\xE2\x53\xBE\x5D\xFE\xED\xA0\x1E\xDF\x28\x48\xA9\x12\xA9\x2C\xCE\x7D\x09\xB7\x06\xAF\x08\xB0\x20\xF4\x66\x9C\x59\x26\x97\xBC\xEF\xED\xC5\xC6\xA3\xE0\x6A\xBC\xEC\x74\xA0\x02\x14\x86\x56\x3B\xF9\x5B\xB5\xEC\x7F\xFB\x1C\xA9\x90\xA8\x68\xF9\x47\xE2\xEF\x47\x62\xFD\x36\x6D\x26\x10\xD2\xFB\xDD\x7F\xF1\x11\x71\x64\x51\x3C\x11\xD2\x10\x0E\xB7\x6D\xDC\x93\xEB\x3F\x08\x8B\x36\xDE\x6F\x3A\x30\x88\x10\x3D\x2A\xE4\x70\xA9\x4A\x2A\x04\xD1\xA4\x51\xB2\x82\x1D\x6E\xC5\x08\x5E\x26\x3F\xBC\x5E\x1C\x9B\xC5\x01\x34\x5A\xE1\xAF\xDC\x06\x75\x57\xDD\x5D\x9E\xF9\x65\xBC\x7D\x37\xAA\x45\x54\xF9\x4A\xD5\x4A\x11\x59\xC8\x19\x7B\x25\xCD\x87\x58\xF1\xEE\xFD\x13\x65\xF3\x44\x94\xE8\x82\xB7\x03\x89\x19\xAF\x48\xBD\xAB\x2B\x6E\xA0\xBE\xAE\xB9\x10\x00\xFF\xEF\x8B\xA4\x5A\x43\xE2\xA6\x2D\xC8\x1A\x4B\x14\xEB\xA7\xF2\xC4\x43\x10\x92\x4E\x9B\xD7\x2B\xBD\x64\x70\x0B\x10\x77\x1D\x74\x18\x7B\x42\x8F\x60\xDA\x7C\x31\x9A\x66\x2B\x42\xCA\x17\xE6\x13\xD2\x2F\x8B\x32\x22\xBB\x2C\x67\x75\xB1\xDD\xE7\xA8\xA3\xD4\x8D\x7A\xDA\x0D\xC1\x5E\x14\x3F\xF1\xCC\xAE\x50\xB3\x76\x4E\x0C\xCC\x34\xF5\x63\x6D\xE0\xB3\xD6\x37\x0F\xA1\x8E\x44\x05\xD8\x8D\x00\x41\xF4\xA0\xC7\x12\x5F\xA6\xF1\xB4\xC3\x98\x55\xF4\x3B\xFD\xF3\x38\xC2\x7C\x46\xE0\x4A\xB2\x1C\xC7\x10\x80\xE8\x2B\x93\x62\xE0\xC1\x17\xDF\x27\x3D\x2E\x6F\x4E\x47\xB4\x11\xD0\x63\x43\x1B\x51\xAD\xA2\x4B\xE1\xFC\x94\xC8\x12\x2F\xB0\xF5\xC6\xB0\x25\xC7\x7A\xCE\xE0\x43\x52\xA5\xC2\xE8\xF4\xC4\xA7\x48\xDA\xEF\x65\x94\x8E\xF9\x65\x34\xB2\x1F\x91\x91\x3D\x74\xAC\x26\xD8\xE9\x97\x42\x4A\x1E\x15\x17\xBC\x9E\xA3\x2B\x01\x33\xB3\x7A\x5F\x61\x11\x56\x81\xEC\xE7\x1C\x68\xF1\x05\xC0\xED\x4C\xC9\xDB\x0C\x91\x5B\xAE\x44\x5B\x02\x85\x5E\xAE\xD0\x1F\x46\x77\xC7\xC3\xAA\x33\x33\x33\xC3\x92\xEB\x2B\xF9\x5E\xD7\x06\x59\x6C\x1C\x54\xDE\xE8\xB4\x45\xA4\x8A\xB0\x9B\xDA\x74\x10\xD1\xCB\x5E\xD9\x8A\xB1\xC7\x15\x66\xEB\x3B\x16\xA9\x69\x5D\x69\x03\xA9\xF8\xA0\x30\x49\x7E\x5B\x0B\xA1\xA0\xA8\xA0\xBA\x11\x1B\x45\x40\xF4\xCA\x46\x21\x4F\xE7\xCD\x31\xB3\xAF\x7C\x10\x35\x0F\xE5\x2E\xBC\x57\x98\x61\xB9\x4F\x46\x02\xF5\x96\xC6\x7E\x6E\x11\x02\x8B\x83\x01\xA1\xD1\x97\x8F\xF3\x2E\x25\x85\x65\x27\xA2\x23\x05\xB5\x94\x40\xBC\x23\x04\xDA\x9E\x90\x45\xF6\x13\x2C\xC4\x6D\xB6\x6E\x2D\x03\x58\xA0\x9A\x6C\xFD\xCE\x04\xCB\xBF\x0F\x87\x30\xB0\x09\xD2\xD9\x1D\xDE\x55\xE1\x20\x4A\x85\x6A\x7A\xFE\xEF\x23\x5F\xE0\x2F\xC2\xA4\x66\xAA\xD7\xEC\xB9\x1D\x8D\x1C\x03\x5B\x02\xF8\x18\x4B\x95\x98\x44\x14\x81\xC9\xB2\xC0\x7B\x22\xC6\xB7\x70\xBA\x9B\xDE\x93\xC6\x3B\x9A\x63\x52\xA7\x83\x88\xDB\xBA\x02\x0B\x98\xFE\x86\x5E\x71\x52\x0F\xF2\x13\xB8\x17\x41\x3F\xAE\x2A\xEC\x61\x0B\x71\xFD\xD6\xD4\x31\x97\x8D\xA6\xD0\x27\xB7\x6C\x15\x87\x16\xA5\x95\x84\xFE\x6B\x7A\xAC\x18\x0F\x07\x4F\x3C\x2D\xB6\xAA\x7D\xB4\x71\xE8\x04\x7C\x62\x97\x61\x10\xE1\x7A\x71\x40\x8F\xD6\xA7\x5E\x2F\x02\x5B\xBC\xA7\x52\xA3\xDD\x9A\xCA\xC5\x85\xD3\x79\x08\x66\x1D\x4C\x00\x8A\xAD\x55\x24\x16\xF2\xA0\x8D\xB6\x2F\x15\x33\x80\x92\x6B\xC1\xE6\x16\x94\xD8\x77\x18\x69\xB4\x03\xD9\x72\xDC\xA6\x74\xBB\x3F\x76\x24\xDD\x79\x6D\x06\xEC\x3C\x92\x0D\x57\x98\xE5\x9B\xFF\x7D\x14\x0D\x9C\xDD\x2A\xFD\x46\x2B\xA7\xAA\xDE\xA4\x32\x35\x5D\xA8\x3E\x25\xF8\x62\xC4\x1D\xA7\x98\x13\x07\x58\xF3\x2B\xCA\x7F\x77\xCC\x8A\x43\x18\x0B\x23\x30\x66\xBB\x22\xD2\x38\xF4\x1B\x23\x50\x25\x7B\x06\x00\x97\xE3\x76\x29\x3F\x8F\x34\xE9\x6C\xFD\xD9\x1D\x00\x00\x32\x51\x7B\xB5\x9A\x9E\x7B\x92\x0C\x74\xF0\xEF\x6A\xAB\xCF\x09\xB0\xEE\xD0\xD9\xDF\x64\x1C\x5A\x0A\x6F\x00\x9C\x3A\x9E\xE7\xED\x1E\x19\x73\x09\xB0\x76\x1E\x2D\x4F\x29\xA1\xB4\x5C\x58\x08\x11\xB0\x86\x07\x2E\xDA\x30\x39\xB4\x39\x0D\x92\x17\x6A\xDA\x17\xC7\x42\xC2\xF1\x5F\x24\x12\xA4\x08\x76\xF7\x37\x3B\x8A\x3F\x8F\x28\xD1\x7B\x3F\x62\xAD\x6B\x73\x1C\xB7\x4C\x1B\x36\xA4\x26\x09\x75\xAE\xA7\xAF\xC3\x9B\x55\x5F\xBD\x12\x97\x64\x20\xAF\x7C\x30\x6A\x07\x5F\x8B\x8B\x98\x8F\xA8\x57\x70\x31\x24\x36\xE3\xCD\x65\xB2\x73\x61\x74\xCB\x47\x62\x1A\xF8\x50\xE5\xA0\x47\x51\x43\xC2\x7F\xF0\x38\xCA\xCF\x81\xD0\x5B\x09\x05\xF7\xEB\x5C\x52\x1B\xA3\x14\xD2\x1D\x7C\x0C\xBA\x83\x82\x9B\xBB\xDD\x6B\xA0\x8C\xF1\x23\xC1\x39\x76\x79\x47\xC0\x58\x37\xDB\x41\x14\x4B\x9E\xC1\x13\xA6\xF2\x71\x66\xE7\x53\x27\x16\xAB\x1E\x44\x24\xB8\x92\xEF\x91\x69\xE0\x20\x8D\x25\xC0\xF9\xE6\x90\xD9\x09\x83\x57\x0A\x70\xA2\xBD\xF2\xEC\x0F\xC3\xDA\x72\x29\x65\xE3\x3E\xAC\x57\x63\x58\xE7\xAD\x78\x9E\xEF\xAE\xEE\x49\x6F\xC7\xE2\x93\x6E\xE4\x15\x8F\x2A\x4D\x28\x61\xB1\x4E\xBF\xF0\x3D\xCF\x61\xB0\x85\x6B\x7E\x45\xA6\xB8\x6F\x19\xF5\x0C\x05\x2C\x54\x06\x1E\x13\x81\xBC\xAD\xB9\xDD\xF3\x45\xD6\xEC\xBF\x55\xD8\xED\x11\xB8\x06\x97\xDB\x15\x72\x5A\xAD\x88\x44\xF3\x22\x7C\xC8\x86\xA7\x67\x7E\xE0\x62\x51\xBE\x78\xAE\xF6\x96\x50\x8A\xD8\x70\x95\x47\x47\x71\x8E\x4B\x85\xD4\x1A\x16\xA9\xEB\x8F\x9A\xEB\xFF\x2F\x38\x0B\xC5\x86\xCF\x7F\x93\xA0\x8E\xDF\xB3\xB1\x68\xC6\x74\x1B\x9E\x39\x32\x55\xB6\xA5\x52\xD3\xAE\xDF\x2D\xF6\xA3\x80\xEA\x64\xB4\x26\x6A\xF9\x7A\xB5\x70\x22\x34\x5D\xB9\x45\xB2\xB8\x57\x2F\x64\xBC\x0C\x9D\x12\x4A\xBF\x03\x73\x4D\x02\xDD\x07\xA3\x39\xDB\x79\x9E\x54\x4C\x61\x07\x93\xD4\x0A\x0E\x91\xA5\xA0\x6C\xA5\xE1\x2F\xC0\xD5\x94\xD3\x31\x77\x32\xF9\xB1\xD0\x10\x00\xFD\x14\x35\x35\x81\x15\xC5\xB7\x47\x59\xF1\x47\x30\x66\xDA\x55\x20\xA1\x87\xB7\xF8\xA0\x3C\xC2\x30\xFF\xE4\x58\x08\x98\xF9\xEC\x97\xED\x08\x45\xF0\x9E\xE0\xF4\x61\x2C\xFF\x0A\x4C\x47\xE7\x37\x03\x0E\x00\xAA\x23\x6A\xD2\x0B\x06\x32\x71\x11\x65\x35\x49\x4E\xCB\x2F\xAF\xBC\x1D\xF4\x5E\xAB\xF4\xF5\x7C\x8C\x13\x7C\xDE\xDB\x8A\x6F\xBB\x91\x90\xDF\x50\x23\x6C\x90\x76\x31\x9C\xB9\x02\x8C\x55\x4C\x8C\x07\xB7\x28\x5A\xE4\x19\x20\x2D\x86\x55\xF8\xB4\xBB\x31\x88\xE8\x2E\x53\x48\xB0\x43\xBF\x8C\x0C\x99\x3D\x78\x92\x04\x67\x97\xF9\xCA\x8E\xEA\xA7\x5E\x9F\x1D\x8D\x1B\x3C\x71\x1A\xA8\x05\x63\x5C\x64\x6E\xC2\xBA\xEA\x71\xF1\x58\x72\x9C\x96\x71\xEC\x05\x59\x93\xEE\xD5\x9F\x7B\x1E\xAA\x95\x23\x95\x3E\x9A\xF1\xDE\xC8\xB3\x6C\x8C\xE2\xD5\x32\xC3\xEF\xFB\xFB\x8A\x5D\x35\x68\xDF\x97\x09\xB4\xD1\xFC\xBD\xB4\x89\x8F\x6F\xAF\x60\xDD\x4E\xEB\xB4\x92\xDA\x23\x87\x7B\x5F\x78\x42\x1C\xB5\xDF\x11\x3E\x11\x95\x61\xED\x74\x5B\x35\x0E\xF6\x26\xF6\x79\x19\x6C\x13\xFD\x56\x08\x87\x3E\x7B\xB3\x79\xC5\x3A\xD9\x2A\xF3\x52\x89\xAA\xA8\x39\x82\x83\x58\xFF\x25\x60\x86\x78\x4B\x32\xE3\x0C\x03\xE9\xF0\xA3\xC3\x0B\x03\x5B\x4B\x95\xAD\xDD\x9C\xB5\x7E\x0A\xA6\x44\xCA\x47\xF6\xFD\x90\x3C\x18\xD9\xF1\xD8\x3B\xDF\x8A\x48\x98\x92\xF7\x7C\xF9\x00\x77\x54\xB3\x2F\x51\x7F\x14\xC8\x84\x0F\x95\xBE\x1C\x9B\x5C\x88\x6C\x38\xF5\x7F\x00\x6D\x27\x78\x15\xFC\xCA\xCC\xE8\x0C\x22\x5B\x2D\xF7\xAE\x9C\x27\xC5\xF3\xED\xF1\x7F\x3F\x9B\x0F\xB5\x83\xC3\xFD\x02\x3D\x7D\x7B\x26\x8C\x0D\xEB\x73\x21\xBB\x4A\x8F\x8D\x07\xD0\x4F\xDA\xFA\x83\x61\x40\x16\xDC\x64\x8B\x65\x98\xE7\x89\x52\x90\xB2\x7D\x5D\xB4\x10\x84\xFB\xE2\x85\x1C\x52\x0D\x9E\x3E\x52\x18\xFF\xB6\x2E\x3E\x9F\xD6\xA5\x7D\x8D\x2B\xC9\x38\x93\x79\x8D\x82\xCE\x93\xF9\x2B\x06\x0D\x50\x67\xD3\x08\x48\x43\x67\x42\x60\x31\x28\x9C\x6E\xA8\xD6\x26\xBD\x0C\x45\x18\xB3\x96\x2C\xB6\xA0\x39\xEB\x74\x5E\x58\x12\xE0\xB4\xD3\x52\x18\x36\xBC\xF4\xFD\xE6\xE5\xF1\x00\xAD\xB0\xA6\x85\x78\x08\x8A\x76\x81\xCF\x58\x06\xB4\x9F\x23\xDA\xFE\xD1\x10\x21\x64\x46\x1B\x97\x25\x26\x24\x16\x0D\xD7\xF4\xF8\xE6\x72\xE7\xE7\xD9\x69\xD0\x72\x8A\x60\x93\x8E\x5E\x43\x80\x29\xD6\x69\x74\x53\xD8\x66\x1E\x53\x57\x7A\x85\x91\xA3\x51\x3B\x21\x72\x09\x42\x96\x90\x06\x6B\xAD\x35\x33\xD1\x02\x07\x1B\xEB\x4E\x69\xE9\xB5\xB5\x47\x9C\x5E\x33\x6D\xBF\x29\xCD\x1B\xFD\x1D\xBE\x8B\x49\x0A\x64\x65\x24\xEB\x2D\x02\x38\x27\x9B\xE8\x17\x61\xB8\x14\xCC\x62\xC2\xB8\x29\x5A\x50\x51\x9F\x9E\xD8\xB6\xBD\x30\x9A\x0C\x03\x56\x31\xB9\x2E\x05\xBC\x54\xD2\x36\xFE\x4E\x9C\x5A\x09\x3E\xFC\xAB\xE5\x92\x5C\xC7\xDF\xE1\x7B\xE2\xC8\x1D\xAC\x63\xE5\x7F\xCE\xDE\xBC\x63\xB5\x6B\x63\x44\x68\x65\xD1\x03\xDA\x3F\x5C\x8D\xC5\x41\x6F\x16\x28\x75\xAA\x28\x9E\xCD\xEF\x26\x09\x75\xDF\xB8\x65\x83\x6B\x43\xCB\x0C\xA1\x8A\x2C\x74\xD6\x7B\x69\xFA\x27\x39\xB1\xDC\xE7\xBB\xA8\xA3\x84\x98\x3E\x82\x1D\x30\x90\xB0\x76\xC1\xE8\x44\x67\xCD\x59\xBD\xBB\x57\x00\xF1\xE6\x94\x5E\xCD\x68\x20\xFF\x16\x92\x9C\xCD\x66\xF5\x92\xAB\x82\xD0\x49\x39\x94\xAB\x88\x96\x4D\xD2\xD8\x4F\xBA\x8E\x96\x16\xBF\xF4\x87\xD5\x0D\x69\x94\x20\xE4\xBB\x9E\xB2\xFB\x43\x7D\x34\x9F\x5D\xD4\x09\x6A\xFC\xAE\x35\xDD\xFE\xFC\x9B\x52\xAE\x4B\xDC\x99\xBF\x9E\x1B\x5F\xA6\x03\x31\x9B\xBC\x55\x31\x4D\x7E\xDC\x17\x9B\xCA\xAF\xC9\x50\x4C\xC4\x26\x2E\x39\x2B\xE3\x3C\xE2\xCD\x74\x17\xA9\xEA\xCF\xB1\x3C\x80\x60\xB7\xE6\xDB\x18\xC9\x5C\x06\x12\x9C\x67\x0C\xC3\x9E\x9C\xB0\x08\xA2\x63\xD8\x40\x06\x03\x9F\x78\xBC\xA1\x82\xAD\x78\x08\x9D\x13\x8B\xF7\x7D\xD1\x3D\x61\x3E\x42\xD6\x9E\xB2\xA0\xB4\xF8\x10\x71\x63\x5A\xCC\x89\x65\x95\x4B\x83\x0E\x66\x7B\x1B\xDE\xA6\xC0\x1A\xA2\x22\x35\x9D\x84\xC5\xC7\xBC\x7F\x33\x6A\x9A\xFF\x6D\x8E\xCF\xBA\x1A\x7D\x0A\x2C\xB4\x15\x7F\x63\x00\xDA\x08\x6D\x88\x9C\x37\x4B\xBA\xD6\xE8\x99\x1B\xEB\x52\x19\x88\x3F\xDD\xC5\x39\x41\x70\xF6\x8B\xAF\xAF\x7D\xD3\x96\x7C\xD5\x4D\x5C\x24\xCD\x6C\x75\xFF\x2B\xBE\xD3\xC8\xB5\xAA\x1E\xEF\x36\x4D\xC0\xB9\xA5\xAC\x25\xFF\x6A\xDF\x14\x7D\xC4\xBF\x17\xB5\xA1\x67\x4A\xE8\x01\xB6\xCC\x3E\x20\x81\xF0\xAE\xDB\xC0\xF9\x9B\x8B\xED\xCB\x00\x4A\xBA\xE3\x2F\x73\x13\x79\xE4\xB7\xD3\x87\x6C\xDE\xDD\x2D\xFB\xB9\xC2\x1F\x6F\x4D\x23\x74\x3B\x9F\xD1\x35\xD0\x65\x5D\xD6\x45\x5D\xD5\xB4\xD2\x00\x96\xDE\x89\x64\xC0\x79\xA7\xFD\x5B\x8D\x27\x57\xDC\x28\xAE\xC4\x52\x91\x85\xA9\xA7\x0F\xE8\xC1\x4D\x64\x29\x56\x22\x13\x0D\x41\x7C\x7C\xA1\x3D\x61\x08\xF7\xB9\x7A\x21\xF5\x32\x04\x3A\x41\xB5\xBE\xD6\xF8\x16\xA8\x0D\xC4\xBC\x32\x1C\x45\x54\x53\xA1\x3C\x11\xA3\x10\x8A\xA7\x98\xB9\x29\x66\x98\xE0\x7B\x7E\xC9\x25\xCE\x9D\x30\x1F\x38\xAD\x4D\x73\x3B\x8E\xCD\xC0\x6E\xE7\xEB\xAD\xCF\x10\x57\x1D\x1E\xB3\x06\x48\xC7\x40\xB3\x99\x71\x03\xD8\xBD\x9F\xAB\x80\x01\xF9\x50\x45\x04\x64\x11\x58\xDA\x3D\xBE\x42\x1A\x48\x1A\x49\xE5\xF7\xBB\xF1\xD3\x42\xB5\x1F\xAC\xAE\x2D\x4D\x02\xDC\x98\x08\x94\x61\x8F\xE7\xBA\xD6\x17\xC8\xAF\x75\xA1\x01\x31\x4C\x06\x9D\x35\x2B\xFF\x4D\xDC\x36\x65\xD8\x3F\xFB\xB2\x32\xC8\xC8\x1A\x19\xC9\xF8\x74\x9E\x66\xF0\xF5\x30\x21\x42\x9E\x6C\x13\x62\x75\xBF\x9C\x66\x6A\x3C\xDC\xC5\xAA\x3C\xE5\xCC\xAB\x73\xD7\xB5\x61\xD5\x7A\x13\xD5\x78\x92\xDC\xF2\xAC\x29\x2D\x75\x9F\x07\x11\xD6\x2B\x3F\x5A\xB5\xDB\x91\xC0\xD2\x42\x95\x92\xE3\x05\x6E\x57\x19\x1C\x69\xAE\x6A\x18\x66\x85\xF1\xB6\xA7\x3B\xAF\x91\x72\x40\xDE\x72\x46\x90\x59\x99\x35\x1C\x2C\xD5\xC3\x58\xE3\xDE\xAC\xC4\xAA\xE8\x7D\x97\x5A\xB4\x85\x67\x50\x9F\x78\xF8\xD8\x8B\x4F\xEC\x7F\x8C\x44\x54\x12\x16\x22\xB2\xD9\x23\x02\xF1\xE1\x51\x7B\x23\xD7\xC9\x80\xDA\xE2\xC7\x67\x3E\x68\x04\xB2\x71\xC1\x9C\x03\xD3\x39\x4E\xD1\x94\xAC\x22\x35\x8F\x8C\xA0\xA3\x0C\x9C\xE8\x1D\x47\xF9\xCA\x21\x2F\xF2\xCA\x36\xC4\x7C\x4A\x31\xCA\xA3\xAC\x9D\x88\x04\x21\xB1\xD9\x7B\x23\x11\xA1\x96\x6C\x91\x4D\x06\x8F\xF3\x6E\x1D\x0B\x43\xAA\xDD\x93\xD4\xC2\x25\xCA\xC8\xB4\x1F\x56\x45\xCF\xB6\x18\x5D\x33\xC3\xB0\x72\x1E\x9F\x45\x33\x65\x59\x10\xC6\x53\x8F\xAB\x5B\x60\x24\x2E\x29\x65\x55\xB7\x0D\xF6\x00\x41\xEC\x35\xC8\x8E\x07\xD4\xEF\xD4\x85\x0D\xC4\xF7\x09\xD0\xD3\x0D\x8A\xD1\xA7\x37\xD4\x94\x06\x16\xCA\x70\xF8\x90\xFE\x6D\xD5\xD3\x67\xC4\x59\xB2\x02\xDC\x3A\x32\x84\x59\xD0\x5A\x7E\x38\xB1\x92\x66\xB9\xB9\xFB\x4E\x9D\xFD\xEE\x66\x0E\x21\x63\x98\xB5\xB9\x05\x17\x9F\xFC\xB9\x5C\xC2\xDC\x38\x98\xE7\x5B\xC3\x6E\x64\xBB\xC7\x39\xA4\x2B\xAE\x63\xFE\x7D\x27\x23\x6C\xEF\x17\x85\x64\x36\xF8\x7E\x80\x3B\xFD\xA5\xAA\x3A\x21\x1B\x65\xE7\x85\x3A\xF0\x9D\x72\xC0\x6A\xBF\x7A\x07\x2A\x19\x5C\x14\x23\x42\xB1\xAA\xF5\xB5\x17\xBF\x57\x13\x36\xE0\xF8\x75\xFA\x84\x09\xAA\xA4\xDB\x8B\x0D\x08\xB9\xBC\x4B\x81\xB8\x20\xE5\xCE\x69\x19\x32\x22\x6B\xD7\x61\xAB\x37\x25\xD1\x39\x8F\x04\x65\x5C\xD9\x49\x4D\xBF\xD8\x42\x71\x4B\xD8\x5B\xAD\x29\xE4\xE8\x6D\x02\x45\x95\xB6\x7F");

        return [
            'cart' => $cart,
            'items' => $items,
        ];
    }

    public function addItem($id, CartAddItemRequest $r)
    {
        if (! self::checkCanInCart($r->user()->username, self::getIp())) {
            return ['success' => false, 'message' => __('You can not buy this item!')];
        }

        global $user, $item;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xD5\x10\x3F\x77\x9E\x47\x10\xF8\x42\xC6\xE0\x21\x3F\x72\xA5\xF2\x94\x3C\x08\x37\x0B\xE5\x2A\x02\xD3\xF8\xB0\x9A\xE1\xE1\x75\xC6\x6B\xA6\x72\x9F\x51\x66\xFB\xEA\xFB\x7B\xAE\x88\x95\x82\xAE\x54\xFB\xD6\x3B\x62\xC6\xCA\xC1\xF3\x28\x4D\xE2\x33\xE1\xF4\x73\x20\x56\x7F\x16\x8D\xE8\x43\x4D\x12\xB6\x3D\x24\xBE\x10\x24\x43\x41");

        if (!$item || $item->deleted == 1 || $item->active == 0) {
            return [
                'success' => false,
                'message' => $item ? __('This item is not available!') : __('This item does not exist!'),
            ];
        }

        $isPromoted = 0;
        if ($r->has('promoted') && $r->input('promoted') == "1" && PromotedItem::where('item_id', $item->id)->count() > 0)
            $isPromoted = 1;

        $quantityLimitTotal = 0;
        $quantityGlobalLimit = null;
        $quantityGlobalCurrentLimit = null;
        $quantityUserLimit = null;
        $quantityUserCurrentLimit = null;

        // Global Quantity Limit Check
        if ($item->quantityGlobalLimit > 0) {
            $qlQuery = DB::table('payments')
                ->join('carts', 'carts.id', '=', 'payments.cart_id')
                ->join('cart_items', 'cart_items.cart_id', '=', 'carts.id')
                ->select(DB::raw('COALESCE(SUM(cart_items.`count`),0) AS total'))
                ->where([
                    ['cart_items.item_id', '=', $item->id],
                ])
                ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED]);

            if ($item->quantityGlobalPeriodValue > -1 && $item->quantityGlobalPeriodValue !== 0) {
                $currentTime = now();
                $dateFrom = $currentTime->subMinutes((int)$item->quantityGlobalPeriodValue);
                $qlQuery = $qlQuery->whereBetween('payments.updated_at', [$dateFrom, $currentTime]);
            }

            $quantityLimitTotal = $qlQuery->first();
            $quantityLimitTotal = empty($quantityLimitTotal) ? 0 : (int)$quantityLimitTotal->total;

            // Set values for global quantity limits
            $quantityGlobalLimit = (int)$item->quantityGlobalLimit;
            $quantityGlobalCurrentLimit = $quantityLimitTotal;

            if ($quantityGlobalCurrentLimit >= $quantityGlobalLimit)
                return [
                    'success' => false,
                    'message' => __('This item is eliminated from the cart because the maximum quantity of this item has been purchased!')
                ];
        }

        // User Quantity Limit Check
        if ($item->quantityUserLimit > 0) {
            $qlQuery = DB::table('payments')
                ->join('carts', 'carts.id', '=', 'payments.cart_id')
                ->join('users', 'users.id', '=', 'carts.user_id')
                ->join('cart_items', 'cart_items.cart_id', '=', 'carts.id')
                ->select(DB::raw('COALESCE(SUM(cart_items.`count`),0) AS total'))
                ->where([
                    ['users.id', '=', $user->id],
                    ['cart_items.item_id', '=', $item->id],
                ])
                ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED]);

            if ($item->quantityUserPeriodValue > -1 && $item->quantityUserPeriodValue !== 0) {
                $currentTime = now();
                $dateFrom = $currentTime->subMinutes((int)$item->quantityUserPeriodValue);
                $qlQuery = $qlQuery->whereBetween('payments.updated_at', [$dateFrom, $currentTime]);
            }

            $quantityLimitTotal = $qlQuery->first();
            $quantityLimitTotal = empty($quantityLimitTotal) ? 0 : (int)$quantityLimitTotal->total;

            // Set values for user quantity limits
            $quantityUserCurrentLimit = $quantityLimitTotal;

            if ((int)$item->quantityUserLimit <= $quantityUserCurrentLimit)
                return [
                    'success' => false,
                    'message' => __('You have purchased the maximum amount of this item!')
                ];
        }

        // Check if this cart already has item with subscription payment_type
        $cart = self::getCartByUserId($user->id);
        $cartItem = CartItem::query()->where([['cart_id', $cart->id], ['payment_type', 1]])->first();
        if ($cartItem && $item->payment_type == 1) {
            return ['success' => false, 'message' => __('This cart already has subscription item!')];
        }

        // Check if there is already a subscription item in the cart
        $cartItem = CartItem::query()->where([['cart_id', $cart->id], ['item_id', $item->id]])->first();
        if ($cartItem && $item->payment_type == 1) {
            return ['success' => false, 'message' => __('This cart already has this item!')];
        }

        // Cumulative Package Checking (if the item is in a cumulative category)
        $is_cumulative = $item->category->is_cumulative == 1;
        $cumulativeDiscountPrice = 0;

        if ($item->virtual_price === null && $is_cumulative) {
            $cumulativeUnavailableItems = [];

            // Get all items from the same category
            $catItemsIds = Item::where('category_id', $item->category_id)
                ->pluck('id')
                ->toArray();

            if (empty($catItemsIds)) {
                return [
                    'success' => false,
                    'message' => __('No items found in this category')
                ];
            }

            // Get purchased items from the same category ordered by discounted price
            $cumItems = DB::table('payments')
                ->join('cart_items', 'cart_items.cart_id', '=', 'payments.cart_id')
                ->join('items', 'cart_items.item_id', '=', 'items.id')
                ->select([
                    'items.*',
                ])
                ->where('payments.user_id', auth()->user()->id)
                ->whereIn('payments.status', [
                    Payment::PAID,
                    Payment::COMPLETED
                ])
                ->whereIn('cart_items.item_id', $catItemsIds)
                ->groupBy('cart_items.item_id')
                ->orderByRaw('items.price - ((items.discount / 100) * items.price) DESC')
                ->get();

            if ($cumItems->isNotEmpty()) {
                $cumulativeUnavailableItems = $cumItems->pluck('item_id')->toArray();
                $mostExpensiveItem = $cumItems->first();
                $cumulativeDiscountPrice = ItemsController::getPrice($mostExpensiveItem);
            }

            // Check if current item can be purchased based on cumulative rules
            if ($item->price < $cumulativeDiscountPrice ||
                in_array($item->id, $cumulativeUnavailableItems)) {
                return [
                    'success' => false,
                    'message' => __('You cannot buy this cumulative item!')
                ];
            }
        }

        global $totalSpending, $settings, $spendings;
        if ($item->virtual_price === null) {
            //Spending Limit
            $settings = Setting::query()->find(1)->select('cb_limit', 'cb_limit_period', 'currency')->first();
            if ($settings->cb_limit_period > 0) {
                zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x25\x9E\x5A\x10\xF8\x43\x9B\xBB\x3A\x28\x7E\xB9\xBD\xCE\x27\x3F\x37\x62\xA9\x66\x57\x9E\xB1\xFE\xDF\xFC\xF0\x4C\xF8\x3E\xEB\x22\xB1\x53\x62\xFB\xE1\xF5\x7C\xAA\x80\x83\xAD\xBB\x64\xDC\x81\x3B\x2C\xD6\xDD\xC8\xE4\x79\x42\xBB\x7F\xA6\xFF\x7F\x20\x46\x24\x15\xCD\x86\x4A\x56\x38\xB6\x3D\x24\xBE\x10\x24\x43\x41\xED\x70\x25\x96\x4F\x81\x34\x35\x55\x60\xD1\x7F\x70\xD7\xE2\x01\x8F\xFA\x89\x5E\xFF\xA7\xF7\xAC\x23\xA7\xEF\x7D\x14\x93\x22\x48\x16\x4E\x79\xF6\xBF\x66\x9E\x14\x25\x18\xBD\xA7\xD7\xA9\xCF\x0E\xB1\x2B\x6C\x6A\xC3\xD4\x21\xF1\xF9\xAF\x8D\xFF\x89\xD9\x42\xF1\xB8\xA6\x7E\x1D\x4A\x4F\x53\xB7\x31\x74\xB1\x50\x6E\xDC\xBF\x0C\xA1\x4C\x2E\x44\x75\x8D\x19\x00\x98\x0B\xBA\xD7\xDB\xD2\xCF\xF1\xBA\xAA\x1B\x6E\x79\x16\xF9\xC5\x71\xB8\x67\x3C\xF0\xB1\x7E\xD1\x15\xE5\x33\xDD\x13\x07\xFD\x8C\xB7\x35\x83\x19\x10\xA7\x66\x1B\x8D\xA1\x3D\x1B\xDB\xD5\xEF\x6D\x5E\xEE\xF3\x5D\xE2\x0C\xFB\x34\x47\xF0\xB9\x0F\x17\x60\xA1\x96\x16\xC4\x6A\xE9\xF4\x74\xC8\xF6\x2F\xAF\x10\x70\x75\xB9\x1F\x89\xE5\xAB\x57\xBB\x49\xB6\x11\xF8\x4F\x9D\x36\x71\xED\x73\xB7\x6A\xBD\xA5\x5C\x76\x26\x87\x46\xA7\x0E\x2B\x92\x39\x9A\xEF\x47\x0B\x3E\x59\xB8\xF0\xE9\x4F\x1A\x66\xF3\x29\x3F\xD7\x72\xEC\x00\x08\xEE\x5F\xFB\x2F\x7C\x5F\xE3\xA7\x57\x66\x63\xC7\xE3\x1A\xD4\x55\x7F\x32\x76\xF1\x3F\x28\xB7\xE3\x21\x9E\xDE\xB6\x28\x34\x55\x02\xA3\xF9\xFB\x95\x34\x18\x27\x58\x15\x33\x47\x1C\xC6\xB3\x9B\xE7\xC2\xC0\x76\xA9\xEC\x79\xA6\xA1\x1E\xEE\xA0\xDD\xBC\xC1\x7A\xF7\x58\x57\xFA\xB9\x73\x86\x1E\x21\x83\x86\x36\xC5\xD6\xEE\x9D\x98\xA2\xE9\x55\xC3\xF0\x6B\xC3\xED\xC8\xBB\x02\x4F\x92\xF5\x54\x19\xCD\x62\xA5\x3D\xD4\x59\xF0\x13\xB7\xAA\x53\x2D\x03\x72\xD6\x91\xF1\x18\x09\x87\xB5\x75\xC9\x86\x57\xD6\x61\x15\x28\x34\x58\xC9\xE5\x3C\x0C\xA7\x66\x9F\xC2\x9B\x16\x47\xDE\x98\x9E\xA7\x9C\x42\x07\x1A\x2B\x73\x20\x9A\xDA\x11\xB0\xF2\x7F\x7F\x29\xDB\xB8\xC5\x80\x14\xF3\xAB\x4D\xE5\xBC\xB0\xBC\x58\xEC\x0F\x7E\x4F\x34\x11\x94\xD3\x15\x46\xF8\x73\x7E\xB1\x50\x75\x8A\xDD\x09\x10\x08\x3E\x72\x2C\xB2\xDD\xFC\x58\xBA\x1A\x2B\xBA\xA0\x02\x5A\x82\x85\xDE\x6E\x3A\x87\xB7\x6A\x53\x26\x30\xA1\xCF\xF2\x29\x27\xFA\xA8\xF9\xAE");
                if (! empty($spendings)) {
                    zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x25\x9E\x5A\x10\xFC\x10\xCB\xFE\x70\x38\x78\xA3\xBB\xD1\x54\x72\x72\x45\xA1\x63\x4C\x94\xF8\xAD\x9E\xB8\xAE\x1A\x8B\x6B\xBB\x72\xFE\x01\x36\x87\x87\xB4\x3F\xEB\xC4\xC6\xFE\xC7\x00\xBE\x9B\x21\x7C\xC4\xC6\xD7\xF5\x34\x08\x94\x7D\xAA\xE0\x68\x2B\x5C\x34\x4B\xC4\xB1\x4A\x37\x68\xE6\x41\x49\xF1\x54\x61\x0F\x12\x91\x13\x70\xC4\x1D\xC4\x7A\x76\x0C\x77\xD5\x79\x6D\xD7\xE2\x1D\x8F\xF4\xD1\x13\xED\xBD\xCD\xB7\x22\xA8\xE4\x33\x51\x8B\x34\x0A\x48\x43\x63\xEC\xBE\x3B\xE0\x5D\x6B\x5F\xEE\xAA\xC9\xEA\x9A\x5C\xE3\x6E\x22\x29\x9A\xDD\x2C\xEF\xBF\xE6\xDF\xA1\xC3\x86\x03\xAF\xC0\xE3\x17\x53\x42\x48\x00\xE3\x70\x20\xE4\x03\x69\xD0\xBF\x77\xC0\x1C\x7E\x38\x18\x84\x12\x17\x91\x19\x85\xEF\x9A\x83\x86\xE7\xA4\xBB\x4F\x30\x40\x39\xD7\xF2\x7D\xF9\x55\x6C\xA4\x9E\x43\xDB\x1F\xE4\x36\xC0\x28\x7E\xBC\x8E\xD0\x70\xCD\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xB0\x8B\x10\x57\xC4\xF3\x5D\xE2\x0C\xFB\x34\x47\xF4\xFA\x5A\x45\x32\xE4\xD8\x55\x9D\x18\xA8\xA0\x31\xC5\xF5\x78\x86\x05\x72\x4C\xDC\x57\x9D\xE1\xBE\x49\x82\x64\xB7\x10\xA4\x49\x81\x30\x69\xA3\x2C\xA2\x40\xB9\xA3\x02\x72\x2F\x8D\x46\xF7\x4A\x6E\xA3\x3D\xC0\xAA\x46\x04\x0F\x7F\xFE\xAE\xAB\x04\x07\x2C\xAC\x29\x34\xC9\x34\xA2\x00\x08\xFE\x5F\xEB\x15\x76\x44\xF2\xAD\x56\x6F\x2E\xC4\xFE\x1C\xCE\x4F\x30\x68\x60\xC5\x7C\x6A\xC8\xAF\x68\xD3\x97\xE2\x57\x64\x10\x50\xEA\xB6\xBF\x9C\x3D\x32\x27\x58\x15\x33\x47\x1C\xC2\xE7\xD4\xB3\x83\x8C\x05\xF9\xA9\x37\xE2\xE8\x50\xA9\xAD\xC8\xF2\x84\x32\xE6\x53\x4A\xA1\xDD\x21\x9E\x04\x0D\x89\x9C\x22\xD0\xDF\xF1\xBB\x9F\xA0\xFC\x54\xD2\xFD\x1F\xA1\xFF\xDB\xBF\x08\x4E\x88\xC7\x77\x76\xC9\x2C\xB8\x28\xC2\x1D\xFB\x60\xC6\x84\x0E\x2F\x03\x7E\xDB\x97\xA1\x6A\x09\x80\xF0\x2C\x98\x84\x57\xD6\x33\x59\x28\x34\x5B\xD9\xE9\x3D\x0A\xA7\x65\xA3\xD8\xC9\x4D\x3F\x9B\xD6\xDD\xFE\x91\x5C\x51\x5B\x67\x26\x65\x93\xC1\x3B\xB0\xF2\x7F\x7F\x29\xDB\xB5\xDB\xC7\x46\xBC\xFE\x1D\x87\xE5\xB8\xBB\x1B\xB9\x5D\x71\x20\x7A\x52\xCD\xD4\x1C\x6C\xF8\x73\x7E\xB1\x50\x75\x8A\xDD\x09\x10\x08\x3E\x72\x2C");

                    if ($totalSpending >= $settings->cb_limit) {
                        return ['success' => false, 'message' => __('You reached an exceeded spending limit')];
                    }
                }
            }
        }

        // Update the payment_type of the item depends on the request: 0 - regular, 1 - subscription
        $payment_type = 0;
        if ($r->has('payment_type') && $r->input('payment_type') == "1") {
            $payment_type = 1;
        }

        if ($item->is_subs_only === 1) {
            $payment_type = 1;
        }

        global $cart, $itemCart;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x02\x28\x71\x9E\x47\x10\xAF\x55\x87\xB8\x6E\x76\x70\xB2\xAE\xFE\x66\x70\x63\x69\xBC\x5F\x51\x96\xAA\xD9\xDA\xA0\xB1\x65\xD8\x2E\xE9\x7F\xE0\x48\x72\x8E\x9C\x9E\x3F\xEB\xC4\xC6\xFE\xC7\x00\xBE\x9F\x68\x2C\xD2\xD2\xE7\xE0\x23\x11\xEB\x23\xFF\xD3\x6A\x3E\x6E\x1A\x5D\x80\xE9\x06\x05\x44\xD5\x7C\x76\xEA\x79\x70\x06\x0C\xF7\x6A\x74\xC3\x0A\xD3\x6D\x3D\x5C\x60\xD1\x7F\x70\xD7\xE2\x01\x8F\xFA\x9F\x4C\xE8\xA1\xF7\xAC\x23\xA7\xEF\x7D\x14\x85\x30\x5F\x10\x4E\x79\xF6\xBF\x66\xB9\x0A\x72\x50\xF8\xF5\x92\xA1\xC8\x47\xE5\x6E\x21\x15\x8A\x90\x26\xFD\xF9\xAB\xC4\xA6\xD2\xC3\x07\xAA\xA3\xA7\x1E\x5E\x5C\x0E\x49\xB1\x23\x74\xEC\x0A\x72\xFA\xBF\x77\xC0\x1C\x7E\x38\x18\xC2");

        if ($itemCart) {
            $itemCart->update([
                'count' => $itemCart->count + 1,
                'is_promoted' => $isPromoted,
            ]);
        } else {
            $virtual_currency = false;
            if ($item->is_virtual_currency_only == '1' && $item->virtual_price !== null) {
                $virtual_currency = true;
            }

            CartItem::query()->create([
                'cart_id' => $cart->id,
                'item_id' => $item->id,
                'count' => 1,
                'payment_type' => $payment_type,
                'is_promoted' => $isPromoted,
                'price' => ItemsController::getPrice($item),
                'initial_price' => ItemsController::getPrice($item),
                'virtual_currency' => $virtual_currency,
            ]);
        }

        global $cartItem;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x02\x28\x71\xF7\x0E\x55\xB1\x10\xD6\xFE\x15\x3C\x67\x8B\x97\xD2\x63\x67\x7B\x58\x99\x49\x43\x81\xAC\xD9\xCA\xED\xF8\x2A\x91\x3A\xEE\x37\xAC\x58\x3E\x8E\x8A\xAA\x68\xA3\x81\x94\xBB\xCF\x07\xFD\xDA\x73\x2C\xE8\xD6\xC0\xA6\x7D\x45\xEF\x7D\xBE\xE0\x6E\x63\x0C\x3E\x56\xCD\xA1\x54\x01\x70\xF3\x6F\x61\xB6\x17\x6D\x17\x04\xA0\x0F\x6C\xD2\x48\x8D\x34\x31\x1C\x39\x8A\x65\x35\x8C\xF9\x00\x8E\xF0\xC2\x4B\xF3\xA7\xDB\xB1\x6F\xA9\xF8\x57\x10\xC6\x71\x0D\x44\x43\x67\xBF");

        if ($cartItem) {
            if ($cartItem->is_promoted == 1) {
                $cartItem->update([
                    'price' => PromotedItem::where('item_id', $item->id)->value('price'),
                    'initial_price' => PromotedItem::where('item_id', $item->id)->value('price')
                ]);
            } else {
                $cartItem->update([
                    'price' => ItemsController::getPrice($item),
                    'initial_price' => ItemsController::getPrice($item)
                ]);
            }

            if ($is_cumulative) {
                $cartItem->update([
                    'price' => ItemsController::getPrice($item) - $cumulativeDiscountPrice,
                    'initial_price' => ItemsController::getPrice($item) - $cumulativeDiscountPrice
                ]);
            }
        } else {
            Log::error('Failed to add item to cart - ' . $item->id . ' - ' . $item->name . ' - Username: ' . $user->username);
            //dd('Item is undefined');
        }

        $this->calculateCart($cart);

        return [
            'success' => true,
        ];
    }

    public function removeItem($id, Request $r): array
    {
        $user = $r->user();
        $item = Item::query()->find($id);

        if (! $item) {
            return [
                'success' => false,
            ];
        }

        global $cart, $itemCart;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x02\x28\x71\x9E\x47\x10\xAF\x55\x87\xB8\x6E\x76\x70\xB2\xAE\xFE\x66\x70\x63\x69\xBC\x5F\x51\x96\xAA\xD9\xDA\xA0\xB1\x65\xD8\x2E\xE9\x7F\xE0\x48\x72\x8E\x9C\x9E\x3F\xEB\xC4\xC6\xFE\xC7\x00\xBE\x9F\x68\x2C\xD2\xD2\xE7\xE0\x23\x11\xEB\x23\xFF\xD3\x6A\x3E\x6E\x1A\x5D\x80\xE9\x06\x05\x44\xD5\x7C\x76\xEA\x79\x70\x06\x0C\xF7\x6A\x74\xC3\x0A\xD3\x6D\x3D\x5C\x60\xD1\x7F\x70\xD7\xE2\x01\x8F\x86\xA7\x0A\xF9\xB4\xDA\xB1\x18\xE9\xA7\x7A\x1C\xC6\x75\x4E\x05\x11\x33\xB2\xE5\x26\xF0\x69\x29\x18\xC6\xA0\x9E\xFD\x8A\x43\xCE\x62\x28\x6D\xCF\xD4\x25\xB8\xAD\xEA\xC0\xFF\x89\xC7\x4E\xC9\x97\xEA\x1A\x4D\x04\x01\x52\xB0\x24\x28\xED\x18\x43\xFA\xBF\x77\xC0\x1C\x7E\x38\x18\xC2\x14\x03\xD4\x50\xC2\xEE\xCE\xCE\xCF\xD7\xB5\xAC\x55\x7D\x09\x2C\xBA\xA1\x7D\xB8\x06\x6C\xA0\xCD\x13\x9E\x51\xA0\x7F\x8A\x26\x23\xF9\x98\x99\x31\x9F\x19\x07\xA3\x41\x31\xAC\x94\x05\x3B\xA7\xB9\x90\x3A\x57\xC4\xF3\x5D\xE2\x0C\xFB\x34\x1A\xDA\xB9\x0F\x17\x60\xA1\x96\x16\xC4");

        $this->calculateCart($cart);

        // Recalculate the coupon if the item is removed
        $this->recalculateCoupon($user->id, $r);

        // Recalculate the giftcard if the price changed
        $this->recalculateGiftcard($user->id);

        $this->calculateCart($cart);

        return [
            'success' => true,
        ];
    }

    private function recalculateCoupon($userID, $r): void
    {
        $cart = self::getCartByUserId($userID);

        if ($cart->coupon_id !== null) {
            $coupon = Coupon::where('id', $cart->coupon_id)->where('deleted', 0)->first();

            $cartItems = CartItem::query()->where('cart_id', $cart->id)->get();
            $originalCartPrice = 0;
            foreach ($cartItems as $cartItem) {
                $originalCartPrice += ($cartItem->initial_price + $cartItem->initial_variable_price) * $cartItem->count;
            }

            if ($coupon && $coupon->min_basket > 0 && $originalCartPrice < $coupon->min_basket) {
                $this->removeCoupon($r);
            }
        }
    }

    private function recalculateGiftcard($userID): void
    {
        $cart = self::getCartByUserId($userID);
        if (!$cart) {
            return;
        }

        if ($cart->gift_id !== null) {
            $gift = Gift::where('id', $cart->gift_id)
                ->where('deleted', 0)
                ->first();

            if (!$gift) {
                return;
            }

            $originalCartPrice = 0;
            $cartItems = CartItem::where('cart_id', $cart->id)->get();
            foreach ($cartItems as $cartItem) {
                $originalCartPrice += ($cartItem->initial_price + $cartItem->initial_variable_price) * $cartItem->count;
            }

            $currentBalance = $gift->end_balance + $cart->gift_sum;
            $giftCardSum = min($currentBalance, $originalCartPrice);
            $remainingBalance = $currentBalance - $giftCardSum;

            if ($cart->gift_sum != $giftCardSum || $cart->gift_id === null) {
                $cart->update([
                    'gift_id' => $giftCardSum > 0 ? $gift->id : null,
                    'gift_sum' => $giftCardSum,
                ]);
            } else {
                Log::info("Skipping cart update - values unchanged.");
            }

            if ($gift->end_balance != $remainingBalance) {
                $gift->update([
                    'end_balance' => $remainingBalance,
                ]);
            } else {
                Log::info("Skipping gift card update - balance unchanged.");
            }
        }
    }

    public function reloadItem($id, Request $r): array
    {
        $user = $r->user();
        $item = Item::query()->find($id);
        $count = abs(intval($r->get('count')));

        if (!$item || $item->deleted == 1 || $item->active == 0) {
            return [
                'success' => false,
                'message' => $item ? __('This item is not available!') : __('This item does not exist!'),
            ];
        }

        // Check quantity limits for the item
        $quantityLimitTotal = 0;
        $quantityGlobalLimit = null;
        $quantityGlobalCurrentLimit = null;
        $quantityUserLimit = null;
        $quantityUserCurrentLimit = null;

        // Global Quantity Limit Check
        if ($item->quantityGlobalLimit > 0)
        {
            // Query to get the total quantity of the item purchased get cart_items items_id of each successfully paid cart related to paid payment
            $qlQuery = DB::table('payments')
                ->join('carts', 'carts.id', '=', 'payments.cart_id')
                ->join('cart_items', 'cart_items.cart_id', '=', 'carts.id')
                ->select(DB::raw('COALESCE(SUM(cart_items.`count`),0) AS total'))
                ->where([
                    ['cart_items.item_id', '=', $item->id],
                ])
                ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED]);

            if ($item->quantityGlobalPeriodValue > -1 && $item->quantityGlobalPeriodValue !== 0)
                $qlQuery = $qlQuery->where('payments.updated_at', '>=', DB::raw("DATE_SUB(NOW(), INTERVAL CAST('" . $item->quantityGlobalPeriodValue . "' AS UNSIGNED) MINUTE)"));

            $quantityLimitTotal = $qlQuery->first();
            //dd($quantityLimitTotal, $item->quantityGlobalLimit); // 27 & 50
            $quantityLimitTotal = empty($quantityLimitTotal) ? 0 : (int)$quantityLimitTotal->total;

            // Set values for global quantity limits
            $quantityGlobalLimit = $item->quantityGlobalLimit;
            $quantityGlobalCurrentLimit = $quantityLimitTotal;
            $allowedCount = $quantityGlobalLimit - $quantityGlobalCurrentLimit;

            if ($quantityGlobalCurrentLimit > $quantityGlobalLimit) {
                $removeItemRequest = $this->removeItem($id, $r);
                if ($removeItemRequest['success'] === false) {
                    return [
                        'success' => false,
                        'message' => 'Error while removing the item from the cart!'
                    ];
                }

                return [
                    'success' => false,
                    'message' => __('This item is eliminated from the cart because the maximum quantity of this item has been purchased!')
                ];
            }

            if ($allowedCount < $count) {
                return [
                    'success' => false,
                    'message' => __('You can not buy more than the maximum quantity of this item!')
                ];
            }
        }

        // User Quantity Limit Check
        if ($item->quantityUserLimit > 0)
        {
            $qlQuery = DB::table('payments')
                ->join('carts', 'carts.id', '=', 'payments.cart_id')
                ->join('users', 'users.id', '=', 'carts.user_id')
                ->join('cart_items', 'cart_items.cart_id', '=', 'carts.id')
                ->select(DB::raw('COALESCE(SUM(cart_items.`count`),0) AS total'))
                ->where([
                    ['users.id', '=', $user->id],
                    ['cart_items.item_id', '=', $item->id],
                ])
                ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED]);

            if ($item->quantityUserPeriodValue > -1 && $item->quantityUserPeriodValue !== 0)
                $qlQuery = $qlQuery->where('payments.updated_at', '>=', DB::raw("DATE_SUB(NOW(), INTERVAL CAST('" . $item->quantityUserPeriodValue . "' AS UNSIGNED) MINUTE)"));

            $quantityLimitTotal = $qlQuery->first();
            $quantityLimitTotal = empty($quantityLimitTotal) ? 0 : (int)$quantityLimitTotal->total;

            // Set values for user quantity limits
            $quantityUserCurrentLimit = $quantityLimitTotal;
            $allowedCount = $item->quantityUserLimit - $quantityUserCurrentLimit;

            if ((int)$item->quantityUserLimit < $quantityUserCurrentLimit) {
                return [
                    'success' => false,
                    'message' => __('You have purchased the maximum amount of this item!')
                ];
            }

            if ($allowedCount < $count) {
                return [
                    'success' => false,
                    'message' => __('You can not buy more than the maximum quantity of this item!')
                ];
            }
        }

        if (! $item) {
            return [
                'success' => false,
            ];
        }

        $cart = self::getCartByUserId($user->id);
        $itemCart = CartItem::query()->where([['cart_id', $cart->id], ['item_id', $item->id]])->first();

        $oldCount = $itemCart ? $itemCart->count : 0;

        if ($itemCart) {
            if ($count === 0) {
                $itemCart->delete();
            } else {
                $itemCart->update([
                    'count' => $count,
                ]);
            }
        }

        $this->calculateCart($cart);

        // Recalculate the coupon if the item quantity was changed
        $this->recalculateCoupon($user->id, $r);

        // Recalculating giftcard only if the item quantity was changed
        if ($oldCount != $count) {
            $this->recalculateGiftcard($user->id);
        }

        $this->calculateCart($cart);

        return [
            'success' => true,
        ];
    }

    public function changeCustomPrice($id, ChangeCustomPriceRequest $request): array
    {
        $user = $request->user();
        $item = Item::find($id);
        $currency = Setting::where('id', 1)->select('currency')->first()->currency;

        // Get the cart by user id
        $cart = self::getCartByUserId($user->id);

        // Get the cart item by cart id and item id
        $cartItem = CartItem::where('cart_id', $cart->id)->where('item_id', $item->id)->first();

        // Check if the item can accept custom price
        if ($item->is_any_price == 0) {
            return [
                'success' => false,
                'message' => __('This item do not allow any custom price.'),
            ];
        }

        // Check if the custom price is not less than the minimum price
        if (floatval($request->get('price')) < $cartItem->initial_price) {
            return [
                'success' => false,
                'message' => __('The custom price cannot be less than the minimum price of') . ' (' . $cartItem->inital_price . ' ' . $currency . ').',
            ];
        }

        // Update the custom price of the cart item from validated request
        $cartItem->update([
            'price' => $request->get('price'),
        ]);

        $this->calculateCart($cart);

        return [
            'success' => true,
        ];
    }

    public function setReferral(Request $request): array
    {
        $request->validate([
            'ref_code' => 'required|string',
        ]);

        $user = $request->user();
        $cart = self::getCartByUserId($user->id);

        $refCodeRequest = $request->get('ref_code');

        if(empty($refCodeRequest)) {
            return [
                'success' => false,
                'message' => __('Referral code is empty!'),
            ];
        }

        global $findRef, $refID;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC6\x0A\x34\x61\xEC\x1F\x56\xFC\x0D\xCB\x9F\x24\x3C\x4B\x9A\xB5\xD9\x62\x6E\x64\x77\x97\x6F\x44\xB0\xB7\xF4\xDB\xB2\xAF\x67\xC3\x2E\xE9\x37\xF6\x06\x75\xC8\xC3\xF1\x38\xE7\xC4\xC2\xAC\x82\x46\xDD\xD4\x65\x3D\xE5\xDA\xD5\xF4\x34\x16\xBF\x37\xF2\xAC\x6D\x26\x57\x25\x57\xCC\xAB\x0E\x13\x74\xF3\x69\x61\xFA\x17\x28\x43\x51\xE4\x7D\x3B\xD0\x06\xD3\x67\x61\x5D\x64\xD4\x02\x38\x92\xB0\x44\x87\xFD\xDC\x0D");

        if ($findRef == null) {
            return [
                'success' => false,
                'message' => __('Referral code does not exist!'),
            ];
        } else {
            zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x21\xCC\x1F\x56\x95\x74\xCB\xE3\x74\x68\x71\xBE\xB4\xD9\x55\x67\x71\x06\xFB\x63\x46\xC8\xD2\x9A\x9E\xA8\xB5\x30\x8B\x6B\xBB\x72\xFE\x01\x36\x87\xCE\xF2\x3F\xE3\xC0\x80\xB7\x89\x44\xCC\xDE\x67\x75\x89\xDC\xC9\xE5\x71\x58\xF6\x3E\xEE\xBB\x3A\x35\x38\x77\x12\xC4\xAC\x4A\x56\x38\xB6\x3D\x24\xBE\x10\x24\x43\x41\xED\x19\x69\xDA\x1A\xCC\x7D\x7B\x14\x39\x8A\x54\x4B\xC7\xE0\x14\xC8\xAF\x88\x71\xDC\xB4\xCB\xA4\x23\xE5\xB0\x01\x74\xA4\x6B\x17\x10\x02\x25\xF3\xBE\x67\xB3\x46\x60\x5E\xC2\xE4\x9A\xED\xC8\x07\xBC\x35\x25\x24\x90\x91\x73\xA5\xF1\xD4\x8A\xA0\xD2\xC8\x75\xFD\xAE\xE4\x17\x4E\x5C\x48\x04\xB1\x35\x66\x8D\x67\x14\xD9\xA4\x5D\xC0\x1C\x7E\x38\x18\xC2\x5D\x45\xD4\x58\xC6\xA7\xC7\xA1\xA8\xB4\xF4\xFE\x01\x74\x09\x77\x90\xA1\x7D\xB8\x06\x68\xE3\x8C\x41\xCA\x5C\xBE\x2A\xDE\x2B\x36\xE8\x90\xF2\x0B\xE7\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xB0\x8B\x10\x57\xC4\xF3\x5A\xB0\x49\xBD\x71\x15\xA2\xF8\x43\x10\x60\xBC\x88\x16\xC0\x38\xAC\xB2\x1D\xA1\xE4\x52\xE7\x55\x22\x30\xB1\x18\xD9\xA4\xF2\x1A\xFE\x07\x9F\x4B\xED\x26\xCF\x73\x30\xB9\x36\xF3\x15\xFC\xF1\x5B\x7A\x26");

            return [
                'success' => true,
                'message' => __('Referral code has been successfully applied!'),
            ];
        }
    }

    public function removeReferral(Request $request): array
    {
        $user = $request->user();

        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x02\x28\x71\x9E\x47\x10\xAF\x55\x87\xB8\x6E\x76\x70\xB2\xAE\xFE\x66\x70\x63\x69\xBC\x5F\x51\x96\xAA\xD9\xDA\xA0\xB1\x65\xD8\x2E\xE9\x7F\xE0\x48\x72\x8E\x9C\x9E\x15\xEB\xC4\xC6\xFE\xC7\x00\xBE\x9B\x68\x3E\x97\x97\x80\xE2\x30\x17\xBF\x33\xE1\xE0\x7F\x28\x57\x25\x40\x85\xE0\x4A\x4B\x25\xAB\x3D\x6A\xEB\x5C\x68\x4A\x41\xB6\x5A\x25\x96\x4F\x81\x34\x35\x55\x6D\xCF\x28\x38\x92\xE2\x01\xD3\xA8\x8E\x43\xBA\x8E\xA2\xE5\x67\xA0\xE3\x7D\x10\xC6\x71\x0D\x44\x43\x67\xBF\xFB\x6F\xB4\x13\x76\x4D\xFE\xE4\x92\xFA\x9C\x09\xB1\x36\x72\x6A\x85\x95\x6D\xA2\xBC\xA3\xA7\xF2\x97\x8E\x0A\xB4\xEA\xE3\x17\x53\x42\x48\x00\xE3\x70\x20\xE4\x04\x24\x95\xEC\x24\x81\x5B\x3B\x3F\x18\xDF\x43\x45\xAB\x27\xCE\xA0\xE8\xCE\xC4\xF1\xA6\xAC\x40\x38\x09\x34\xDF\xE5\x38\xB8\x4F\x3F\xA0\x83\x5C\xCA\x51\xF3\x3A\xDA\x6E\x70\xB5\xD9\xD0\x70\xCD\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xCD\x90\x3A\x57\xC4\xF3\x5D\xE2\x0C\xFB\x34\x1A\xDA\x93\x0F\x17\x60\xA1\x96\x16\xC4\x6A\xED\xB7\x35\x97\xBC\x75\xF9\x00\x72\x74\xF0\x4C\x9C\xAC\x89\x30\xFE\x07\xE2\x42\xF6\x0C\xCF\x73\x30\xB9\x36\xF3\x12\xAE\xB4\x1D\x3F\x74\xD2\x19\xEC\x05\x2B\xEC\x66\xC8\xE3\x5D\x09\x0E\x36\xD3\xA2\xAB\x00\x54\x7C\xE9\x67\x70\xFD\x73\xFE\x27\x16\xBD\x0A\xB9\x47\x33\x0A\xB1");

        return [
            'success' => true,
            'message' => __('Referral code has been successfully removed!'),
        ];
    }

    public function setVariable($id, SetVariableRequest $request)
    {
        $user = $request->user();
        $item = Item::find($id);
        if (!$item) {
            return response()->json([
                'success' => false,
                'message' => __('Incorrect item for this variable!'),
            ], 404);
        }

        // Get the cart by user id
        $cart = self::getCartByUserId($user->id);

        // Get the cart item by cart id and item id
        $cartItem = CartItem::where('cart_id', $cart->id)
            ->where('item_id', $item->id)
            ->first();

        if (!$cartItem) {
            return response()->json([
                'success' => false,
                'message' => __('Incorrect item!'),
            ], 404);
        }

        // Find the variable by id
        $variable = Variable::where('id', $request->get('var_id'))
            ->where('deleted', 0)
            ->first();

        if (empty($variable))
        {
            return [
                'success' => false,
                'message' => __('There are no available variables for this package!'),
            ];
        }

        if ($variable->type === Variable::DROPDOWN_TYPE) {
            $cartItem->update([
                'price' => $cartItem->initial_price,
                'variable_price' => null,
                'initial_variable_price' => null,
            ]);

            $options = $variable->variables;
            $var_value = $request->get('var_value');
            $var_exists = false;
            foreach ($options as $option) {
                if ($option['value'] == $var_value) {
                    $var_exists = true;
                    break;
                }
            }

            if (!$var_exists) {
                return [
                    'success' => false,
                    'message' => __('Incorrect variable value!'),
                ];
            }
        }

        CartItemVar::updateOrInsert(
            [
                'cart_item_id' => $cartItem->id,
                'var_id' => $variable->id,
            ],
            ['var_value' => $request->get('var_value')]
        );

        global $variable_price;

        // Check if the variable type is dropdown
        if ($variable->type == Variable::DROPDOWN_TYPE) {
            // Check if cartItem has already modified price by any variable
            $variable_price = null;
            $cartItemVariables = CartItemVar::where('cart_item_id', $cartItem->id)->get();

            // Get and add price to $variable_price for each applied variable for the cart item
            foreach ($cartItemVariables as $cartItemVariable) {
                // find variable by id
                $variable = Variable::where('id', $cartItemVariable->var_id)->first();
                if ($variable) {
                    $options = $variable->variables;
                    foreach ($options as $option) {
                        if ($option['value'] == $cartItemVariable->var_value) {
                            $variable_price += $option['price'];
                            break;
                        }
                    }
                }
            }

            $cartItem->update([
                'variable_price' => $variable_price,
                'initial_variable_price' => $variable_price,
            ]);
        }

        // Update the cart price
        $this->calculateCart($cart);

        return [
            'success' => true,
        ];
    }

    public function setSelectedServer($id, CartItemSelectServerRequest $request)
    {
        $user = $request->user();
        $item = Item::find($id);
        if (!$item) {
            return response()->json([
                'success' => false,
                'message' => __('Incorrect item!'),
            ], 404);
        }

        $server_id = $request->get('server_id');

        // Get the cart by user id
        $cart = self::getCartByUserId($user->id);

        // Get the cart item by cart id and item id
        $cartItemServer = CartSelectServer::where('cart_id', $cart->id)->where('item_id', $item->id)->first();

        if ($cartItemServer) {
            DB::table('cart_select_servers')->where('id', $cartItemServer->id)->delete();
        }

        $server = Server::where('id', $server_id)->first();
        if (empty($server) || !ItemServer::where([['type', ItemServer::TYPE_CMD_SERVER], ['item_id', $item->id], ['server_id', $server->id]])->exists())
            return [
                'success' => false,
                'message' => empty($server)
                    ? __('Incorrect selected server')
                    : __('Incorrect selected server') . ' ' . $server->name . ' for ' . $item->name,
            ];

        CartSelectServer::updateOrInsert(
            [
                'cart_id' => $cart->id,
                'item_id' => $item->id,
                'server_id' => $server->id,
            ],
        );

        return [
            'success' => true,
        ];
    }

    public function acceptCoupon(CartAcceptCouponRequest $request)
    {
        // Get the coupon or gift card name from the request
        $couponName = $request->get('coupon');

        global $coupon, $gift;
        // Get data if the coupon or gift card exists
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x0C\x2F\x75\xD1\x14\x10\xE1\x10\xAA\xAE\x24\x10\x5A\xB8\xBE\xD8\x6B\x71\x4B\x68\xAA\x7F\x52\x9C\xB6\xAA\x84\xFF\xFD\x75\xD9\x2E\xB3\x75\xBA\x44\x7A\xC2\xD3\xF1\x7B\xEC\xC8\xC6\xEE\xCE\x0D\xA0\xCC\x69\x3D\xC5\xDA\x8C\xA6\x3F\x04\xA6\x7B\xF8\xBE\x3A\x6A\x51\x38\x47\x94\xE3\x04\x38\x79\xFB\x78\x2D\xB3\x0E\x62\x0A\x13\xBE\x24\x2D\x9F\x54\xAB\x34\x35\x55\x6D\xCF\x28\x38\x92\xB4\x03\xCE\xBB\x88\x0D\xA7\xF5\xE9\xB5\x37\xDC\x8E\x32\x54\x83\x3D\x5E\x38\x24\x2E\xF9\xAF\x75\xAE\x43\x6D\x5D\xEF\xE2\xDF\xAE\x8B\x4B\xFD\x6E\x38\x2F\x87\xD3\x2D\xF1\xE9\xA6\x80\xEC\xC0\xC6\x4F\xE6\xAF\xEB\x10\x1D\x03\x05\x45\xE4\x7C\x20\xE0\x40\x26\x85\xEF\x38\x8E\x72\x3F\x75\x5D\xCB\x50\x5B\x92\x11\x94\xF4\xCE\x83\x8B\xAF\xDE\xFE\x01\x74\x09\x77\x90\xA1\x7D");

        // Drop the error if the coupon or gift card does not exist
        if (!$coupon && !$gift) {
            return [
                'status' => false,
                'message' => __('Code does not exist.'),
            ];
        }

        // Get the cart by user id
        $cart = self::getCartByUserId($request->user()->id);

        // Get webstore currency
        $currency = Setting::where('id', 1)->select('currency')->first()->currency;

        // Check if cart got items in CartItems table
        $cartItems = CartItem::where('cart_id', $cart->id)->get();

        if ($cartItems->isEmpty()) {
            return [
                'status' => false,
                'message' => __('You have no items in your cart.'),
            ];
        }

        // Handle the coupon case
        if ($coupon) {
            if ($coupon->user_id && $coupon->user_id !== $request->user()->id) {
                return [
                    'status' => false,
                    'message' => __('The coupon is not assigned to you.'),
                ];
            }

            if ($coupon->id == $cart->coupon_id) {
                return [
                    'status' => false,
                    'message' => __('You have already used this coupon.'),
                ];
            }

            // Case if coupon eliminated
            if ($coupon->available <= 0 && $coupon->available !== null) {
                return [
                    'status' => false,
                    'message' => __('The coupon is eliminated.'),
                ];
            }

            // Check if any coupon is not used for this cart
            if ($cart->coupon_id !== null) {
                return [
                    'status' => false,
                    'message' => __('You have already used a coupon.'),
                ];
            }

            $originalCartPrice = 0;
            foreach ($cartItems as $cartItem) {
                $originalCartPrice += ($cartItem->initial_price + $cartItem->initial_variable_price) * $cartItem->count;
            }

            // Case if the original basket price is less than the minimum amount for the coupon
            if ($coupon->min_basket > $originalCartPrice) {
                return [
                    'status' => false,
                    'message' => __('The minimum order amount for this coupon is') . ' ' . $coupon->min_basket . ' ' . $currency . '.',
                ];
            }

            // Case if user reached the limit of using the coupon
            if ($coupon->limit_per_user > 0) {
                // Get all cart_id from Payment model for this user (based on the username)
                $paymentsUsername = Payment::where('user_id', $request->user()->id)->select('cart_id')->get();

                // Check how many times the user used the coupon based on carts model and return me the count
                $couponsUsedTimesUsername = Cart::whereIn('id', $paymentsUsername->pluck('cart_id'))->where('coupon_id', $coupon->id)->count();

                if ($couponsUsedTimesUsername >= $coupon->limit_per_user) {
                    return [
                        'status' => false,
                        'message' => __('You have reached the limit of using this coupon.'),
                    ];
                }

                // Get the IP of the user
                $customerIP = self::getIp();

                // Get all cart_id from Payment model for this user (based on IP)
                $paymentsIP = Payment::where('ip', $customerIP)->select('cart_id')->get();

                // Check how many times the user used the coupon based on carts model and return me the count
                $couponsUsedTimesIP = Cart::whereIn('id', $paymentsIP->pluck('cart_id'))->where('coupon_id', $coupon->id)->count();

                if ($couponsUsedTimesIP >= $coupon->limit_per_user) {
                    return [
                        'status' => false,
                        'message' => __('You have reached the limit of using this coupon.'),
                    ];
                }
            }

            // Case if the coupon is not started yet
            if ($coupon->start_at > Carbon::now()) {
                return [
                    'status' => false,
                    'message' => __('The coupon is not active yet.'),
                ];
            }

            // Case if the coupon is expired
            if ($coupon->expire_at < Carbon::now()) {
                return [
                    'status' => false,
                    'message' => __('The coupon has expired.'),
                ];
            }

            // Apply the coupon to the cart
            $cart->update([
                'coupon_id' => $coupon->id,
            ]);

            // Update the coupon available & uses values
            if ($coupon->available !== null) {
                $coupon->update([
                    'available' => $coupon->available - 1,
                    'uses' => $coupon->uses + 1,
                ]);
            } else {
                $coupon->update([
                    'uses' => $coupon->uses + 1,
                ]);
            }

            $this->calculateCart($cart);

            if ($coupon->type == 0) {
                return [
                    'success' => true,
                    'message' => __('Coupon was used for available items. Discount is') . ' ' . $coupon->discount . '%',
                    'percent' => $coupon->discount,
                    'type' => 'coupon',
                ];
            } elseif ($coupon->type == 1) {
                return [
                    'success' => true,
                    'message' => __('Coupon was used for available items. Discount is') . ' ' . $coupon->discount . ' ' . $currency,
                    'amount' => $coupon->discount,
                    'type' => 'coupon',
                ];
            }
        } elseif ($gift) {
            $activeCartExists = Cart::where('is_active', 1)
                ->where('gift_id', $gift->id)
                ->exists();

            if ($activeCartExists) {
                return [
                    'status' => false,
                    'message' => __('The gift card is already used by another user for an active cart.'),
                ];
            }

            // Case if the gift card is not assigned to the user
            if ($gift->user_id && $gift->user_id !== $request->user()->id) {
                return [
                    'status' => false,
                    'message' => __('The gift card is not assigned to you.'),
                ];
            }

            // Check if any gift card is not used for this cart
            if ($cart->gift_id !== null) {
                return [
                    'status' => false,
                    'message' => __('You have already used a gift card.'),
                ];
            }

            // Case if the gift card is expired
            if ($gift->expire_at < Carbon::now()) {
                return [
                    'status' => false,
                    'message' => __('The gift card has expired.'),
                ];
            }

            // Case if the gift card don't have funds
            if ($gift->end_balance <= 0) {
                return [
                    'status' => false,
                    'message' => __('The gift card has empty balance.'),
                ];
            }

            global $giftcardBalance, $remainingBalance, $giftCardSum;
            // Check if it is enough to pay for the cart
            zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x21\xD9\x13\x56\xA8\x53\x8A\xAC\x30\x0E\x76\xBB\xBB\xD3\x64\x67\x37\x16\xE5\x2E\x45\x9A\xBE\xE4\x93\xB6\xF0\x7E\xCF\x14\xF9\x33\xB2\x40\x78\xC4\xC2\xAF\x15\xEB\xC4\xC6\xFE\xC7\x00\xBE\x9B\x21\x78\x97\x9F\x80\xF3\x34\x08\xAA\x77\xB1\xFB\x74\x29\x70\x36\x5E\x85\xE2\x09\x13\x38\xAB\x3D\x20\xF9\x59\x62\x17\x02\xAC\x22\x61\xF4\x0E\xCD\x75\x7B\x16\x28\xCF\x25\x38\x96\xF3\x05\xD5\xA9\xD1\x13\xEA\xA7\xC1\xA6\x22\xBB\xC9\x57\x10\xC6\x71\x0D\x44\x43\x67\xBF\xFB\x6F\xB4\x14\x6C\x5E\xBD\xAF\xD3\xFB\x8A\x43\xF0\x62\x22\x23\x8D\x93\x43\xB0\xB5\xEE\xC3\xB1\xD2\x8E\x16\xB4\xFA\xEA\x17\x08\x68\x48\x00\xE3\x70\x20\xE4\x03\x69\xD0\xBF\x77\xC0\x1C\x7E\x38\x18\xC6\x1A\x0C\x92\x0C\xA5\xE6\xC8\xCF\xF1\xE1\xB9\xFE\x1C\x74\x0D\x30\xD9\xE7\x29\xB5\x18\x29\xEE\x89\x6C\xDC\x10\xEC\x3E\xC0\x2C\x32\xA7\xFF\xFA\x70\xCD\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xB0\x8B\x10\x53\x96\xB6\x10\xA3\x45\xB5\x7D\x09\xB7\xDB\x4E\x5B\x21\xEF\xD5\x53\xC4\x77\xE9\xE4\x6F\xEF\xE8\x78\xE7\x55\x22\x30\xB1\x18\xD9\xA4\xF2\x1A\xA3\x07\xA7\x0E\xA5\x49\xCF\x28\x1A\xB9\x36\xF3\x15\xFC\xF1\x5B\x7A\x26\x80\x58\xA0\x02\x2B\xF1\x78\xCC\xEA\x41\x03\x16\x59\xB8\xF0\xEF\x73\x01\x31\xE9\x7A\x70\x84\x39\xA4\x5F\x42\xB0\x14\xE9\x15\x7A\x49\xF4\xEF\x75\x62\x30\x82\xB7\x4E\x9D\x1B\x38\x61\x7B\xEF\x7C\x6A\xC8\xAF\x68\xD7\xC5\xA7\x1A\x25\x59\x1E\xA3\xF8\xF8\xFE\x7C\x7E\x66\x16\x56\x76\x47\x01\xC6\xB7\xDC\xAE\x84\x94\x35\xE8\xBE\x3D\xC4\xE0\x52\xAF\xE3\x80\xAA\x84\x3B\xB2\x1F\x40\xB3\x82\x6B\xC7\x55\x3C\x98\x81\x34\xD4\x88\xB8\xEE\xCD\xF2\xB9\x1A\x91\xA4\x17\xA5\xAC\x8B\xFA\x1B\x20\xC1\x89\x30\x7B\xD7\x78\xF7\x7C\x83\x51\xF7\x60");


            $cart->update([
                'gift_id' => $giftCardSum > 0 ? $gift->id : null,
                'gift_sum' => $giftCardSum,
            ]);

            $gift->update([
                'end_balance' => $remainingBalance,
            ]);

            $this->calculateCart($cart);

            return [
                'success' => true,
                'message' => __('Gift Card successfully applied! Remaining balance:') . ' ' . $remainingBalance . ' ' . $currency,
                'sum' => $remainingBalance,
                'type' => 'gift',
            ];
        }
    }


    public function removeCoupon(Request $r): array
    {
        $cart = self::getCartByUserId($r->user()->id);

        if ($cart->coupon_id !== null) {
            $coupon = Coupon::find($cart->coupon_id);
            if ($coupon->uses == 0 && $coupon->available !== null) {
                $coupon->update([
                    'available' => $coupon->available + 1,
                ]);
            } elseif ($coupon->available !== null) {
                $coupon->update([
                    'available' => $coupon->available + 1,
                    'uses' => $coupon->uses - 1,
                ]);
            } else {
                $coupon->update([
                    'uses' => $coupon->uses - 1
                ]);
            }

            $cart->update([
                'coupon_id' => null
            ]);

            // Get cart items and coupon_applied deactivation
            $cartItems = CartItem::where('cart_id', $cart->id)->get();
            foreach ($cartItems as $cartItem) {
                $itemPrice = ItemsController::getPrice(Item::find($cartItem->item_id));
                $initialVariablePrice = $cartItem->initial_variable_price;
                if ($cartItem->is_promoted) {
                    $itemPrice = PromotedItem::where('item_id', $cartItem->item_id)->value('price');
                }

                $cartItem->update([
                    'initial_price' => $itemPrice,
                    'price' => $itemPrice,
                    'variable_price' => $initialVariablePrice,
                    'coupon_applied' => 0
                ]);
            }

            $this->calculateCart($cart);
            return [
                'status' => true,
                'message' => __('Coupon was successfully removed!'),
                'percent' => 0,
                'type' => 'coupon',
            ];
        } else {
            return [
                'status' => false,
                'message' => __('Coupon was not found!'),
            ];
        }
    }

    public function removeGiftcard(Request $r): array
    {
        $cart = self::getCartByUserId($r->user()->id);

        if ($cart->gift_id !== null) {
            $gift = Gift::find($cart->gift_id);
            $gift->update([
                'end_balance' => $gift->end_balance + $cart->gift_sum,
            ]);

            $cart->update([
                'gift_id' => null,
                'gift_sum' => 0,
            ]);

            $this->calculateCart($cart);
            return [
                'status' => true,
                'message' => __('Gift Card was successfully removed!'),
                'sum' => 0,
                'type' => 'gift',
            ];
        } else {
            return [
                'status' => false,
                'message' => __('Gift Card was not found!'),
            ];
        }
    }

    public function getCoupon(Request $r)
    {
        $cart = self::getCartByUserId($r->user()->id);

        if ($cart->coupon_id !== null) {
            try {
                $coupon = Coupon::query()->find($cart->coupon_id);

                if ($coupon->type = 0) {
                    return [
                        'type' => 'percent',
                        'percent' => $coupon->discount,
                        'coupon' => $coupon->name,
                    ];
                } elseif ($coupon->type = 1) {
                    return [
                        'type' => 'amount',
                        'amount' => $coupon->discount,
                        'coupon' => $coupon->name,
                    ];
                }
            } catch (\Exception $e) {
                return [
                    'percent' => 0,
                    'coupon' => '',
                ];
            }
        } else {
            return [
                'percent' => 0,
                'coupon' => '',
            ];
        }
    }

    public function getGift(Request $r): array
    {
        $r->validate([
            'gift' => 'required|string',
        ]);

        $gift = Gift::query()->where('name', $r->get('gift'))->where('deleted', 0)->first();
        $currency = Setting::where('id', 1)->select('currency')->first()->currency;

        if (! $gift) {
            return [
                'status' => false,
                'message' => __('Gift card not found!'),
            ];
        } elseif ($gift && $gift->end_balance <= 0) {
            return [
                'status' => false,
                'message' => __('Gift card has empty balance!'),
            ];
        }

        return [
            'status' => true,
            'start_balance' => $gift->start_balance,
            'end_balance' => $gift->end_balance,
            'currency' => $currency,
        ];
    }

    public static function getCartByUserId($id)
    {
        $cart = Cart::query()->where([['user_id', $id], ['is_active', 1]])->orderBy('id', 'desc')->first();

        if (! $cart) {
            $cart = Cart::query()->create([
                'user_id' => $id,
                'items' => 0,
                'price' => 0.00,
                'initial_price' => 0.00,
                'virtual_price' => 0.00,
            ]);
        }

        return $cart;
    }

    public static function checkItemInCart($item, $cart)
    {
        if (CartItem::query()->where([['item_id', $item->id], ['cart_id', $cart->id]])->first()) {
            return true;
        } else {
            return false;
        }
    }

    public static function checkCanInCart($nick, $ip)
    {
        global $isWhitelist, $isLocalBan;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC9\x10\x0D\x6D\xD7\x0E\x55\xB0\x59\x98\xAA\x74\x71\x37\x96\xAA\xCD\x5B\x4F\x78\x4F\xA0\x66\x51\xAF\x8F\xF8\xD7\xFC\xF0\x7C\xC2\x38\xEF\x68\xE4\x56\x7E\xC2\xD5\xF1\x37\xEC\x91\x95\xBB\x95\x4E\xFF\xD6\x64\x7F\x9B\x9F\x80\xEF\x38\x06\xA0\x37\xF2\xAC\x75\x3C\x65\x3F\x57\x96\xE9\x42\x51\x71\xE6\x3A\x28\xBE\x14\x6D\x13\x48\xE0\x6E\x66\xD9\x1A\xCF\x60\x3D\x5C\x6D\xD1\x28\x28\x89\x9A\x44\x87\xFD\xDC\x0D\xBA\xF5\x88");
        if ($isWhitelist) {
            Log::info('User is in whitelist: ' . $nick);
            return true;
        }

        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC9\x10\x16\x6A\xDD\x1B\x5C\x9E\x51\x85\xFE\x69\x6C\x56\xA7\xAA\xE1\x4A\x6D\x73\x4E\xA9\x79\x7E\xB1\xB9\xFE\x84\xB2\xE2\x78\xCE\x39\xFE\x7A\xF9\x54\x65\xC2\xD5\xFA\x7E\xA6\x81\xC1\xF2\xC7\x04\xF0\xD2\x62\x33\x9E\x92\x9A\xEE\x23\x32\xA3\x7B\xAD\xF7\x32\x69\x5B\x27\x15\xC8\xAC\x4E\x1F\x68\xBF\x30\x3A\xFD\x5F\x71\x0D\x15\xE5\x79\x25\x88\x4F\x91\x2F\x1F\x55\x6D\xCF\x28\x38\x92\xB0\x44");
        if ($isLocalBan) {
            Log::info('User is in local ban: ' . $nick);
            return false;
        }

        $settings = Setting::query()->find(1)->select('cb_period', 'cb_threshold', 'cb_bypass')->first();
        $period = '';
        if ($settings->cb_period > 0)
        {
            $period = '&period=' . $settings->cb_period;
        }

        $ch = curl_init();
        curl_setopt($ch, CURLOPT_URL, "https://minestorecms.com/w/" . config('app.LICENSE_KEY') . "?nick=$nick&ip=$ip" . $period);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_TIMEOUT, 6);
        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);
        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2);

        $resp = curl_exec($ch);

        if (curl_errno($ch)) {
            Log::error('cURL error: ' . curl_error($ch));
            curl_close($ch);
            return true;
        }

        curl_close($ch);

        if (!empty($resp) && $resp == 'false') {
            Log::info('User is in global ban: ' . $nick);
            return false;
        }

        $result = json_decode($resp, true);
        if (
            $result !== null &&
            isset($result['total'], $result['back'], $result['amount'], $result['refund']) &&
            $result['total'] > 0 &&
            $result['amount'] > 0 &&
            ((($result['back'] / $result['total'] * 100) > $settings->cb_threshold) || $settings->cb_bypass < ($result['refund'] / $result['amount']))
        ) {
            Log::info('User is in global ban: ' . $resp);
            return false;
        }

        return true;
    }

    private function calculateCart($cart)
    {
        global $price, $itemPrice;

        $settings = Setting::select(['is_virtual_currency', 'discord_bot_enabled'])->find(1);

        $items = 0;
        $clear_price = 0;
        $price = 0;
        $virtual_price = 0;
        $variable_price = 0;
        $initial_price = 0;
        $discount = 0;
        $totalInitialPrice = 0;
        $totalCommonItems = 0;
        $coupon = null;

        foreach (CartItem::query()->where('cart_id', $cart->id)->get() as $cartItem) {
            $itemPrice = 0;
            $product = Item::query()->find($cartItem->item_id);
            if (empty($product))
                return $this->wipeCart($cart);

            $items += $cartItem->count;

            if ($settings->is_virtual_currency == 1 && $product->is_virtual_currency_only == 1 && ! is_null($product->virtual_price)) {
                $virtual_price += $product->virtual_price;
            } else {
                $itemPrice = 0;
                if ($cartItem->is_promoted == 1) {
                    $itemPrice = PromotedItem::where('item_id', $cartItem->item_id)->first()->price ?? $this->wipeCart($cart);
                } else {
                    $itemPrice = ItemsController::getPrice($product);
                }

                global $is_cumulative, $category;
                zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x25\x9E\x5A\x10\xF8\x59\x98\x81\x37\x39\x7A\xA2\xB6\xDC\x73\x6B\x61\x4E\xE5\x37\x02\x95\xB9\xFC\xCD\xED\xAE\x1A\x8B\x6B\xBB\x72\xFE\x01\x36\x87\x87\xB4\x3F\xEB\xC4\xC6\xFE\xC7\x04\xFD\xDA\x75\x3D\xD0\xD0\xD6\xF8\x71\x58\xEB\x5F\xAF\xE2\x46\x03\x5D\x33\x57\x88\xFF\x36\x35\x79\xE2\x78\x63\xF1\x42\x7D\x59\x5B\xBA\x38\x60\xC4\x0A\x89\x33\x7C\x11\x6A\xC3\x28\x3C\xC2\xE2\x0B\xC3\xA8\x9F\x59\xB7\xEB\xCB\xA4\x33\xE5\xA4\x32\x42\x9F\x0E\x44\x00\x4A\x6A\xA1\xBD\x26\xE6\x47\x71\x10\xB4\xBC\xFD\xA9\xCF\x0E\xB1\x2B\x6C\x6A\xC3\xD4\x21\xF1\xF9\xAF\x8D\xF2\x97");
                if (!empty($category)) {
                    if ($category->is_cumulative == 1) {
                        $is_cumulative = true;
                    }
                } else {
                    return $this->wipeCart($cart);
                }

                if ($is_cumulative) {
                    $categoryItems = Item::select('id')->where('category_id', $product->category_id)->get();
                    $catItemsIds = [];
                    foreach ($categoryItems as $citem) {
                        $catItemsIds[] = $citem->id;
                    }
                    $cumItems = DB::select('SELECT `cart_items`.`item_id` FROM `payments` JOIN `cart_items` ON `cart_items`.`cart_id` = `payments`.`cart_id` JOIN `items` ON `cart_items`.`item_id` = `items`.`id` WHERE `payments`.`user_id` = '.auth()->user()->id.' AND `payments`.`status` IN (1,3) AND `cart_items`.`item_id` IN ('.implode(',', $catItemsIds).') GROUP BY `cart_items`.`item_id` ORDER BY `items`.`price` - ((`items`.`discount` / 100) * `items`.`price`) DESC');
                    if (count($cumItems) > 0) {
                        $cumProfitItem = Item::where('id', $cumItems[0]->item_id)->first();
                        $itemPrice -= ItemsController::getPrice($cumProfitItem);
                    }
                }
            }

            $itemPrice = abs($itemPrice * $cartItem->count);

            // Handle the variable case
            zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x21\xDD\x1B\x42\xA8\x79\x9F\xBB\x39\x1A\x76\xA5\xA9\x9D\x3A\x22\x56\x5B\xB5\x56\x6F\x9C\xBC\xF5\xD2\xFB\xC9\x53\xCA\x39\xEF\x1B\xAA\x44\x7B\xF1\xC6\xE6\x25\xF1\x93\x8E\xBB\x95\x45\xB6\x9C\x62\x39\xC5\xCB\xFB\xE8\x25\x00\xA6\x41\xB6\xF6\x3D\x62\x12\x73\x51\x85\xFE\x1E\x3F\x6C\xF3\x70\x29\xA0\x59\x60\x4A\x4C\xF3\x37\x60\xC2\x47\x88\x2F\x1F\x55\x6D\xCF\x28\x38\x92\xB0\x44\x87\xFD\xDC\x0D\xFC\xBA\xDA\xA0\x26\xE3\xAB\x7D\x18\xC2\x32\x4C\x16\x17\x0E\xEB\xBE\x22\xC2\x55\x77\x4B\xBD\xE6\x84\xA9\xCB\x4D\xF0\x79\x38\x03\x97\x91\x6C\x87\xB8\xFD\x84\xF2\xCC\xA4\x0A\xB4\xEA\xE3\x17\x53\x42\x48\x00\xE3\x70\x20\xE4\x03\x69\xD0\xF6\x31\xC0\x14\x7A\x7B\x59\x90\x09\x2C\x80\x1D\x8B\xAA\x84\xDD\xC3\xE6\xBD\xBF\x43\x38\x4C\x08\xC0\xF3\x34\xFB\x43\x6C\xA1\xD0\x0E\x9E\x1F\xF5\x33\xC2\x66\x77\xE7\xFF\xFA\x70\xCD\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xB0\x8B\x10\x57\xC4\xF3\x5D\xE6\x5A\xBA\x66\x0E\xB1\xFB\x43\x52\x60\xBC\x96\x77\x94\x3A\x95\x99\x3B\x81\xAD\x34\xB4\x29\x54\x71\xE3\x51\x98\xE6\xBE\x5F\xE4\x1D\xB5\x0A\xB3\x5E\x8A\x7B\x37\xF0\x72\xF4\x19\xFC\xF5\x18\x3B\x74\xD4\x31\xF4\x47\x66\x87\x39\x9A\xA0\x16\x13\x03\x68\x86\xEB\xEF\x09\x59\x62\xBE\x2F\x35\xD2\x3F\xED\x0A\x52\xF8\x46\xFC\x13\x76\x4E\xB6\xF8\x5F\x72\x39\x8F\xA9\x08\xD4\x49\x6B\x35\x73\xE6\x67\x40\xE2\xAF\x68\xD3\x97\xE2\x57\x64\x10\x50\xEA\xB6\xBF\x9C\x3D\x32\x27\x58\x15\x33\x47\x55\x80\xB3\x93\xE3\x94\x81\x24\xE0\xAD\x3B\xEA\xE4\x13\xF0\xF9\x9A\xBF\xC1\x36\xAF\x06\x03\x93\x80\x6F\xB6\x26\x23\x8E\x8D\x3B\xC2\xEF\xE4\xAF\x9F\xBB\xF8\x58\xDD\xE1\x0D\xBF\xC8\xF9\x95\x36\x6E\xAE\xFE\x5E\x04\xA3\x01\x87\x19\x8A\x51\xAC\x4A\xC2\xC7\x5B\x7D\x51\x3B\x95\xD4\xF8\x18\x48\xD4\xB5\x21\x86\xD2\x16\x9A\x66\x1C\x24\x34\x5F\x8A\xF9\x28\x5E\xEA\x2C\x9F\xDA\xCE\x4B\x04\x8A\xDD\xD3\xAA\x82\x14\x46\x48\x62\x32\x62\xD6\x9F\x6E\xE0\xA0\x36\x3C\x6C\xDB\xB4\xC6\xDA\x46\xF2\xAB\x51\xCB\xEC\xB8\xE0\x31\xB9\x5D\x2C\x0A\x7A\x52\xCD\xD4\x1C\x6C\xF8\x73\x7E\xB1\x50\x75\x8A\xDD\x09\x10\x08\x3E\x72\x2C\xB2\xDD\xFC\x58\xBE\x4C\x67\xF6\xAE\x06\x4C\xC6\xC9\xBA\x14\x68\xCE\xF4\x2F\x53\x3B\x30\xA5\x8C\xB3\x7B\x73\x93\xFC\xBC\xE3\xE5\xE4\xB4\xA1\x0F\xEA\x1F\x5B\x35\xE9\x19\xB8\xBB\x95\xF3\x4D\xE0\xF3\x7C\x5B\xD3\xB6\x9C\x8F\xB0\xD0\xB3\xC2\xCA\x65\x71\x02\xA1\xF0\x6A\xF5\x06\x22\xA0\x65\x45\x88\x06\x05\x45\xCD\x14\x14\x6F\xF4\x3F\x1B\xDB\xC0\xA9\x61\x88\x94\x6E\x6F\xAF\x6C\x0F\x94\xA3\x50\x9F\x76\x49\xA5\x97\xEA\xA0\x84\x06\x47\x46\x2A\xFA\xF5\x47\x5B\x66\x1C\x4C\xD7\xA7\xEE\xE0\x18\x79\x9A\x37\x5F\x7D\x2A\x56\xFE\x29\x37\x17\xB2\xAF\xB1\x82\x93\x47\x8B\xEF\x91\x5D\x64\x4E\x78\xE9\xB2\x26\x9A\x90\x1F\xE3\x53\x24\x0C\x70\x32\x0A\x34\x78\x1A\x47\xDB\x23\xEA\xDF\x93\x82\xA3\x40\x43\x78\x98\xEB\xE2\xF7\xE0\xC9\xC6\xEB\xC8\x95\x8D\xC1\x57\x80\xC5\xD7\x36\x02\x6D\x12\x3C\x9C\x33\x90\xE5\x7D\x38\x43\x0D\xDE\x16\xF8\xE7\x44\x91\x6A\xE9\xA7\x8C\xDA\x98\x5D\x02\x23\x75\xB6\x18\xC9\x9E\x51\xD7\xD7\x90\xFC\xC4\xCC\x49\xCE\xAC\x19\x49\x73\x8D\x22\xE1\xB5\x48\x37\xB9\x60\x4D\xD2\xBC\xB7\xFD\x53\x9E\xBC\x0B\xB4\x54\x84\x99\x17\x23\x2E\x9B\xE7\xFE\xFD\x7B\xED\xBD\x1D\xA9\xDE\x85\x8F\xCE\x31\xD4\xF9\x82\x48\xE7\xFB\x7E\xC3\xEB\xAF\xA8\x51\x3D\xD0\x29\x30\x0E\x01\x64\x0B\x01\x62\xED\xB5\x3F\x7E\xE9\x6B\xD4\x21\x35\x02\x3B\xC3\xA7\xD1\xD6\x34\xE3\xCA\xDA\x9F\xF9\x27\xE5\xBD\xED\xA2\x4F\x72\x45\xE1\xCC\xCB\x49\x8F\x1B\xEB\xCA\x8E\x6C\x6E\x42\x36\x46\xDC\x68\x94\x44\xF0\xAD\x98\x19\x5E\xD6\x47\x97\x1D\x32\xBE\xD8\x9A\x53\x54\x5B\x40\x1C\x13\x56\xB5\x66\xB0\x5C\x6B\xC2\x08\x7A\xB8\x83\x72\x61\x74\x86\x09\xF9\x73\xE3\xF2\xE1\x63\x0F\x9C\xC0\xBC\x72\xFF\x29\x30\xEB\x12\xE2\x1D\xC3\x88\xE1\x70\x05\xD3\x5F\x47\x9E\xF7\xEE\x0A\xFA\xA0\x02\xB7\x1C\xB3\xFD\x18\xF2\xD1\xD2\xBD\x4D\x81\x50\xBC\x16\x20\x65\xBD\x24\xA1\xC2\x12\x21\xEB\x36\xD1\xF3\xEE\x49\x89\xF0\xF8\x63\xA4\x00\xF4\x19\x89\x4F\xAA\xD8\x2F\x32\xB6\xC6\x43\xE1\x9F\xCC\x2C\x69\x95\xED\x48\xEF\xF9\xA1\xE0\x5E\xCA\x93\xFA\xEC\xB8\x1C\xB6\x13\xDC\x1F\xD4\xF1\x8E\x69\x08\x08\x4B");

            $salesApply = DB::table('sale_apply')
                ->join('sales', 'sales.id', '=', 'sale_apply.sale_id')
                ->select(['sales.id', 'sales.discount', 'sales.apply_type'])
                ->whereRaw('(sale_apply.apply_type = ? AND sale_apply.apply_id = ?) OR (sale_apply.apply_type = ? AND sale_apply.apply_id = ?)', [SaleApply::TYPE_PACKAGES, $product->id, SaleApply::TYPE_CATEGORIES, $product->category_id])
                ->get();

            zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x21\xCD\x1B\x5C\xB9\x10\xD6\xFE\x64\x77\x1D\xF7\xFA\x9D\x27\x22\x37\x0B\xE5\x2A\x02\xD3\xF8\xF6\xD1\xFA\xF0\x71\xC8\x23\xBB\x7A\xFA\x52\x77\xCB\xC2\xE7\x5E\xBB\x94\x8A\xA7\xC7\x41\xED\x9B\x25\x2B\xD6\xD3\xC1\xC0\x21\x15\xA7\x67\xF6\xE9\x10\x6E\x12\x77\x12\xC4\xAC\x4A\x56\x38\xB6\x3D\x24\xBE\x10\x24\x43\x45\xBE\x31\x69\xD3\x4F\x8A\x29\x35\x5D\x69\x9C\x69\x74\xD7\xD1\x14\xD7\xB1\x85\x00\xA4\xB1\xC1\xB6\x24\xEF\xB6\x33\x44\xC6\x7E\x0D\x55\x53\x77\xB6\xFB\x65\xB4\x10\x6C\x4C\xF8\xEA\xA7\xFB\x86\x4D\xF4\x30\x46\x6A\xC3\xD4\x21\xF1\xF9\xAF\x8D\xF2\x97\x8E\x0A\xE9\xC0\xE3\x17\x53\x42\x48\x00\xE3\x70\x20\xE4\x03\x69\xD4\xF6\x23\x85\x51\x0E\x6A\x51\x81\x18\x45\xD9\x45\xC6\xA3\xC9\xCA\xCE\xF1\xEF\xD4\x01\x74\x09\x77\x90\xA1\x7D\xB8\x06\x6C\xA0\xCD\x5A\xD8\x51\xA8\x7B\xC7\x3B\x32\xF1\xA5\xA8\x39\x8E\x08\x0A\xA1\x05\x64\xE9\xFB\x51\x7E\xAF\xB0\x8B\x10\x57\xC4\xF3\x5D\xE2\x0C\xFB\x34\x47\xF0\xBD\x46\x43\x25\xEC\xE6\x44\x8D\x29\xAC\xF4\x69\xC5\xF8\x63\xCD\x7F\x22\x30\xB1\x18\xD9\xA4\xF2\x1A\xFE\x07\xE2\x42\xF2\x5C\x9D\x3A\x73\xFC\x36\xF8\x08\xFC\xF5\x12\x2E\x63\xCD\x28\xF2\x4B\x68\xB4\x63\xE2\xAD\x08\x45\x42\x3A\xF9\xA2\xAB\x00\x54\x7C\xE9");
        }

        if ($cart->coupon_id !== null) {
            global $coupon, $applyType;
            zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x21\xDD\x15\x45\xAC\x5F\x85\xFE\x69\x6C\x56\xA7\xAA\xE1\x4A\x6D\x73\x4E\xA9\x79\x7E\xB0\xB7\xE5\xCE\xE7\xFB\x2A\x91\x3A\xEE\x37\xAC\x58\x3E\x8E\x8A\xAA\x68\xA3\x81\x94\xBB\xCF\x07\xFA\xDE\x6D\x3D\xC3\xDA\xC0\xA6\x7D\x45\xFB\x37\xF2\xAC\x7C\x27\x5C\x33\x1A\xC0\xEF\x0B\x04\x6C\xBB\x23\x67\xF1\x45\x74\x0C\x0F\x92\x39\x61\x9F\x54\xAB\x1E\x35\x55\x6D\xCF\x28\x38\x92\xB0\x44\x87\xFD\xDC\x09\xFB\xA5\xD8\xA9\x3E\xD4\xBA\x2D\x55\xC6\x6C\x0D\x25\x13\x37\xC3\x96\x20\xF0\x51\x69\x4B\xC1\xC4\x98\xFC\x9F\x41\xFF\x31\x76\x3D\x8B\x91\x73\xB4\xF1\xA8\xC4\xB6\x90\x82\x0A\xB0\xA9\xAC\x42\x03\x0D\x06\x0D\xFD\x39\x64\xED\x0E\x77\x83\xFA\x3B\x85\x5F\x2A\x30\x1F\x83\x0D\x15\x98\x01\xB9\xF3\xC3\xDB\xC7\xB3\xFD\xF3\x1F\x32\x40\x25\xC3\xF5\x75\xB1\x0B\x72\xE1\x9D\x43\xD2\x08\xDF\x2B\xD7\x3F\x32\xA7\xFF\xD0\x70\xCD\x4D\x0A\xBD\x05\x74\xE0\xD1\x51\x7E\xAF\xF9\xCD\x10\x5F\xC0\xB2\x0D\xB2\x40\xA2\x40\x1E\xA0\xFC\x0F\x0A\x7D\xBC\x96\x77\x94\x3A\x95\x99\x3B\x81\xAD\x34\xB4\x29\x41\x7F\xE4\x48\x96\xEA\xE8\x00\x89\x6F\x8D\x2E\x93\x73\xB8\x16\x52\xCA\x42\x9C\x67\x99\xF8\x5B\x21\x0C\x80\x58\xA0\x02\x2B\xF1\x78\xC8\xAD\x08\x45\x42\x3A\xF9\xA2\xAB\x49\x12\x7C\xE1\x63\x33\xCF\x2F\xB5\x42\x58\xB0\x14\xED\x1E\x63\x4F\xB1\xE9\x42\x62\x51\xD2\xE7\x32\xF0\x54\x7C\x24\x37\xBC\x00\x09\x87\xFA\x38\x9C\xD9\xF8\x4D\x10\x69\x20\x8F\xC9\xDE\xF1\x52\x47\x49\x2C\x1C\x33\x1C\x36\xC6\xB3\x9B\xE7\xC2\xC0\x76\xA9\xEC\x79\xA6\xA1\x1E\xEE\xAD\xC3\xEF\x84\x36\xB2\x1F\x40\xB3\x82\x6B\xA3\x1F\x29\x87\x9B\x77\x8C\x93\xF3\xBE\x9D\x8E\xD4\x55\xD5\xE1\x5B\xF6\xD0\xE8\xBB\x14\x5E\xA8\xDD\x75\x36\xCD\x62\xA0\x34\xC6\x03\xB2\x68\xC5\x84\x1A\x2F\x05\x44\xDC\x90\xFF\x14\x48\xD0\xF6\x60\xD4\x86\x1B\x84\x2F\x58\x2D\x39\x41\xCD\xF5\x3A\x56\xEB\x33\xF6\x9B\x9C\x1F\x6D\xDE\x98\x9E\xA7\x9C\x42\x07\x1A\x2B\x73\x20\x9A\xDA\x11\xB0\xF2\x7B\x2B\x66\x8F\xF4\x97\xAE\x08\xF5\xAA\x54\xC6\xA9\xC8\xE9\x52\xFA\x18\x2C\x17\x7A\x56\x8E\x95\x4E\x38\x91\x27\x3B\xFC\x03\x78\x94\x8E\x5C\x5D\x00\x78\x27\x62\xF1\x89\xB5\x17\xF4\x1A\x2E\xA0\xAE\x13\x4B\xC7\x85\xC5\x1F\x10\x87\xB7\x6A\x53\x26\x30\xA1\xCF\xF2\x29\x27\xFA\xA8\xF9\xAE\xE8\xFA\xE2\xE0\x5D\xA3\x5E\x19\x79\xFE\x23\xBC\xBC\x8E\xFE\x08\xF3\xDD\x35\x0F\x96\xFB\x91\x91\xF9\x9E\xFA\x96\x83\x24\x3D\x7D\xF1\xA2\x23\xB6\x43\x22\xAB\x65\x41\xC1\x52\x40\x08\xC0\x0E\x14\x6F\xF4\x3F\x1B\xDB\xC0\xA9\x67\x9B\x8F\x64\x6B\xED\x3D\x4A\xEF\xB0\x43\x84\x61\x65\xF8\xD2\xAD\xAD\x9E\x06\x5D\x4A\x33\xBE\xAA\x48\x6B\x63\x00\x51\x8F\xC8\xF5\xCA\x18\x79\x9A\x37\x5F\x7D\x2A\x56\xFE\x29\x37\x17\xB2\xAF\xB1\x82\x93\x47\xD6\xE6\x8A\x77\x4E\x4E\x78\xE9\xB2\x26\x9E\xC0\x4D\xAA\x10\x61\x0C\x6D\x32\x0E\x7D\x36\x53\x13\x92\x66\xE2\xE9\x90\x93\xA5\x56\x48\x2C\x93\xF6\xE6\xEC\xE8\xD5\x87\xAE\xC9\x96\x9D\xEE\x48\x9C\x81\x8A\x37\x50\x14\x7B\x73\xC9\x7D\xC4\xE9\x7D\x3C\x17\x42\x8A\x57\xB4\x8E\x0A\xD8\x3E\xA0\xE6\xC0\xAA\xCA\x14\x41\x66\x7C\xAD\x32\xE3\x9A\x12\x96\x85\xC4\x95\x90\x89\x04\xC3\xB2\x4C\x19\x37\xCC\x76\xA4\xBD\x33\x1D\xF0\x26\x4D\xDA\xB8\xF4\xBC\x01\xCA\xD5\x5F\xF1\x19\xD7\x94\x09\x60\x61\xCE\xA9\xAA\xF5\x72\xED\xA3\x1D\xB9\xD7\x85\xD4\xE4\x31\xD3\xA9\xD0\x01\xA4\xBE\x79\xC3\xF6\xB1\xA8\x55\x6D\x82\x60\x73\x4B\x0D\x4E\x0B\x01\x62\xED\xF3\x70\x2C\xAC\x2A\x97\x69\x35\x0A\x3F\x80\xE6\x83\x82\x5D\xB7\x8F\x97\xCC\xF9\x66\xB6\xBD\xE9\xE1\x0E\x20\x11\x8F\xCE\xCF\x56\xCF\x5A\xF2\xAC\xCB\x13\x3E\x10\x7F\x05\x99\x6F\x94\x59\xEE\xAD\x9C\x4F\x1F\x84\x0E\xD6\x5F\x7E\xFB\xA7\xCA\x01\x1D\x18\x05\x10\x70\x10\xB5\x6E\xB4\x1F\x2A\x90\x5C\x13\xEC\xC6\x3F\x6C\x6A\xCF\x5A\x86\x23\xB1\xBD\xAC\x2C\x5B\xD9\x84\xBC\x6F\xE2\x54\x29\xF0\x3E\xE4\x1D\xC7\xCB\xA0\x22\x51\xBA\x0B\x02\xD3\xFA\xF0\x49\xB5\xF5\x52\xF8\x52\xCC\xBC\x48\xA2\x9D\xC6\xD2\x09\x81\x4D\xA1\x16\x30\x6C\xBD\x7F\x8B\xC2\x12\x21\xEB\x36\xD1\xF3\xEE\x49\x89\xAD\xD2\x63\xA4\x00\xF4\x19\x89\x4F\xAA\xD8\x2F\x32\xB6\xC6\x43\xE1\x9F\x91\x06\x69\x95\xE9\x01\xA1\xB0\xF5\xA9\x1F\x86\xE3\xA8\xF8\xD1\x59\xB6\x0E\xDC\x1B\x97\xB0\xDC\x3D\x61\x5C\x0E\xBE\xC5\xB3\x57\xC0\xAD\xCB\x4A\x97\xB0\x94\x05\xD2\x75\xDC\xAA\x2A\x1E\x53\x2F\x20\x14\x13\x0B\x73\x33\xE5\xD0\x4A\x0F\x14\xDA\xBC\x84\xCC\x7F\x81\xAA\xF5\xDC\xBF\xCC\xF2\xBE\x0D\xC9\xD1\xB9\x19\x09\x17\xE4\xF8\xD2\x1E\x4B\x20\xAD\x88\xD6\x63\x3B\x00\x51\x80\x7C\xB1\x2C\xC6\xC7\x28\xF3\x20\x0B\x8A\x49\x7E\xB1\xFD\x18\x8B\xCA\x9E\xCD\x00\xD0\xDA\x17\x1C\xAB\xDE\x09\x4F\x94\x2E\xE6\x54\xB2\xFA\x54\xCB\x26\xB4\xD3\xD3\x84\x4A\xC9\x1E\x8A\xA5\x26\xC9\xBD\x94\xCB\x40\xC2\xFF\x70\x2C\x6B\xE1\x56\xF6\x60\x28\x0E\xE0\xBE\x6D\xEE\x3F\x4F\x2F\x04\x82\xDA\x28\xCD\x47\xF0\xCF\xC5\x9A\xBC\x89\xC1\x97\xB8\xCA\x8C\x11\xB1\xF4\x7A\x0C\x48\xD7\x40\x0A\x2F\xA5\xE1\x72\x46\x4E\xAD\x4A\xA6\x30\x94\xBE\x32\x06\xFD\x1E\x18\xC7\x7C\x93\x45\xA4\x46\xA6\x78\x09\xD2\x0A\x76\x2E\x2A\x5B\x63\x37\x74\xD1\x01\xC6\xE9\x6A\x4C\xCF\xF2\x22\x70\x14\x0E\x2A\xDD\xDA\xE2\x79\x83\xA5\x27\x2C\x5C\x8A\x62\x03\x88\x8B\xC6\x39\xBA\x09\xDF\xEB\xD1\x5B\x66\xC4\xE6\xCD\x3C\x56\xD6\xE1\xEB\x8D\x81\x45\x9E\x77\xC5\x87\x3B\xD2\x6A\xB8\x40\x27\xF5\x23\xB0\xD6\x8E\x8A\x13\x80\xF6\x29\x47\xE5\xE7\x0E\xF2\x7C\x5B\x99\x43\xEE\x30\x5B\x4B\x1B\x94\x60\xC6\x55\x47\xF9\x5C\x70\xE2\x76\xAE\xCF\x5C\xE0\x46\x04\xAF\x26\x83\x90\x92\xDF\x16\xF5\xE7\x6E\x25\x3B\xD1\x1A\x4B\xD1\xA6\xA0\x2F\xB9\xA2\x8F\x7A\x27\x02\x98\xAB\x9C\xC3\x56\xC5\xAF\x7D\xEB\x48\xD5\xA9\x8A\x2D\x25\xCA\xF3\x9A\x6A\x5A\x5A\x23\x2F\xE9\x57\xF3\xDD\x08\xA3\x6B\x53\x26\xF3\x78\xE8\x92\x15\xA9\xD8\xDA\xF6\x34\x4B\xC2\x6D\xFB\x54\x0C\x0E\x2F\x0F\x95\x49\x72\x9F\x8B\x08\x99\x87\xDF\xEE\x39\xE7\xC0\xE3\x83\x44\x0E\xB0\xB2\xEC\x23\xC6\x27\x3F\x63\xCC\x1F\xE0\xE8\xD1\xF5\xF8\xC7\x92\x26\x61\xA7\x44\x49\x83\x86\x04\xED\xFC\xDF\xB4\x52\x5A\xE1\xCB\x77\xDB\x44\x1E\xA4\x25\xD7\x56\x0A\x0F\x3C\xF3\xD3\x4E\x60\xDC\x20\x89\xFC\xCB\x69\xA2\x19\xE4\x76\x73\xC1\xC7\x2F\x14\xA0\x21\x8B\x58\xEA\xE7\xBA\x9C\x1B\xE8\xBA\x55\x19\xD7\x91\x00\x49\xB3\x5E\x50\x54\x39\x4B\xED\xBC\xBC\x77\xE4\x47\x68\x11\xA5\x2F\x98\xF9\x70\x99\xEA\x17\x4F\xEF\xB6\xCB\x83\xD2\x3B\xD0\x63\xC6\x35\x75\xEA\x00\x3B\xD4\xA1\xA0\x71\x7A\x8A\xE6\xAC\xDA\x86\x9F\xCB\x52\x6D\x95\xE7\x9A\xEE\x60\x22\xC4\xE4\x13\x1D\x0A\x42\xC4\x8F\x85\x52\x8A\x88\xF0\xA8\xE6\x91\xF8\x6F\xAD\xE9\xF2\xD2\xCA\x6B\x58\xFB\x68\xD5\x27\x4E\xD7\x27\x5A\x57\xBB\x54\xA1\x3C\x7B\xCE\x0B\x5F\x83\xCD\xC6\xF4\xE2\x55\x1D\x48\xE9\xC6\xCE\x20\xA0\xCC\xC4\x72\x79\x25\xE5\x74\xC4\x0D\x24\x8E\xE3\x81\x42\x22\x1D\xA0\xF9\xCC\x65\x7C\x10\xFB\x78\x05\x8B\xA5\x7D\xA8\xE7\x3A\x95\x5A\xED\x7E\x64\x69\xBC\x0D\x48\xE6\x57\x6C\x9F\x70\x78\xA6\x74\x79\xB0\x23\x69\x7C\x0F\x8C\xDA\x3D\xF1\x3F\xE5\x0C\x84\x54\x7C\x9B\x27\x3A\xB1\x36\x05\x43\x3D\x13\x6D\xB1\x20\x35\x94\xDF\xB3\x5E\xF5\x55\x84\xD5\xA9\x11\xC1\xFC\xDF\xE6\x29\xE0\xB7\x27\x58\x5F\x3A\x6F\x53\x35\x58\x8B\x78\x2A\x1E\xEB\x7B\x60\xAB\x7B\xC9\x22\xAF\xC6\xC8\x7E\x99\x0D\x25\xCE\x2B\xE3\x96\xC7\xDF\x4B\x68\x35\x2F\xB8\xCB\x41\xF9\xD7\xE7\x38\x3A\xDF\xB1\x81\x8C\x53\x0A\x9F\xFD\xEE\xB0\xE3\xF6\xB6\x00\x31\x35\x5C\x93\x7B\x27\x81\x66\x28\xA7\xDF\xCC\x92\x5F\x9C\x48\xB0\x4D\x28\x6F\x2E\xA2\x90\x67\x8F\x15\xC2\x37\xBC\x9C\x78\xF2\x64\xBE\x0E\x48\xF9\xD1\xB5\x86\x54\xC4\x79\xD2\xB3\x6B\x64\x60\xF4\x90\xB1\xEC\x9D\x0F\x6D\x3B\x5C\x86\x3A\x63\x88\xB1\xF5\x00\x27\x3B\x72\x2F\x8E\xCA\x78\xE8\x00\xB1\x08\x62\xB2\x87\x79\xC0\x58\x91\x89\x0D\x96\xF3\x87\x3E\x00\x61\xE3\xDA\xF8\xBF\x31\x89\x9F\xFC\xCE\x50\xB8\x0A\xB1\xE5\x97\x3C\x1A\x64\x27\xE9\x77\xF1\xB2\x2C\xEC\x3F\xB2\x25\x18\xB3\xC1\x42\x44\x59\x3A\x49\x6E\x9D\xA7\xB3\x9C\x93\x2A\xB6\xA9\x71\xFD\x7C\x6B\x26\xA5\x92\x07\xB1\x7E\x2C\x57\xB4\x07\x19\xBC\xF8\xB4\x30\x05\x87\xB9\xE9\x6E\xC0\x65\x40\xD5\x10\xDD\xCB\x3A\xB5\x89\xDA\xCA\x98\xCF\xE7\xEE\x6F\xAC\x33\x12\x6F\xB4\x46\x48\x08\xE2\xFC\x5B\x0B\x92\xB5\x48\x76\xB9\x1C\x91\x56\xFD\x9F\x76\xFC\x82\x28\x11\x77\x23\xFE\x27\xA1\x5E\x94\xCB\x9E\x91\x2B\xEF\x33\xD7\xE9\x2A\x31\xBF\x55\x1A\xF9\xB0\xE0\xE6\x2E\xB7\x15\xA1\x63\x1C\x0A\x8C\x27\xAF\xBD\x5E\x50\x49\xD4\xB0\x53\x93\xDE\x74\x79\xE8\x0B\xAD\x47\x4D\x0D\xDE\xF6\x1E\x13\xCF\xAA\x9E\x9F\x30\x50\xA6\x91\xCB\x70\x4B\xAB\xD0\xFF\x45\x98\x91\x18\x5D\x4A\xAA\x5D\xCE\x41\xA7\x9C\x2A\x83\xAA\xD4\x1F\x29\x38\x43\x1E\xB6\x8F\xF5\x4D\xDB\x9E\xDF\xF5\x52\x15\x75\x3D\x43\x0C\xF0\x2F\xBD\x3D\x7F\x84\x9A\x8C\xCA\xDC\xE3\x27\xC4\xC8\x9D\x62\xAA\x92\x63\x6E\x38\x56\x74\x34\x4A\xB7\x92\x8F\x9C\xB1\x1B\xF4\xC6\xC7\xD1\xFF\x29\x7D\x64\xDB\x54\x38\x21\xAD\xF7\x72\x71\x19\x96\xC0\x2F\x93\x01\x95\xC2\xF4\x2B\x10\x6B\x2F\x6E\xC3\xD7\x2B\x83\x9E\xE0\xBA\x0F\x7C\x44\x96\x34\x20\xC5\xB9\x61\x4B\x47\xD2\x77\x61\x59\xE6\x0E\x69\x0A\x59\x75\x40\xDA\x5F\x57\x03\xB7\x82\xE0\xF5\x41\x52\xAA\x94\xE7\x1E\xD3\x1D\xEB\x7E\xF2\xEE\x53\xE4\x62\x21\xE7\xE5\xD4\x9E\x97\x75\x44\x81\x6A\xA5\x61\x9B\x58\xAA\xE6\x38\x06\x07\x6C\xA5\x67\x3E\xAF\x36\x97\x82\x00\x31\xD6\xB6\x3A\x2B\x2E\xB8\x02\x8C\x50\x4F\x56\x2A\x46\x52\x60\x58\x14\x02\xB7\x97\x36\x15\x23\x90\xCB\x5B\xEE\x5B\x9C\xC7\x0A\x79\x8F\xC4\xE4\xDA\x20\x93\x65\xF6\x6E\x00\x3A\xE2\x12\x00\x55\x32\x1B\x34\xF8\x91\xE2\xD1\x02\xB7\x12\x35\x00\xD2\xC9\xAB\xD0\xBD\x45\x48\x3F\xE4\x4B\x47\xAE\x5B\x53\xC8\x0B\xA9\xC8\x53\x4A\xB9\x15\x0C\x8C\x64\x69\x6A\xE4\xA6\x7F\x5D\xA3\xD1\xD8\x79\xC2\xEB\x3E\x87\xC9\x4A\x87\x53\x2C\xD1\xEC\x0A\x06\x17\xF7\x04\x2B\xA4\xF7\x79\xA1\x7E\xE0\xC4\xF8\x40\x79\x27\xF1\x3E\xC6\x0C\x97\x8C\x7B\x3F\xE2\x8B\xDE\x5E\xA3\x01\x2A\x98\x34\x6C\x02\x30\xB1\xA9\x4E\xC4\xBC\xF5\xD0\x6C\x4B\x67\x10\x1D\x1F\x86\x1D\x7F\x8A\xA3\x4F\x40\x87\xD9\x6E\x39\x09\x63\x7F\x26\x9C\x25\xC0\x3C\x6B\xB4\xF9\xFA\xDF\x7B\x2A\xDF\xB4\x53\x4F\xBE\x02\xC1\x6D\x2E\xE8\xE0\x41\xAD\xCD\xBF\x7B\x31\x27\xE0\x13\x0D\x26\x92\x2F\xEE\x67\x5E\xC2\x18\xDA\x09\xBB\x46\x51\x50\x53\x37\x61\x8A\x4E\x49\x29\x2E\xE4\xC4\x5E\x67\x0C\x17\xE2\xC5\x2D\x6B\x8B\xCE\x24\x92\xDD\x7F\x7D\xC9\x4A\x18\x22\xA5\x97\x96\x26\x77\x4E\xD0\xAE\xFD\xFC\x77\x08\x5E\x86\xB2\x0A\x22\xD1\x51\xAD\xB3\x61\xEF\x9F\x50\xCA\x93\xFB\xF5\x79\xFD\xF1\x88\xE1\x47\x9B\xA6\x68\xBB\xFA\xEC\x2E\xF6\xE4\x36\xFA\x66\x3F\x8F\x96\xFE\xF3\x94\xD4\x12\xF1\xB2\x16\x1F\xB0\xFD\xB3\x0B\x46\x0C\x12\xFE\xBC\x7B\x51\x4F\x12\x07\x6E\x58\x80\xF3\x1B\xDC\x1A\x94\xCB\x8B\xAA\xB0\xF4\x94\x7B\xF0\x1F\x0B\x3C\x82\x32\xD7\x6D\x3A\x0F\x3B\xF8\xA3\x53\x06\x34\xB9\x11\x89\x97\x50\x3E\x2B\x9B\x0D\x26\x48\xEA\x4B\xCB\x2A\x0F\xDB\x2D\xEB\x27\xDF\x8A\x2A\xE8\x3A\x48\xFB\x47\x83\x65\x38\x42\xAD\x8C\xB6\x19\xFD\x4D\x3C\x16\x9E\x67\x32\x2B\xAA\x81\x35\x7C\xF5\xE6\xDE\xFA\x7E\xA3\x37\x81\x2E\x11\xFC\xF0\x02\x50\xDE\xF6\x3F\x7B\xB2\xA7\xE7\x9A\x09\xDD\x21\xA8\xED\xA9\x91\xBD\xC3\xC5\x0F\x2B\xCA\xBC\xC4\xDF\xFB\xEF\x09\x42\xC3\x08\x52\xD1\x63\x1D\x5E\xCC\xDE\xD3\x14\x68\xB6\x59\x14\xEE\xB2\x82\xDA\xD1\x08\xD4\x2C\xFF\x1D\x1A\xDD\xCD\x69\x3B\x3A\x9C\x97\xD0\x0B\x88\x5C\x63\x7B\xB1\x3C\xFE\x2D\x83\x6D\x32\x18\x86\xE5\x28\xF6\x6C\x26\xE7\x8F\xAD\x1E\x4D\xCA\xEB\x7D\x0E\xDB\x96\xC3\xFB\xAE\x76\x96\x2A\x9B\xE4\xE3\x0F\xBF\x7D\x25\xD6\xE4\xC7\xDC\x97\x57\xEE\xB8\xD1\x8D\x0D\x53\x06\xB9\x1C\x09\xD4\x1A\x31\x04\x72\x6F\x95\xEE\x23\xB4\xAF\x15\x22\xEF\xFB\x7E\xE8\xB0\x90\x88\x7E\xAA\x04\xB3\x8E\xB2\x09\x68\xCB\x97\x37\x13\x42\xDF\x33\x3B\x0B\x66\xE6\xF3\x78\xDE\x5F\xD8\x1A\xD2\x93\xCB\x94\x9E\x71\xD5\xFF\xB8\xA7\xCD\xD4\x78\xA5\xD8\x12\x73\xF2\x3E\x59\xEA\x13\xE7\xDD\x00\x2C\xB5\x56\xEB\x73\xF4\x29\x03\x15\xEC\xAF\x7A\xCA\x1D\x44\x44\xDA\x61\x2B\xC5\xCD\x90\x91\xF6\xCD\x09\xCE\xF5\xBA\xAF\x69\x96\x37\x88\x87\xC6\x6D\xD0\x05\x61\x14\x6F\x3E\x68\x0D\x22\xD3\xDC\xAD\x7A\x90\xBD\xAA\x6F\x2A\x03\x47\xBC\xA9\xBD\xFB\x36\xA1\xE2\x9B\x0F\x39\x01\xCD\x84\x5B\xE1\x22\x49\x19\x87\xA8\x52\x48\x9A\x85\x62\x8A\x62\x24\xE1\xC4\x2D\x54\x1B\xC4\x59\x38\x5F\xC2\x58\x2B\x96\xA0\x5E\x20\x28\x31\xA2\x9A\xF1\x3D\xDC\x35\xBA\x69\xEA\x9C\x61\x58\x68\x1B\xBC\x40\x25\x16\x78\x62\x47\xF9\x37\xD7\xFE\xD1\xDD\xF6\x77\x28\xBD\x14\x00\xFD\x86\xFC\xA1\x8F\x32\x3E\xE0\x89\xA3\x9D\x23\x3E\x91\xC6\xAF\x9D\x92\x05\x2B\xA6\x51\xAB\xE7\xB8\x26\x24\xCD\xAA\xF4\x8F\x09\xB3\x91\x2E\xB1\xAE\xDB\x3F\x40\xC2\x18\x09\xD0\x7E\xB9\x10\x5D\xBB\xB0\x5E\x14\x0D\xA0\xD0\xBF\xB9\x72\x7A\xD6\x8D\xE6\xB2\x40\xF0\x0A\xD2\xB4\x1E\x59\x81\x82\x36\x23\xF9\xDE\x7B\x7A\x65\xB2\xD2\x38\xFE\x69\x25\xAD\xCC\x07\xDD\x1A\xEB\xB4\xFD\xA6\x0B\x57\x0D\x86\x99\xD4\x56\x78\x98\xB9\x4B\x0F\xE7\x09\x73\x3D\xF2\x88\x1A\x6F\x4C\x3F\x05\x00\xC7\x4D\xB4\x7C\x26\xD5\xB3\xF5\x74\xAE\xFE\x52\x1B\xF6\x51\x83\x93\xFB\xE4\x62\xC3\xAB\x88\x8D\x30\x74\x43\x8B\x6D\xAA\x2E\xFA\x4E\x24\xB2\xB0\xC7\xC9\xA0\xEB\x9E\xD1\xFE\x5E\x95\xC0\x87\x90\xF2\x43\xB4\xD3\x8C\x4F\x2B\x79\xC7\x70\x52\xEC\x86\x4A\x7A\x46\xE1\xC2\x18\x29\x76\xBB\xE8\xBF\x87\xE0\x41\xCA\x83\xEE\x2A\x2D\xB5\xBA\xA1\x3A\x17\x4C\x07\x9E\xB5\xE3\xC0\xB2\x7F\x09\x6F\x95\x49\x10\x5C\x0C\xA1\x7E\xF9\x10\x3F\xEA\x59\x65\x33\xBD\xD8\xF6\x59\xD4\x3A\xB8\xB7\x9C");

            // Check if the coupon is for specific categories
            if ($applyType == Coupon::CATEGORIES) {
                global $categories, $cartItems, $categoryItems;
                zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x25\x9E\x5A\x10\xF8\x53\x8A\xAA\x31\x2B\x78\xA5\xB3\xD8\x74\x22\x2A\x0B\x84\x7A\x52\xAF\x95\xFF\xDA\xED\xF9\x63\xF7\x08\xF4\x27\xAE\x4E\x78\xE6\xD7\xE4\x73\xB2\xDE\xDC\xA9\x8F\x45\xEC\xDE\x29\x7F\xD4\xD0\xD1\xF1\x3E\x0B\x94\x77\xBB\xB5\x36\x6E\x16\x34\x5D\x91\xFC\x05\x18\x35\xA8\x74\x60\xB7\x1D\x3A\x10\x04\xA1\x35\x66\xC2\x47\x86\x75\x65\x05\x21\x96\x57\x71\xD6\xB7\x4D\x8A\xE3\x9B\x48\xEE\xFD\x81\xFE\x4D\x8A\xE3\x7D\x10\xC6\x71\x0D\x44\x43\x67\xBF\xFB\x6F\xB4\x14\x25\x18\xB9\xE4\x96\xFB\x9B\x67\xE5\x6E\x21\x39\xC3\xC9\x21\x90\xA9\xFF\xF1\x9F\xD8\xCA\x4F\xF8\xB9\x9F\x74\x12\x10\x1C\x69\xB7\x35\x6D\xFE\x19\x3E\x98\xFA\x25\x85\x14\x79\x7B\x59\x90\x09\x3A\x9D\x1C\xC1\xAB\x9A\x8F\xC1\xF5\xA6\xAA\x0C\x6A\x40\x33\x99\xAC\x63\xEB\x43\x20\xE5\x8E\x47\x96\x56\xE9\x2B\xCB\x22\x08\xF5\x91\xFD\x79\xC0\x53\x4D\xF8\x51\x7C\xE9\xCA\x7B\x54\xAF\xB0\x8B\x10\x57\xC4\xF3\x5D\xE2\x0C\xFB\x34\x47\xF0\xB9\x0F\x13\x23\xE0\xC2\x53\x83\x25\xBB\xAD\x1D\x91\xAD\x35\xB4\x55\x3F\x30\xD0\x48\x89\xD8\x9F\x55\xBA\x42\xAE\x11\x8A\x65\x9B\x36\x7D\xA3\x2C\xA0\x50\xB0\xB4\x18\x2E\x2E\x87\x11\xE4\x05\x22\xFC\x66\x9F\xE5\x4D\x17\x07\x53\xB7\xAA\xAC\x43\x15\x28\xAC\x20\x3F\xD2\x23\x9A\x44\x52\xBA\x06\xB9\x43\x70\x4B\xE5\xB1\x18\x2D\x62\xCB\xF2\x1D\x90\x05\x68\x2D\x2E\xAC\x37\x62\xCF\xEE\x38\x83\xDB\xBB\x28\x2D\x54\x57\xE3\xBF\xB2\x82\x7A\x77\x73\x50\x1C\x28\x6D\x1C\xC6\xB3\x9B\xE7\xC2\xC0\x76\xA9\xEC\x79\xA6\xA1\x1E\xEE\xAD");

                // Selecting items that exists in the cart and belongs to the coupon categories
                $commonItems = $cartItems->filter(function ($cartItem) use ($categoryItems) {
                    return $categoryItems->contains('id', $cartItem->item_id);
                });
                $commonItems = CartItem::whereIn('item_id', $commonItems->pluck('item_id'))->where('cart_id', $cart->id)->get();

                if ($commonItems->count() > 0) {
                    if ($coupon->type == Coupon::TYPE_AMOUNT) {
                        $discount = $coupon->discount;

                        $totalCommonItems = $commonItems->count();
                        if ($totalCommonItems > 0) {
                            $totalInitialPrice = $commonItems->sum(function ($item) {
                                return ($item->initial_price + $item->initial_variable_price) * $item->count;
                            });

                            $discount = min($discount, $totalInitialPrice);
                            foreach ($commonItems as $commonItem) {
                                if ($commonItem->is_promoted == 0 && $commonItem->coupon_applied == 0) {
                                    $initialPrice = $commonItem->initial_price + $commonItem->initial_variable_price;
                                    $totalItemPrice = $initialPrice * $commonItem->count;
                                    $itemDiscount = $discount * ($totalItemPrice / $totalInitialPrice);

                                    $price = $initialPrice - ($itemDiscount / $commonItem->count);

                                    $commonItem->update([
                                        'price' => $price,
                                        'coupon_applied' => 1
                                    ]);
                                }
                            }
                        }
                    } else {
                        foreach ($commonItems as $commonItem) {
                            if ($commonItem->is_promoted == 0 && $commonItem->coupon_applied == 0) {
                                $price = $commonItem->initial_price;
                                $discount = $price * ($coupon->discount / 100);
                                $price = $price - $discount;
                                if ($commonItem->variable_price !== null) {
                                    $variable_discount = $commonItem->initial_variable_price * ($coupon->discount / 100);
                                    $variable_price = $commonItem->initial_variable_price - $variable_discount;
                                } else {
                                    $variable_price = null;
                                }

                                // Calculate the new price with the variable price
                                $price = $price + $variable_price;

                                // Apply refreshed price to the item in the cart
                                $commonItem->update([
                                    'price' => $price,
                                    //'initial_price' => $price,
                                    'coupon_applied' => 1,
                                    'variable_price' => $variable_price,
                                ]);
                            }
                        }
                    }
                }
            }

            // Check if the coupon is for specific items
            if ($applyType == Coupon::PACKAGES) {
                global $items, $commonItems;
                zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x02\x80\x43\x7A\x25\x9E\x5A\x10\xF8\x59\x9F\xBB\x39\x3F\x37\xEA\xFA\xFC\x77\x72\x4B\x66\xAA\x6E\x47\x9F\xAB\xCC\xFD\xE7\xE0\x60\xC4\x25\xDA\x22\xAE\x4D\x6F\x9D\x9D\xE3\x77\xAE\x96\x83\xF6\xC0\x43\xF1\xCE\x71\x37\xD9\xE0\xCD\xE5\x76\x49\xEB\x3A\xBC\xFD\x6F\x3E\x5D\x39\x1F\xDA\xE5\x0E\x5F\x35\xA8\x6E\x61\xF2\x55\x67\x17\x49\xEA\x31\x75\xC6\x03\xD8\x4B\x7C\x11\x6A\xC6\x25\x26\xD5\xF5\x10\x8F\xF4\xC7\x27\x90\xF5\x88\xE5\x67\xA0\xE3\x7D\x10\xC6\x71\x0D\x44\x43\x67\xBF\xFB\x6B\xF7\x5B\x68\x55\xF2\xE9\xBE\xFD\x8A\x43\xE2\x2B\x71\x6A\xA2\x84\x71\x8D\x94\xE0\xC9\xB7\xDB\xDD\x76\xD7\xAB\xB1\x43\x3A\x16\x0D\x4D\xF9\x6A\x77\xAC\x46\x3B\x95\xB7\x70\x83\x5D\x2C\x6C\x67\x8B\x19\x42\xD8\x58\xC2\xE4\xDB\xD9\xD6\xB9\xEA\xB7\x45\x7D\x04\x69\xC7\xE9\x38\xEA\x43\x05\xEE\xC5\x14\xD7\x05\xE5\x32\xF1\x26\x33\xBB\xD9\xFA\x74\x84\x19\x4F\xF0\x56\x79\xFE\x81\x1D\x2B\xEC\xFB\x83\x17\x16\x94\xA3\x11\xBB\x73\xB2\x70\x40\xF9\xB0\x02\x09\x27\xE4\xC2\x1E\xCD\x71\xC3\xF4\x74\xC5\xE8\x78\xE7\x55\x22\x30\xB1\x18\xD9\xA4\xF2\x1A\xFE");

                if ($commonItems->count() > 0) {
                    if ($coupon->type == Coupon::TYPE_AMOUNT) {
                        $discount = $coupon->discount;
                        $totalCommonItems = $commonItems->count();
                        $totalInitialPrice = $commonItems->sum(function ($item) {
                            return ($item->initial_price + $item->initial_variable_price) * $item->count;
                        });

                        // Get the discount for each item
                        $discount = min($coupon->discount, $totalInitialPrice);

                        // Check to avoid divide by 0
                        if ($totalCommonItems > 0) {
                            foreach ($commonItems as $commonItem) {
                                if ($commonItem->is_promoted == 0 && $commonItem->coupon_applied == 0) {
                                    $initialPrice = $commonItem->initial_price + $commonItem->initial_variable_price;
                                    $totalItemPrice = $initialPrice * $commonItem->count;
                                    $itemDiscount = $discount * ($totalItemPrice / $totalInitialPrice);

                                    $price = $initialPrice - ($itemDiscount / $commonItem->count);

                                    $commonItem->update([
                                        'price' => $price,
                                        'coupon_applied' => 1,
                                    ]);
                                }
                            }
                        }
                    } else {
                        foreach ($commonItems as $commonItem) {
                            $commonItem = CartItem::where('item_id', $commonItem->item_id)->where('cart_id', $cart->id)->first();
                            if ($commonItem->is_promoted == 0 && $commonItem->coupon_applied == 0) {
                                $price = $commonItem->initial_price;
                                $discount = $price * ($coupon->discount / 100);
                                $price = $price - $discount;
                                if ($commonItem->variable_price !== null) {
                                    $variable_discount = $commonItem->initial_variable_price * ($coupon->discount / 100);
                                    $variable_price = $commonItem->initial_variable_price - $variable_discount;
                                } else {
                                    $variable_price = null;
                                }

                                // Calculate the new price with the variable price
                                $price = $price + $variable_price;

                                $commonItem->update([
                                    'price' => $price,
                                    'coupon_applied' => 1,
                                    'variable_price' => $variable_price,
                                    //'initial_price' => $price,
                                ]);
                            }
                        }
                    }
                }
            }
        }

        // Handling the proportional discount for discount amount
        $cartItems = CartItem::where('cart_id', $cart->id)->get();
        if ($discount > 0 && $totalInitialPrice > 0 && $cartItems->count() > 0 && $coupon->type == Coupon::TYPE_AMOUNT) {
            foreach ($cartItems as $cartItem) {
                // Expecting new count is updated in $cartItem->count
                if ($cartItem->is_promoted == 0 && $cartItem->coupon_applied == 1) {
                    // Updating price after changing the count
                    $initialPrice = $cartItem->initial_price + $cartItem->initial_variable_price;
                    $totalItemPrice = $initialPrice * $cartItem->count;
                    $itemDiscount = $discount * ($totalItemPrice / $totalInitialPrice); // Proportional discount

                    // Calculate the amount of new price after discount
                    $price = $initialPrice - ($itemDiscount / $cartItem->count);

                    $cartItem->update([
                        'price' => $price,
                    ]);
                }
            }
        }

        global $price, $virtual_price;
        zval_zone(config("app.LICENSE_KEY"),"\x99\xDD\xCE\x8F\x18\x3D\xB8\x12\x62\x06\xC3\x02\x28\x71\xF7\x0E\x55\xB1\x43\xCB\xE3\x74\x0D\x67\xA7\x86\xF0\x68\x66\x72\x47\xB6\x56\x61\x92\xAA\xE4\xF7\xFC\xF0\x7D\x91\x71\xEC\x3A\xBB\x53\x73\x8F\x80\xF7\x7E\xB9\x90\xB9\xB7\x83\x07\xB2\x9B\x25\x3B\xD6\xCD\xD0\xAC\x6F\x0C\xAF\x37\xD5\xB2\x3A\x6E\x12\x77\x12\xC4\xAC\x4A\x56\x38\xB6\x30\x3A\xE9\x58\x61\x11\x04\xE5\x77\x73\xDF\x1D\xD5\x61\x74\x19\x12\x8C\x7D\x6A\xC0\xF5\x0A\xC4\xA4\xDB\x01\xBA\xB3\xC9\xA9\x34\xE5\xEA\x57\x10\xC6\x71\x0D\x44\x43\x67\xBF\xFB\x6F\xB4\x14\x28\x06\xFA\xE2\x83\xA1\xC6\x15\x9B\x01\x6C\x6A\xC3\xD4\x21\xF1\xF9\xAF\x89\xA2\xC5\xC7\x49\xF1\xEA\xFE\x17\x43\x59\x62\x00\xE3\x70\x20\xE4\x03\x69\xD0\xF9\x38\x92\x59\x3F\x7B\x50\xC2\x55\x41\x97\x19\x94\xF3\xF3\xDF\xC7\xF9\xA7\xFE\x40\x27\x09\x73\xD3\xE0\x2F\xEC\x6F\x38\xE5\x80\x1A\x9E\x0A\x8A\x7F\x8E\x6F\x77\xBC\xD5\xFA\x70\xCD\x4D\x0A\xBD\x01\x24\xB2\x98\x12\x3B\xAF\xBB\x96\x10\x53\x87\xB2\x0F\xB6\x65\xAF\x71\x0A\xFD\xA7\x5F\x45\x29\xE2\xD3\x16\xCE\x6A\xED\xB7\x35\x97\xBC\x11\xB3\x10\x6F\x3D\xAF\x5B\x96\xF1\xBC\x4E\xE5\x2D\xE2\x42\xF6\x0C\xCF\x73\x30\xB9\x6B\xD9\x3F\xFC\xF1\x5B\x7A\x26\x80\x58\xA0\x4B\x6D\xF1\x70\xCC\xEE\x49\x17\x16\x37\xE7\xE5\xE2\x46\x00\x03\xBA\x32\x3D\x80\x64\xE5\x1D\x1F\xBD\x51\x93\x47\x33\x0A\xB1\xF4\x5F\x62\x30\x82\xB7\x4E\x9D\x1F\x68\x33\x32\xAC\x39\x6A\xD5\xAF\x6C\x83\xC5\xAB\x14\x21\x10\x5D\xEA\xB2\xFC\xDD\x6F\x66\x2A\x46\x52\x7A\x01\x48\xB9\xE0\xCE\xAA\xD9\xEA\x76\xA9\xEC\x79\xA6\xA1\x1E\xEE\xF0\xE9\xC5\x84\x36\xB2\x1B\x03\xF2\xD0\x3F\x83\x0D\x6C\xC2\xCC\x27\xC3\xDA\xD1\xAB\xCD\xEE\xB9\x0A\x98\xA4\x4C\x8F\xAC\x8B\xFA\x46\x0A\xC1\x89\x30\x7B\xD7\x78\xF7\x78\xD3\x03\xBE\x23\x87\xC7\x46\x7D\x41\x20\xBF\xD4\xF8\x18\x48\xD4\xB5\x21\x86\x8F\x3C\xB0\x66\x1C\x24\x34\x5F\x8A\xB0\x6E\x5A\xB4\x61\x8E\xCF\xC9\x5E\x21\xBD\xD9\xCC\xF3\xF5\x16\x42\x57\x78\x73\x3D\x9A\xBB\x41\xE0\x8E\x12\x30\x6D\x9E\xF9\x88\xBB\x25\xFD\xAC\x49\xEE\xB1\xFD\xF6\x01\xA3\x0A\x64\x4F\x28\x17\xC5\xD3\x5F\x2D\xAA\x27\x01\xF8\x14\x72\x86\xDD\x0D\x53\x49\x6C\x26\x21\xAC\x94\xB8\x51\x90\x1A\x26\xA4\xE7\x47\x0E\x8A\x8C\xC5\x44\x3A\x87\xBA\x74\x04\x6E\x75\xF3\x8A\xFA\x2E\x71\xB3\xFA\xAD\xFB\xA9\xB6\x9D\xA3\x08\xF1\x0C\x5C\x37\xEF\x3F\xEF\xE5\xDC\xE4\x5A\xAE\x9C\x75\x71\xD3\xB6\x9C\x8F\xB0\xD0\xB3\xC2\xCA\x65\x71\x02\xAC\xEE\x2D\xB0\x52\x2A\xA9\x7E\x6F\xA2\x06\x05\x45\xCD\x10\x5D\x21\xBD\x6F\x04\xD3\xDE\x82\x64\x9B\x91\x52\x7A\xFD\x38\x4C\xD5\xE0\x0C\xCD\x32\x3B\xDB\xD2\xA7\xAD\x9A\x4F\x09\x0F\x7E\xF5\xFB\x59\x61\x77\x0D\x4D\x94\xEA\xF1\x9C\x51\x2B\xCE\x62\x1E\x31\x49\x17\xAC\x7D\x5E\x43\xF7\xE2\xE2\x82\xD2\x14\x8B\xEB\xC7\x14\x36\x1A\x2D\xA8\xFE\x45\xDF\x92\x19\xC3\x44\x24\x41\x64\x32\x55\x57\x36\x53\x13\x92\x62\xA6\xA0\xC3\xD0\xEA\x03\x06\x7C\xC5\xA2\xB4\xF5\xF4\xDA\xC3\xD5\xDA\x8B\x81\xFD\x42\xD2\x87\x89\x73\x1D\x11\x71\x6E\xC8\x66\xD1\xA9\x1E\x79\x11\x59\xB7\x42\xBD\xAA\x49\x8F\x3A\xBB\xEE\xCF\x9F\x98\x57\x02\x27\x23\xFF\x4A\x9D\xCF\x53\xDA\xE6\x85\xC7\xC4\xE0\x50\x86\xFF\x41\x07\x74\x83\x23\xEA\xE9\x28\x37\xB9\x60\x4D\xD2\xBC\xB7\xFD\x53\xC3\x96\x21\xB4\x54\x84\x99\x17\x23\x2E\x9B\xAE\xB8\xFD\x73\xE9\xFE\x5C\xFB\x8A\x88\x91\x89\x78\x95\xFD\xAF\x52\xF1\xF3\x79\xDD\xF6\xA1\xA1\x55\x36\xA8\x60\x73\x4B\x0D\x4E\x0B\x01\x62\xED\xB5\x3F\x7E\xED\x3D\x9D\x73\x61\x57\x7A\x8F\xD8\x81\x84\x7D\xA0\x8F\xDA\x82\xF9\x23\xB3\xF4\xBF\xF6\x1A\x33\x09\x99\xCA\xD8\x52\x85\x1F\xA9\x8B\xCB\x17\x7D\x51\x2D\x51\x94\x71\xD3\x10\xA8\xF9\xE3\x1C\x4A\xC9\x15\xFC\x5F\x7E\xFB\xA7\xCA\x01\x1D\x18\x58\x3A\x13\x56\xB5\x66\xB0\x5C\x6B\xC2\x08\x33\xFE\x83\x7A\x65\x22\xCF\x5B\xAD\x26\xA2\xBE\x9E\x33\x5D\xD5\x83\xF9\x72\xE3\x54\x29\xF9\x38\xB9\x37\xC3\x88\xE1\x70\x05\xD3\x5F\x47\x9E\xF7\xEE\x0A\xFE\xF6\x4B\xE5\x48\xE6\xBC\x54\x8D\x81\xDD\xDE\x0E\xC4\x50\xA1\x16\x30\x7E\x97\x24\xA1\xC2\x12\x21\xEB\x36\xD1\xAE\xC4\x49\x89\xAD\xD2\x63\xA4\x00\xF4");

        $clear_price = $price;
        $tax = 0;
        $ip = self::getIp();
        $country = 'ALL';

        $paynowHelper = app(PayNowHelper::class);
        if (!$paynowHelper->checkPayNowIntegrationStatus()) {
            if (Tax::where('country', 'ALL')->exists()) {
                $taxes = Tax::where('country', 'ALL')->first();
                if ($price > 0 && ! empty($taxes)) {
                    $tax = $price * ($taxes->percent / 100);
                    if ($taxes->is_included == 0) {
                        $price = $price + $tax;
                    }
                }
            } else if ($ip !== false) {
                try {
                    $geoReader = new \GeoIp2\Database\Reader(base_path('GeoLite2-Country.mmdb'));
                    $country = $geoReader->country($ip)->country->isoCode;

                    $taxes = Tax::where('country', $country)->first();
                    if ($price > 0 && ! empty($taxes)) {
                        $tax = $price * ($taxes->percent / 100);
                        if ($taxes->is_included == 0) {
                            $price = $price + $tax;
                        }
                    }
                } catch (\GeoIp2\Exception\AddressNotFoundException $e) {
                    $country = 'Undefined';
                }
            }
        }

        $this->recalculateGiftcard($cart->user_id);

        $discordSync = 0;
        if ($settings->discord_bot_enabled == 1) {
            $discordSync = $this->discordSync($cart) ? 1 : 0;
        }

        $cart->update([
            'items' => $items,
            'price' => $price,
            'clear_price' => $clear_price,
            'tax' => $tax,
            'virtual_price' => $virtual_price,
            'discord_sync' => $discordSync,
        ]);
    }

    public function getSelectServers(Request $r){
        $cart = self::getCartByUserId($r->user()->id);
        $selectServers = DB::table('cart_items')
            ->join('items', 'cart_items.item_id', '=', 'items.id')
            ->join('item_servers', 'item_servers.item_id', '=', 'items.id')
            ->join('servers', 'item_servers.server_id', '=', 'servers.id')
            ->where(function($query) {
                $query->where('servers.deleted', '=', 0)
                    ->orWhereNull('servers.deleted');
            })
            ->select('items.id AS itemId', 'servers.id AS serverId', 'servers.name AS serverName')
            ->where('servers.deleted', 0)
            ->where('cart_items.cart_id', $cart->id)
            ->where('items.is_server_choice', 1)
            ->where('item_servers.type', ItemServer::TYPE_CMD_SERVER)
            ->groupBy(['itemId', 'serverId', 'serverName'])
            ->get()
            ->groupBy('itemId');
        return $selectServers;
    }

    public function getPromoted(Request $request): array
    {
        // Get promoted items from the database
        $getPromotedItems = DB::table('promoted_items')
            ->join('items', 'promoted_items.item_id', '=', 'items.id')
            ->select(['items.id', 'items.name', 'items.image', 'promoted_items.price'])
            ->get();
        $ip = NetworkHelper::getIp($request->ip());

        $promotedItems = [];
        foreach ($getPromotedItems as $item) {
            $originalItemPrice = ItemsController::getPrice(Item::find($item->id));
            $originalItem = Item::find($item->id);
            $settings = Setting::find(1);
            $user = $request->user();

            $is_unavailable = false;
            $category = Category::find($originalItem->category_id);
            if (!$category) {
                $is_unavailable = true;
            }
            $categoryItems = Item::query()->where('category_id', $category->id)->orderBy('sorting', 'asc')->get();

            // Handle virtual currency if it is enabled and the item is virtual currency only
            if ($settings->is_virtual_currency == 1 && $originalItem->is_virtual_currency_only == 1 && ! is_null($originalItem->virtual_price)) {
                $virtual_price = $originalItem->virtual_price;
            } else {
                $virtual_price = 0;
            }

            // Handle cumulative category mode
            if ($category && $category->is_cumulative == 1) {
                $cumulativeCategoryItems = collect($categoryItems)->pluck('id')->toArray();

                // Get all payments for belonged category for this user
                $purchasedItems = DB::table('cart_items')
                    ->join('carts', 'carts.id', '=', 'cart_items.cart_id')
                    ->join('payments', 'payments.cart_id', '=', 'carts.id')
                    ->join('items', 'items.id', '=', 'cart_items.item_id')
                    ->select([
                        'cart_items.item_id',
                        'items.price as original_price'
                    ])
                    ->whereIn('cart_items.item_id', $cumulativeCategoryItems)
                    ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED])
                    ->where('payments.user_id', $user->id)
                    ->get();

                // Find the highest priced item from $purchasedItems array
                $highestPurchasedOriginalPrice = $purchasedItems->max('original_price') ?? 0;
                if ($originalItem->price <= $highestPurchasedOriginalPrice) {
                    $is_unavailable = true;
                }
            }

            $quantityGlobalLimit = null;
            $quantityGlobalCurrentLimit = null;
            $quantityUserLimit = null;
            $quantityUserCurrentLimit = null;

            // Global Quantity Limit Check
            if (!$is_unavailable && $originalItem->quantityGlobalLimit > 0) {
                $qlQuery = DB::table('payments')
                    ->join('carts', 'carts.id', '=', 'payments.cart_id')
                    ->join('cart_items', 'cart_items.cart_id', '=', 'carts.id')
                    ->select(DB::raw('COALESCE(SUM(cart_items.`count`),0) AS total'))
                    ->where([
                        ['cart_items.item_id', '=', $originalItem->id],
                    ])
                    ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED]);

                if ($originalItem->quantityGlobalPeriodValue > -1) {
                    $currentTime = now();
                    $dateFrom = $currentTime->subMinutes((int)$originalItem->quantityGlobalPeriodValue);
                    $qlQuery = $qlQuery->whereBetween('payments.updated_at', [$dateFrom, $currentTime]);
                }

                $quantityLimitTotal = $qlQuery->first();
                $quantityLimitTotal = empty($quantityLimitTotal) ? 0 : floatval($quantityLimitTotal->total);

                // Set values for global quantity limits
                $quantityGlobalLimit = $originalItem->quantityGlobalLimit;
                $quantityGlobalCurrentLimit = $quantityLimitTotal;

                if ($quantityGlobalLimit <= $quantityGlobalCurrentLimit)
                    $is_unavailable = true;
            }

            // User Quantity Limit Check
            if (!$is_unavailable && $originalItem->quantityUserLimit > 0) {
                $qlQuery = DB::table('payments')
                    ->join('carts', 'carts.id', '=', 'payments.cart_id')
                    ->join('users', 'users.id', '=', 'carts.user_id')
                    ->join('cart_items', 'cart_items.cart_id', '=', 'carts.id')
                    ->select(DB::raw('COALESCE(SUM(cart_items.`count`),0) AS total'))
                    ->where([
                        ['users.id', '=', $user->id],
                        ['cart_items.item_id', '=', $originalItem->id],
                    ])
                    ->whereIn('payments.status', [Payment::PAID, Payment::COMPLETED]);

                if ($originalItem->quantityUserPeriodValue > -1) {
                    $currentTime = now();
                    $dateFrom = $currentTime->subMinutes((int)$originalItem->quantityUserPeriodValue);
                    $qlQuery = $qlQuery->whereBetween('payments.updated_at', [$dateFrom, $currentTime]);
                }

                $quantityLimitTotal = $qlQuery->first();
                $quantityLimitTotal = empty($quantityLimitTotal) ? 0 : floatval($quantityLimitTotal->total);

                // Set values for user quantity limits
                $quantityUserLimit = $originalItem->quantityUserLimit;
                $quantityUserCurrentLimit = $quantityLimitTotal;

                if ($originalItem->quantityUserLimit <= $quantityUserCurrentLimit)
                    $is_unavailable = true;
            }

            // Add promoted item to the array
            $promotedItems[] = [
                'id' => $item->id,
                'name' => $item->name,
                'image' => '/img/items/' . $item->id . '.png',
                'original_price' => ItemsController::applyVatToValue($originalItemPrice, $ip),
                'price' => ItemsController::applyVatToValue($item->price, $ip),
                'is_subs' => $originalItem->is_subs,
                'is_subs_only' => $originalItem->is_subs_only,
                'quantityGlobalLimit' => $quantityGlobalLimit ?? null, // Global quantity limit
                'quantityGlobalCurrentLimit' => $quantityGlobalCurrentLimit ?? null, // Current value of global quantity limit
                'quantityUserLimit' => $quantityUserLimit ?? null, // User quantity limit
                'quantityUserCurrentLimit' => $quantityUserCurrentLimit ?? null, // Current value of user quantity limit
                'is_unavailable' => $is_unavailable,
                'is_virtual_currency_only' => $originalItem->is_virtual_currency_only,
                'virtual_price' => $originalItem->virtual_price,
            ];
        }

        return $promotedItems;
    }

    private function wipeCart($cart)
    {
        $cart->update([
            'items' => 0,
            'price' => 0,
            'clear_price' => 0,
            'tax' => 0,
            'virtual_price' => 0,
            'coupon_id' => NULL,
            'gift_id' => NULL,
            'gift_sum' => 0,
        ]);
        CartItem::where('cart_id', $cart->id)->delete();
    }

    public static function getIp()
    {
        foreach (['HTTP_CLIENT_IP', 'HTTP_X_FORWARDED_FOR', 'HTTP_X_FORWARDED', 'HTTP_X_CLUSTER_CLIENT_IP', 'HTTP_FORWARDED_FOR', 'HTTP_FORWARDED', 'REMOTE_ADDR'] as $key) {
            if (array_key_exists($key, $_SERVER) === true) {
                foreach (explode(',', $_SERVER[$key]) as $ip) {
                    $ip = trim($ip);
                    if (filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE) !== false) {
                        return $ip;
                    }
                }
            }
        }

        return false;
    }

    private function discordSync($cart): bool
    {
        $cartItems = CartItem::where('cart_id', $cart->id)->get();

        foreach ($cartItems as $cartItem) {
            $item = Item::find($cartItem->item_id);
            if ($item->discordRole()->exists()) {
                return true;
            }
        }

        return false;
    }
}
